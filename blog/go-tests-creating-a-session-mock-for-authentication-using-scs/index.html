<!DOCTYPE html><html data-astro-cid-sckkx6r4 lang=en><head><meta charset=UTF-8><meta content=en-US http-equiv=content-language><meta content=text/html http-equiv=content-type><meta content="© 2023, Lucas Josino. All Rights Reserved." name=copyright><meta content="In this article, we'll explore how to mock our session and inject data into context for authentication tests" name=description><meta content="Lucas Josino" name=author><meta content="java, java developer, kotlin, sql, postgresql, hawapi, spring, spring boot, spring mvc, kotlin developer, backend, backend developer, portfolio, lucasjosino, lucas josino, lucjosin, lucjos.in, josino, developer, @lucjoin, @lucjos.in, desenvolvedor, desenvolvedor backend, desenvolvedor kotlin" name=tags><meta content="java, java developer, kotlin, sql, postgresql, hawapi, spring, spring boot, spring mvc, kotlin developer, backend, backend developer, portfolio, lucasjosino, lucas josino, lucjosin, lucjos.in, josino, developer, @lucjoin, @lucjos.in, desenvolvedor, desenvolvedor backend, desenvolvedor kotlin" name=keywords><meta content="width=device-width,initial-scale=1" name=viewport><meta content=index,follow name=robots><meta content=summary_large_image name=twitter:card><meta content=@LucJosin name=twitter:creator><meta content=@LucJosin name=twitter:site><meta content=https://www.lucasjosino.com/ name=twitter:domain><meta content="Go Tests: Creating a session mock for authentication using SCS" name=twitter:title><meta content="In this article, we'll explore how to mock our session and inject data into context for authentication tests" name=twitter:description itemprop=description property=og:description><meta content=https://www.lucasjosino.com/static/open-graph/go-tests-creating-a-session-mock-for-authentication-using-scs.png property=twitter:image itemprop="image primaryImageOfPage"><meta content=https://www.lucasjosino.com/ property=og:url><meta content="Go Tests: Creating a session mock for authentication using SCS" property=og:title><meta content="Lucas Josino" property=og:site_name><meta content="In this article, we'll explore how to mock our session and inject data into context for authentication tests" property=og:description><meta content=article property=og:type><meta content=https://www.lucasjosino.com/static/open-graph/go-tests-creating-a-session-mock-for-authentication-using-scs.png property=og:image><meta content="2024-02-01 20:00 UTC-3" property=article:published_time><meta property=article:modified_time><meta content="Lucas Josino" property=article:author><meta content="How to" property=article:section><meta content="golang go-chi tests auth session" property=article:tag><link href=https://lucjos.in/b/ZfgJzcJf rel=shortlink type=text/html><link href=https://lucasjosino.dev/blog/go-tests-creating-a-session-mock-for-authentication-using-scs/ rel=alternative><link href=https://www.lucasjosino.com/blog/go-tests-creating-a-session-mock-for-authentication-using-scs/ rel=canonical><link href=https://www.lucasjosino.com/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link href=https://www.lucasjosino.com/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=https://www.lucasjosino.com/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link href=https://www.lucasjosino.com/favicon.ico rel=icon media=(prefers-color-scheme:no-preference)><link href=https://www.lucasjosino.com/favicon-light.ico rel=icon media=(prefers-color-scheme:dark)><link href=https://www.lucasjosino.com/favicon.ico rel=icon media=(prefers-color-scheme:light)><meta content="Astro v3.3.4" name=generator><title>Go Tests: Creating a session mock for authentication using SCS</title><link href=/_astro/_slug_.ea505199.css rel=stylesheet /><style>.astro-yPLsaLEy[data-astro-cid-xv6didhw]{margin:var(--margin);font-size:var(--fontSize);font-weight:700;text-align:var(--textAlign);text-rendering:optimizeLegibility}.astro-LCfjapxT[data-astro-cid-oulxospg]{margin:8vh 0 4vh;max-width:var(--maxWidth);width:90%;min-width:30rem;background-color:var(--primary-color);border-radius:var(--layout-border-radius);display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative;gap:var(--gap)}.astro-pJvaVgkC[data-astro-cid-oulxospg]{position:absolute;top:0;left:0}.astro-pJvaVgkC[data-astro-cid-oulxospg]:hover>[data-astro-cid-oulxospg][astro-icon]{fill:gray;color:gray}@media (max-width:560px){.astro-LCfjapxT[data-astro-cid-oulxospg]{min-width:initial}}:root{--primary-color:#f0f0f0;--secondary-color:#e9e9e7;--contrast-color:#000;--contrast-color-rgb:0,0,0;--divider-color:#000;--border-color:#000;--border-size:1px;--primary-text-color:#000;--secondary-text-color:#fff;--border-radius:10px;--layout-border-radius:20px;--transition-duration:.2s;--card-padding:.8rem}@media (prefers-color-scheme:dark){:root{--primary-color:#111111;--secondary-color:#181818;--contrast-color:#fff;--contrast-color-rgb:255,255,255;--divider-color:#fff;--border-color:#fff;--primary-text-color:#fff;--secondary-text-color:#121212}}body,html{padding:0;margin:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;background-color:var(--primary-color);color:var(--primary-text-color);--scroll-behavior:smooth!important;scroll-behavior:smooth!important;scroll-padding-top:2rem}*{box-sizing:border-box}main{display:flex;flex-direction:column;align-items:center}::-webkit-scrollbar{width:7px;background-color:var(--secondary-color)}::-webkit-scrollbar-thumb{background-color:var(--contrast-color);border-radius:var(--border-radius)}[astro-icon]{fill:var(--primary-text-color);color:var(--primary-text-color);transition:all var(--transition-duration)}a{color:var(--primary-text-color);text-decoration:none}h1,p{margin-block-start:0;margin-block-end:0;margin-inline-start:0;margin-inline-end:0}.astro-RCjsrPqZ[data-astro-cid-6ktkooou]{padding:.4rem;border-radius:var(--border-radius);border:var(--border-size) solid var(--border-color);transition:all .2s;white-space:nowrap}.astro-RCjsrPqZ[data-astro-cid-6ktkooou]:hover{border:var(--border-size) solid var(--primary-color);background-color:var(--border-color);color:var(--primary-color);cursor:pointer}.astro-QBdfmTCa[data-astro-cid-4mxiqxos]{display:flex;flex-wrap:wrap;flex-direction:row;justify-content:var(--justifyContent);gap:.5rem;font-size:.9em}.astro-kUYfPmso[data-astro-cid-cyj6nqmj]{overflow:hidden;width:var(--width);display:-webkit-box;-webkit-line-clamp:var(--maxLine);-webkit-box-orient:vertical;margin:var(--margin);font-size:var(--fontSize);text-align:var(--textAlign);color:#cfcfcf}@media (prefers-color-scheme:light){.astro-kUYfPmso[data-astro-cid-cyj6nqmj]{color:#404040}}.astro-DnYhBFIZ[data-astro-cid-w4ghbtci]{min-height:22rem;border:var(--border-size) solid var(--border-color);border-radius:var(--border-radius);padding:var(--card-padding);transition:all var(--transition-duration);display:flex;flex-direction:column;gap:.6rem}h3[data-astro-cid-w4ghbtci]{margin:0}.astro-dsdKKwiN[data-astro-cid-w4ghbtci]{height:100%;width:100%;object-fit:cover;border-radius:var(--border-radius)}.astro-qepNYMjd[data-astro-cid-w4ghbtci]{font-size:.85em;display:flex;align-items:center;justify-content:space-between}.astro-axSxPMXA[data-astro-cid-w4ghbtci]{display:flex;gap:.4rem}.astro-KPDjccJr[data-astro-cid-w4ghbtci]{display:flex;align-items:center}.astro-ePDMdrOI[data-astro-cid-trf4k3zj]{border-bottom:var(--border-size) solid transparent;transition:all var(--transition-duration);cursor:pointer;display:flex;align-items:center;gap:var(--currentGap)}.astro-ePDMdrOI[data-astro-cid-trf4k3zj]:hover{border-bottom:var(--border-size) solid var(--borderBottom);gap:var(--animatedGap)}.astro-ePDMdrOI[data-astro-cid-trf4k3zj]:hover>[data-astro-cid-trf4k3zj][astro-icon]{fill:var(--iconColor);color:var(--iconColor)}.astro-bAqrVGaX[data-astro-cid-4d7p4lxg]{margin:var(--margin);height:var(--height);width:var(--width);background-color:var(--divider-color)}.astro-DaXkxEXU[data-astro-cid-5rz5afgx]{display:flex;gap:.2rem}.astro-IDVWWxLX[data-astro-cid-tpz4yhk7]{border:var(--border-size) solid var(--border-color);border-radius:var(--border-radius);display:flex;align-items:center;justify-content:center;transition:all var(--transition-duration);gap:.5rem;padding:var(--padding)}.astro-IDVWWxLX[data-astro-cid-tpz4yhk7]:hover{border:var(--border-size) solid var(--primary-color);background-color:var(--border-color);color:var(--primary-color);cursor:pointer}.astro-IDVWWxLX[data-astro-cid-tpz4yhk7]:hover>[data-astro-cid-tpz4yhk7][astro-icon]{fill:var(--secondary-text-color);color:var(--secondary-text-color)}</style><script src=/_astro/hoisted.449f7921.js type=module></script><script src=/_astro/page.e9a682ca.js type=module></script></head><body data-astro-cid-sckkx6r4><main data-astro-cid-sckkx6r4><div class=astro-LCfjapxT style=--maxWidth:45rem;--gap:1rem data-astro-cid-oulxospg><div class=astro-OFOZBuIh data-astro-cid-dvdhntu2><div class=astro-XizaFDWH data-astro-cid-dvdhntu2></div></div><a class=astro-uPXmnTIp data-astro-cid-5rdg3oos><svg viewBox="0 0 24 24" width=24 astro-icon=mdi:arrow-up data-astro-cid-5rdg3oos><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z" fill=currentColor /></svg></a><div class=astro-DaXkxEXU data-astro-cid-5rz5afgx><svg viewBox="0 0 24 24" width=18 astro-icon=mdi:arrow-left data-astro-cid-5rz5afgx><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z" fill=currentColor /></svg><a href=/blog/ class=astro-ePDMdrOI title="See all posts" style=--borderBottom:var(--border-color);--currentGap:0.6rem;--animatedGap:0.6rem;--iconColor:gray data-astro-cid-trf4k3zj><span style=--borderBottom:var(--border-color);--currentGap:0.6rem;--animatedGap:0.6rem;--iconColor:gray data-astro-cid-trf4k3zj>Posts</span></a> • <a href=/ class=astro-ePDMdrOI title=Homepage style=--borderBottom:var(--border-color);--currentGap:0.6rem;--animatedGap:0.6rem;--iconColor:gray data-astro-cid-trf4k3zj><span style=--borderBottom:var(--border-color);--currentGap:0.6rem;--animatedGap:0.6rem;--iconColor:gray data-astro-cid-trf4k3zj>Lucas Josino</span></a></div><h1 class=astro-yPLsaLEy data-astro-cid-xv6didhw style="--margin:1rem 0;--fontSize:2.5em;--textAlign:center">Go Tests: Creating a session mock for authentication using SCS</h1><div class=astro-Pd_IDSLk data-astro-cid-5rm6lea6><span class=astro-PxJWXUvX data-astro-cid-ejkbpqkz><svg viewBox="0 0 24 24" width=18 astro-icon=mdi:calendar-range data-astro-cid-ejkbpqkz><path d="M9 10H7v2h2v-2m4 0h-2v2h2v-2m4 0h-2v2h2v-2m2-7h-1V1h-2v2H8V1H6v2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2m0 16H5V8h14v11z" fill=currentColor /></svg>February 1, 2024</span><span class=astro-PxJWXUvX data-astro-cid-ejkbpqkz><svg viewBox="0 0 24 24" width=18 astro-icon=ic:outline-article data-astro-cid-ejkbpqkz><path d="M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z" fill=currentColor /><path d="M14 17H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z" fill=currentColor /></svg><a href="/blog/categories/How to" class=astro-ePDMdrOI title="See more from this category" style=--borderBottom:var(--border-color);--currentGap:0.6rem;--animatedGap:0.6rem;--iconColor:gray data-astro-cid-trf4k3zj><span style=--borderBottom:var(--border-color);--currentGap:0.6rem;--animatedGap:0.6rem;--iconColor:gray data-astro-cid-trf4k3zj>How to</span></a></span><span class=astro-PxJWXUvX data-astro-cid-ejkbpqkz><svg viewBox="0 0 24 24" width=18 astro-icon=ic:outline-tag data-astro-cid-ejkbpqkz><path d="M20 10V8h-4V4h-2v4h-4V4H8v4H4v2h4v4H4v2h4v4h2v-4h4v4h2v-4h4v-2h-4v-4h4zm-6 4h-4v-4h4v4z" fill=currentColor /></svg><a href=#tags class=astro-ePDMdrOI title="See all tags" style=--borderBottom:var(--border-color);--currentGap:0.6rem;--animatedGap:0.6rem;--iconColor:gray data-astro-cid-trf4k3zj><span style=--borderBottom:var(--border-color);--currentGap:0.6rem;--animatedGap:0.6rem;--iconColor:gray data-astro-cid-trf4k3zj>Tags</span></a></span><span class=astro-PxJWXUvX data-astro-cid-ejkbpqkz><svg viewBox="0 0 24 24" width=18 astro-icon=mdi:clock-outline data-astro-cid-ejkbpqkz><path d="M12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m0-18a10 10 0 0 1 10 10 10 10 0 0 1-10 10C6.47 22 2 17.5 2 12A10 10 0 0 1 12 2m.5 5v5.25l4.5 2.67-.75 1.23L11 13V7h1.5z" fill=currentColor /></svg>6 min read</span><span class=astro-PxJWXUvX data-astro-cid-ejkbpqkz><svg viewBox="0 0 24 24" width=18 astro-icon=mdi:comment-multiple-outline data-astro-cid-ejkbpqkz><path d="M12 23a1 1 0 0 1-1-1v-3H7a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-4.1l-3.7 3.71c-.2.19-.45.29-.7.29H12m1-6v3.08L16.08 17H21V7H7v10h6M3 15H1V3a2 2 0 0 1 2-2h16v2H3v12z" fill=currentColor /></svg><a href=#comments class=astro-ePDMdrOI title="Go to comments" style=--borderBottom:var(--border-color);--currentGap:0.6rem;--animatedGap:0.6rem;--iconColor:gray data-astro-cid-trf4k3zj><span style=--borderBottom:var(--border-color);--currentGap:0.6rem;--animatedGap:0.6rem;--iconColor:gray data-astro-cid-trf4k3zj>Comments</span></a></span></div><img alt="Post - Go Tests: Creating a session mock for authentication using SCS" class=astro-KYEXI_OX data-astro-cid-fwhsluhj src=https://raw.githubusercontent.com/lucjosin/lucasjosino.com/main/public/static/blog/ZfgJzcJf/golang-session-tests.png><div class=astro-XyuZPGRa data-astro-cid-6lpegvfu><div class=astro-RjbOdobi data-astro-cid-fasyqkqy data-href="https://www.linkedin.com/sharing/share-offsite/?url=https://lucjos.in/b/ZfgJzcJf"><span class=astro-__iHymyG data-astro-cid-fasyqkqy>Share to Linkedin</span><a href="https://www.linkedin.com/sharing/share-offsite/?url=https://lucjos.in/b/ZfgJzcJf" class=astro-IDVWWxLX title="Share to Linkedin" style="--padding:0.6rem 0.8rem" data-astro-cid-tpz4yhk7 rel="noopener noreferrer" target=_blank><svg viewBox="0 0 24 24" width=16 height=16 astro-icon=simple-icons:linkedin data-astro-cid-tpz4yhk7><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z" fill=currentColor /></svg></a></div><div class=astro-RjbOdobi data-astro-cid-fasyqkqy data-href="https://twitter.com/intent/tweet?url=https://lucjos.in/b/ZfgJzcJf&#38;text=Go%20Tests:%20Creating%20a%20session%20mock%20for%20authentication%20using%20SCS%20by%20@LucJosin"><span class=astro-__iHymyG data-astro-cid-fasyqkqy>Share to Twitter</span><a href="https://twitter.com/intent/tweet?url=https://lucjos.in/b/ZfgJzcJf&#38;text=Go%20Tests:%20Creating%20a%20session%20mock%20for%20authentication%20using%20SCS%20by%20@LucJosin" class=astro-IDVWWxLX title="Share to Twitter" style="--padding:0.6rem 0.8rem" data-astro-cid-tpz4yhk7 rel="noopener noreferrer" target=_blank><svg viewBox="0 0 24 24" width=16 height=16 astro-icon=simple-icons:twitter data-astro-cid-tpz4yhk7><path d="M23.953 4.57a10 10 0 0 1-2.825.775 4.958 4.958 0 0 0 2.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 0 0-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 0 0-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 0 1-2.228-.616v.06a4.923 4.923 0 0 0 3.946 4.827 4.996 4.996 0 0 1-2.212.085 4.936 4.936 0 0 0 4.604 3.417 9.867 9.867 0 0 1-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 0 0 7.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0 0 24 4.59z" fill=currentColor /></svg></a></div><div class=astro-RjbOdobi data-astro-cid-fasyqkqy data-href="https://reddit.com/submit?url=https://lucjos.in/b/ZfgJzcJf&#38;title=Go%20Tests:%20Creating%20a%20session%20mock%20for%20authentication%20using%20SCS"><span class=astro-__iHymyG data-astro-cid-fasyqkqy>Share to Reddit</span><a href="https://reddit.com/submit?url=https://lucjos.in/b/ZfgJzcJf&#38;title=Go%20Tests:%20Creating%20a%20session%20mock%20for%20authentication%20using%20SCS" class=astro-IDVWWxLX title="Share to Reddit" style="--padding:0.6rem 0.8rem" data-astro-cid-tpz4yhk7 rel="noopener noreferrer" target=_blank><svg viewBox="0 0 24 24" width=16 height=16 astro-icon=simple-icons:reddit data-astro-cid-tpz4yhk7><path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z" fill=currentColor /></svg></a></div><div class=astro-RjbOdobi data-astro-cid-fasyqkqy data-href=https://lucjos.in/b/ZfgJzcJf id=share><span class=astro-__iHymyG data-astro-cid-fasyqkqy id=share-title>Copy link</span><a href=https://lucjos.in/b/ZfgJzcJf class=astro-IDVWWxLX title="Copy link" style="--padding:0.6rem 0.8rem" data-astro-cid-tpz4yhk7 rel="noopener noreferrer" target=_blank><svg viewBox="0 0 24 24" width=16 height=16 astro-icon=mdi:link data-astro-cid-tpz4yhk7><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8v2m9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1 0 1.71-1.39 3.1-3.1 3.1h-4V17h4a5 5 0 0 0 5-5 5 5 0 0 0-5-5z" fill=currentColor /></svg></a></div></div><div class=astro-bAqrVGaX style=--height:1px;--width:100%;--margin:0 data-astro-cid-4d7p4lxg></div><article class="astro-HqPSOQNA astro-tKlRDiXW"><h2 id=table-of-contents>Table of Contents<a href=#table-of-contents class=astro-XmVVtUzC aria-hidden="" tabindex=-1><svg viewBox="0 0 24 24" width=18 height=18 class=autolink-svg fill=currentColor marginLeft=1rem xmlns=http://www.w3.org/2000/svg><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h2><p></p><details><summary>Open Table of Contents</summary><p></p><ul><li><a href=#introduction>Introduction</a></li><li><a href=#server-config>Server config</a></li><li><a href=#server-routes>Server routes</a></li><li><a href=#middleware-for-user-authorization>Middleware for user authorization</a></li><li><a href=#the-testing>The testing</a></li><li><a href=#loadandsavemock-middleware>LoadAndSaveMock middleware</a></li><li><a href=#putting-all-together>Putting all together</a></li><li><a href=#conclusion>Conclusion</a></li><li><a href=#resources-and-references>Resources and References</a></li></ul><p></p></details><p></p><h2 id=introduction>Introduction<a href=#introduction class=astro-XmVVtUzC aria-hidden="" tabindex=-1><svg viewBox="0 0 24 24" width=18 height=18 class=autolink-svg fill=currentColor marginLeft=1rem xmlns=http://www.w3.org/2000/svg><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h2><p>While working on a personal project using Go and <a href=https://github.com/alexedwards/scs rel="noopener noreferrer" target=_blank>alexedwards/scs<span><svg viewBox="0 0 24 24" width=16 height=16 class=astro-NcINbxXp fill=currentColor marginLeft=1rem xmlns=http://www.w3.org/2000/svg><path d="M14 3v2h3.59l-9.83 9.83l1.41 1.41L19 6.41V10h2V3m-2 16H5V5h7V3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7h-2v7Z"></path></svg></span></a>for handling sessions, I’ve come across an issue when creating tests: After setting up the configuration and the <code>LoadAndSave</code> middleware, all tests started failing with 401 (Unauthorized) response.</p><p>In this quickly post we’ll simple a small GoLang server using <a href=https://go-chi.io rel="noopener noreferrer" target=_blank>go-chi<span><svg viewBox="0 0 24 24" width=16 height=16 class=astro-NcINbxXp fill=currentColor marginLeft=1rem xmlns=http://www.w3.org/2000/svg><path d="M14 3v2h3.59l-9.83 9.83l1.41 1.41L19 6.41V10h2V3m-2 16H5V5h7V3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7h-2v7Z"></path></svg></span></a>router and implement a <code>LoadAndSaveMock</code> middleware to inject any session information into our test.</p><p>Or if you want to go direct to the <a href=#implementing-loadandsavemock-middleware>LoadAndSaveMock middleware</a> :)</p><h2 id=server-config>Server config<a href=#server-config class=astro-XmVVtUzC aria-hidden="" tabindex=-1><svg viewBox="0 0 24 24" width=18 height=18 class=autolink-svg fill=currentColor marginLeft=1rem xmlns=http://www.w3.org/2000/svg><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h2><p>First, let’s create a <code>Server</code> struct to hold our session manager and router</p><div class="ec ec-2w87v ec-theme-github-dark expressive-code"><style>.ec.ec-2w87v{font-family:system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,'Apple Color Emoji','Segoe UI Emoji';font-size:.9rem;line-height:1.65;text-size-adjust:none;-webkit-text-size-adjust:none}.ec.ec-2w87v :not(path){all:revert;box-sizing:border-box}.ec.ec-2w87v ::selection{background:#39414a;color:#e1e4e8}.ec.ec-2w87v pre{display:flex;margin:0;padding:0;border:1.5px solid #1b1f23;border-radius:calc(.3rem + 1.5px);background:#24292e}.ec.ec-2w87v pre:focus-visible{outline:3px solid #005cc5;outline-offset:-3px}.ec.ec-2w87v pre>code{all:unset;display:block;flex:1 0 100%;padding:1rem 0;color:#e1e4e8;font-family:'IBM Plex Mono',Consolas,'Andale Mono WT','Andale Mono','Lucida Console','Lucida Sans Typewriter','DejaVu Sans Mono','Bitstream Vera Sans Mono','Liberation Mono','Nimbus Mono L',Monaco,'Courier New',Courier,monospace;font-size:.85rem;line-height:1.65;--padding-inline:1.35rem}.ec.ec-2w87v pre ::selection{background:#3392ff44;color:inherit}.ec.ec-2w87v pre{overflow-x:auto}.ec.ec-2w87v pre::-webkit-scrollbar,.ec.ec-2w87v pre::-webkit-scrollbar-track{background-color:inherit;border-radius:calc(.3rem + 1.5px);border-top-left-radius:0;border-top-right-radius:0}.ec.ec-2w87v pre::-webkit-scrollbar-thumb{background-color:#6a737d33;border:4px solid transparent;background-clip:content-box;border-radius:10px}.ec.ec-2w87v pre::-webkit-scrollbar-thumb:hover{background-color:#6a737dd1}.ec.ec-2w87v .ec-line{--accent-margin:0rem;min-width:calc(100% - var(--accent-margin));padding-inline:var(--padding-inline);padding-inline-end:calc(2rem + var(--padding-inline));direction:ltr;unicode-bidi:isolate}.ec.ec-2w87v .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border-width:0}.ec.ec-2w87v .ec-line.mark{--line-marker-bg-color:#264a8980;--line-marker-border-color:#5570b3d0}.ec.ec-2w87v .ec-line.ins{--line-marker-bg-color:#26561c80;--line-marker-border-color:#4e7e41d0}.ec.ec-2w87v .ec-line.ins::before{content:'+';color:#7eb070d0}.ec.ec-2w87v .ec-line.del{--line-marker-bg-color:#81322b80;--line-marker-border-color:#ae594fd0}.ec.ec-2w87v .ec-line.del::before{content:'-';color:#e68a7ed0}.ec.ec-2w87v .ec-line.del,.ec.ec-2w87v .ec-line.ins,.ec.ec-2w87v .ec-line.mark{--accent-margin:0rem;--accent-width:0.15rem;position:relative;background:var(--line-marker-bg-color);margin-inline-start:var(--accent-margin);border-inline-start:var(--accent-width) solid var(--line-marker-border-color);padding-inline-start:calc(1.35rem - var(--accent-margin) - var(--accent-width))!important}.ec.ec-2w87v .ec-line.del::before,.ec.ec-2w87v .ec-line.ins::before,.ec.ec-2w87v .ec-line.mark::before{position:absolute;left:.5rem}.ec.ec-2w87v .ec-line mark{--inline-marker-bg-color:#264a8980;--inline-marker-border-color:#5570b3d0}.ec.ec-2w87v .ec-line ins{--inline-marker-bg-color:#26561c80;--inline-marker-border-color:#4e7e41d0}.ec.ec-2w87v .ec-line del{--inline-marker-bg-color:#81322b80;--inline-marker-border-color:#ae594fd0}.ec.ec-2w87v .ec-line del,.ec.ec-2w87v .ec-line ins,.ec.ec-2w87v .ec-line mark{all:unset;display:inline-block;position:relative;--border:1.5px;--border-l:var(--border);--border-r:var(--border);--radius-l:0.2rem;--radius-r:0.2rem;margin-inline:0.025rem;padding-inline:0.15rem;border-radius:var(--radius-l) var(--radius-r) var(--radius-r) var(--radius-l);background:var(--inline-marker-bg-color);background-clip:padding-box}.ec.ec-2w87v .ec-line del.open-start,.ec.ec-2w87v .ec-line ins.open-start,.ec.ec-2w87v .ec-line mark.open-start{margin-inline-start:0;padding-inline-start:0;--border-l:0px;--radius-l:0}.ec.ec-2w87v .ec-line del.open-end,.ec.ec-2w87v .ec-line ins.open-end,.ec.ec-2w87v .ec-line mark.open-end{margin-inline-end:0;padding-inline-end:0;--border-r:0px;--radius-r:0}.ec.ec-2w87v .ec-line del::before,.ec.ec-2w87v .ec-line ins::before,.ec.ec-2w87v .ec-line mark::before{content:'';position:absolute;pointer-events:none;display:inline-block;inset:0;border-radius:var(--radius-l) var(--radius-r) var(--radius-r) var(--radius-l);border:var(--border) solid var(--inline-marker-border-color);border-inline-width:var(--border-l) var(--border-r)}.ec.ec-2w87v .astro-VXbRogkV{all:unset;position:relative;display:block;--header-border-radius:calc(0.3rem + 1.5px);--tab-border-radius:calc(0.3rem + 1.5px);--button-spacing:0.4rem;--code-background:#24292e;border-radius:var(--header-border-radius);box-shadow:.1rem .1rem .2rem #0000005b}.ec.ec-2w87v .astro-VXbRogkV .header{display:none;z-index:1;position:relative;border-radius:var(--header-border-radius) var(--header-border-radius) 0 0}.ec.ec-2w87v .frame.has-title code,.ec.ec-2w87v .frame.has-title pre,.ec.ec-2w87v .frame.is-terminal code,.ec.ec-2w87v .frame.is-terminal pre{border-top:none;border-top-left-radius:0;border-top-right-radius:0}.ec.ec-2w87v .astro-VXbRogkV .title:empty:before{content:'\a0'}.ec.ec-2w87v .frame.has-title:not(.is-terminal){--button-spacing:calc(1.9rem + 2 * (0.25rem + 1.5px))}.ec.ec-2w87v .frame.has-title:not(.is-terminal) .title{position:relative;color:#e1e4e8;background:#24292e;background-clip:padding-box;margin-block-start:0;padding:calc(.25rem + 1.5px) 1rem;border:1.5px solid transparent;border-radius:var(--tab-border-radius) var(--tab-border-radius) 0 0;border-bottom:none;overflow:hidden}.ec.ec-2w87v .frame.has-title:not(.is-terminal) .title::after{content:'';position:absolute;pointer-events:none;inset:0;border-top:1.5px solid #f9826c;border-bottom:1.5px solid #24292e}.ec.ec-2w87v .frame.has-title:not(.is-terminal) .header{display:flex;background:linear-gradient(to top,#1b1f23 1.5px,transparent 1.5px),linear-gradient(#1f2428,#1f2428);background-repeat:no-repeat;padding-inline-start:0}.ec.ec-2w87v .frame.has-title:not(.is-terminal) .header::before{content:'';position:absolute;pointer-events:none;inset:0;border:1.5px solid #1b1f23;border-radius:inherit;border-bottom:none}.ec.ec-2w87v .frame.is-terminal{--button-spacing:calc(1.9rem + 1.5px + 2 * 0.25rem);--code-background:#1f2428}.ec.ec-2w87v .frame.is-terminal .header{display:flex;align-items:center;justify-content:center;padding-block:0.25rem;padding-block-end:calc(0.25rem + 1.5px);position:relative;font-weight:500;letter-spacing:.025ch;color:#e1e4e8;background:#24292e;border:1.5px solid #1b1f23;border-bottom:none}.ec.ec-2w87v .frame.is-terminal .header::before{content:'';position:absolute;pointer-events:none;left:1rem;width:2.1rem;height:.56rem;line-height:0;background-color:#e1e4e8;opacity:.15;-webkit-mask-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 60 16' preserveAspectRatio='xMidYMid meet'%3E%3Ccircle cx='8' cy='8' r='8'/%3E%3Ccircle cx='30' cy='8' r='8'/%3E%3Ccircle cx='52' cy='8' r='8'/%3E%3C/svg%3E");-webkit-mask-repeat:no-repeat;mask-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 60 16' preserveAspectRatio='xMidYMid meet'%3E%3Ccircle cx='8' cy='8' r='8'/%3E%3Ccircle cx='30' cy='8' r='8'/%3E%3Ccircle cx='52' cy='8' r='8'/%3E%3C/svg%3E");mask-repeat:no-repeat}.ec.ec-2w87v .frame.is-terminal .header::after{content:'';position:absolute;pointer-events:none;inset:0;border-bottom:1.5px solid #1b1f23}.ec.ec-2w87v .astro-VXbRogkV pre{background:var(--code-background)}.ec.ec-2w87v .copy{display:flex;gap:.25rem;flex-direction:row;position:absolute;inset-block-start:calc(1.5px + var(--button-spacing));inset-inline-end:calc(1.5px + 1rem / 2);direction:ltr;unicode-bidi:isolate}.ec.ec-2w87v .copy button{position:relative;align-self:flex-end;margin:0;padding:0;border:none;border-radius:.2rem;z-index:1;cursor:pointer;transition-property:opacity,background,border-color;transition-duration:.2s;transition-timing-function:cubic-bezier(0.25,0.46,0.45,0.94);width:2.5rem;height:2.5rem;background:var(--code-background);opacity:.75}.ec.ec-2w87v .copy button div{position:absolute;inset:0;border-radius:inherit;background:#e1e4e8;opacity:0;transition-property:inherit;transition-duration:inherit;transition-timing-function:inherit}.ec.ec-2w87v .copy button::before{content:'';position:absolute;pointer-events:none;inset:0;border-radius:inherit;border:1.5px solid #e1e4e8;opacity:.4}.ec.ec-2w87v .copy button::after{content:'';position:absolute;pointer-events:none;inset:0;background-color:#e1e4e8;-webkit-mask-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='1.75'%3E%3Cpath d='M3 19a2 2 0 0 1-1-2V2a2 2 0 0 1 1-1h13a2 2 0 0 1 2 1'/%3E%3Crect x='6' y='5' width='16' height='18' rx='1.5' ry='1.5'/%3E%3C/svg%3E");-webkit-mask-repeat:no-repeat;mask-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='black' stroke-width='1.75'%3E%3Cpath d='M3 19a2 2 0 0 1-1-2V2a2 2 0 0 1 1-1h13a2 2 0 0 1 2 1'/%3E%3Crect x='6' y='5' width='16' height='18' rx='1.5' ry='1.5'/%3E%3C/svg%3E");mask-repeat:no-repeat;margin:.475rem;line-height:0}.ec.ec-2w87v .copy button:focus:focus-visible,.ec.ec-2w87v .copy button:hover{opacity:1}.ec.ec-2w87v .copy button:focus:focus-visible div,.ec.ec-2w87v .copy button:hover div{opacity:.2}.ec.ec-2w87v .copy button:active{opacity:1}.ec.ec-2w87v .copy button:active div{opacity:.3}.ec.ec-2w87v .copy .feedback{--tooltip-arrow-size:0.35rem;--tooltip-bg:#228739;color:#fff;pointer-events:none;user-select:none;-webkit-user-select:none;position:relative;align-self:center;background-color:var(--tooltip-bg);z-index:99;padding:.125rem .75rem;border-radius:.2rem;margin-inline-end:var(--tooltip-arrow-size);opacity:0;transition-property:opacity,transform;transition-duration:.2s;transition-timing-function:ease-in-out;transform:translate3d(0,.25rem,0)}.ec.ec-2w87v .copy .feedback::after{content:'';position:absolute;pointer-events:none;top:calc(50% - var(--tooltip-arrow-size));inset-inline-end:calc(-2 * (var(--tooltip-arrow-size) - 0.5px));border:var(--tooltip-arrow-size) solid transparent;border-inline-start-color:var(--tooltip-bg)}.ec.ec-2w87v .copy .feedback.show{opacity:1;transform:translate3d(0,0,0)}@media (hover:hover){.ec.ec-2w87v .copy button{opacity:0;width:2rem;height:2rem}.ec.ec-2w87v .astro-VXbRogkV .copy .feedback.show~button:not(:hover),.ec.ec-2w87v .frame:focus-within :focus-visible~.copy button:not(:hover),.ec.ec-2w87v .frame:hover .copy button:not(:hover){opacity:.75}}</style><figure class="astro-VXbRogkV has-title"><figcaption class=header><span class=title>main.go</span></figcaption><pre tabindex=0><code><div class=ec-line><span style=color:#f97583>type</span><span style=color:#e1e4e8> </span><span style=color:#b392f0>Server</span><span style=color:#e1e4e8> </span><span style=color:#f97583>struct</span><span style=color:#e1e4e8> {</span></div><div class=ec-line><span style=color:#e1e4e8>  session </span><span style=color:#f97583>*</span><span style=color:#e1e4e8>scs.SessionManager</span></div><div class=ec-line><span style=color:#e1e4e8>  router  </span><span style=color:#f97583>*</span><span style=color:#e1e4e8>chi.Mux</span></div><div class=ec-line><span style=color:#e1e4e8>}</span></div></code></pre><div class=copy><button data-code="type Server struct {  session *scs.SessionManager  router  *chi.Mux}" data-copied=Copied! title="Copy to clipboard"><div></div></button></div></figure></div><p>And now, create our main function, session, router and server</p><div class="ec ec-2w87v ec-theme-github-dark expressive-code"><figure class="astro-VXbRogkV has-title"><figcaption class=header><span class=title>main.go</span></figcaption><pre tabindex=0><code><div class=ec-line><span style=color:#f97583>type</span><span style=color:#e1e4e8> </span><span style=color:#b392f0>Server</span><span style=color:#e1e4e8> </span><span style=color:#f97583>struct</span><span style=color:#e1e4e8> {</span></div><div class=ec-line><span style=color:#e1e4e8>  session </span><span style=color:#f97583>*</span><span style=color:#e1e4e8>scs.SessionManager</span></div><div class=ec-line><span style=color:#e1e4e8>  router  </span><span style=color:#f97583>*</span><span style=color:#e1e4e8>chi.Mux</span></div><div class=ec-line><span style=color:#e1e4e8>}</span></div><div class=ec-line>
</div><div class=ec-line><span style=color:#f97583>func</span><span style=color:#e1e4e8> </span><span style=color:#b392f0>main</span><span style=color:#e1e4e8>() {</span></div><div class=ec-line><span style=color:#e1e4e8>  session </span><span style=color:#f97583>:=</span><span style=color:#e1e4e8> scs.</span><span style=color:#79b8ff>New</span><span style=color:#e1e4e8>()</span></div><div class=ec-line><span style=color:#e1e4e8>  router </span><span style=color:#f97583>:=</span><span style=color:#e1e4e8> chi.</span><span style=color:#79b8ff>NewRouter</span><span style=color:#e1e4e8>()</span></div><div class=ec-line><span style=color:#e1e4e8>  server </span><span style=color:#f97583>:=</span><span style=color:#e1e4e8> </span><span style=color:#f97583>&#x26;</span><span style=color:#e1e4e8>Server{</span></div><div class=ec-line><span style=color:#e1e4e8>    session: session,</span></div><div class=ec-line><span style=color:#e1e4e8>    router:  router,</span></div><div class=ec-line><span style=color:#e1e4e8>  }</span></div><div class=ec-line>
</div><div class=ec-line><span style=color:#e1e4e8>  router.</span><span style=color:#79b8ff>Use</span><span style=color:#e1e4e8>(session.LoadAndSave)</span></div><div class=ec-line><span style=color:#e1e4e8>}</span></div></code></pre><div class=copy><button data-code="type Server struct {  session *scs.SessionManager  router  *chi.Mux}func main() {  session := scs.New()  router := chi.NewRouter()  server := &#x26;Server{    session: session,    router:  router,  }  router.Use(session.LoadAndSave)}" data-copied=Copied! title="Copy to clipboard"><div></div></button></div></figure></div><div class="astro-sRCLXbiL astro-omYPbgTI"><p>Note that we are defining the <code>LoadAndSave</code> middleware from the SCS session. This middleware will get the value from the cookie and save into our request context.</p></div><h2 id=server-routes>Server routes<a href=#server-routes class=astro-XmVVtUzC aria-hidden="" tabindex=-1><svg viewBox="0 0 24 24" width=18 height=18 class=autolink-svg fill=currentColor marginLeft=1rem xmlns=http://www.w3.org/2000/svg><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h2><p>We can now define two routes:</p><ul><li>/ - Will return 200 (Ok) with the message “Hello, World!” and insert an <code>user_role</code> value into our context</li><li>/admin - Will return 200 (Ok) with the message “Hello, &#x3C;role>!”</li></ul><div class="astro-sRCLXbiL astro-DKNRxEfz"><p>If we request the <code>/admin</code> endpoint before requesting the root endpoint, we should get an 401 (Unauthorized) status code.</p></div><p>Let’s implement all handlers:</p><div class="ec ec-2w87v ec-theme-github-dark expressive-code"><figure class="astro-VXbRogkV has-title"><figcaption class=header><span class=title>main.go</span></figcaption><pre tabindex=0><code><div class=ec-line><span style=color:#f97583>func</span><span style=color:#e1e4e8> (s </span><span style=color:#f97583>*</span><span style=color:#e1e4e8>Server) </span><span style=color:#b392f0>handleHelloWorld</span><span style=color:#e1e4e8>(w http.ResponseWriter, r </span><span style=color:#f97583>*</span><span style=color:#e1e4e8>http.Request) {</span></div><div class=ec-line><span style=color:#e1e4e8>  </span><span style=color:#6a737d>// Save "ADMIN" value into "user_role"</span></div><div class=ec-line><span style=color:#e1e4e8>  s.session.</span><span style=color:#79b8ff>Put</span><span style=color:#e1e4e8>(r.</span><span style=color:#79b8ff>Context</span><span style=color:#e1e4e8>(), </span><span style=color:#9ecbff>"user_role"</span><span style=color:#e1e4e8>, </span><span style=color:#9ecbff>"ADMIN"</span><span style=color:#e1e4e8>)</span></div><div class=ec-line>
</div><div class=ec-line><span style=color:#e1e4e8>  </span><span style=color:#6a737d>// Send the message (By default, will send a 200 status code)</span></div><div class=ec-line><span style=color:#e1e4e8>  w.</span><span style=color:#79b8ff>Write</span><span style=color:#e1e4e8>([]</span><span style=color:#79b8ff>byte</span><span style=color:#e1e4e8>(</span><span style=color:#9ecbff>"Hello, World!"</span><span style=color:#e1e4e8>))</span></div><div class=ec-line><span style=color:#e1e4e8>}</span></div><div class=ec-line>
</div><div class=ec-line><span style=color:#f97583>func</span><span style=color:#e1e4e8> (s </span><span style=color:#f97583>*</span><span style=color:#e1e4e8>Server) </span><span style=color:#b392f0>handleAdmin</span><span style=color:#e1e4e8>(w http.ResponseWriter, r </span><span style=color:#f97583>*</span><span style=color:#e1e4e8>http.Request) {</span></div><div class=ec-line><span style=color:#e1e4e8>  </span><span style=color:#6a737d>// Get the "user_role" value from request context</span></div><div class=ec-line><span style=color:#e1e4e8>  role </span><span style=color:#f97583>:=</span><span style=color:#e1e4e8> s.session.</span><span style=color:#79b8ff>GetString</span><span style=color:#e1e4e8>(r.</span><span style=color:#79b8ff>Context</span><span style=color:#e1e4e8>(), </span><span style=color:#9ecbff>"user_role"</span><span style=color:#e1e4e8>)</span></div><div class=ec-line>
</div><div class=ec-line><span style=color:#e1e4e8>  </span><span style=color:#6a737d>// By default, GetString will return an empty string if no value is found</span></div><div class=ec-line><span style=color:#e1e4e8>  </span><span style=color:#f97583>if</span><span style=color:#e1e4e8> role </span><span style=color:#f97583>==</span><span style=color:#e1e4e8> </span><span style=color:#9ecbff>""</span><span style=color:#e1e4e8> {</span></div><div class=ec-line><span style=color:#e1e4e8>    w.</span><span style=color:#79b8ff>WriteHeader</span><span style=color:#e1e4e8>(http.StatusUnauthorized)</span></div><div class=ec-line><span style=color:#e1e4e8>    </span><span style=color:#f97583>return</span></div><div class=ec-line><span style=color:#e1e4e8>  }</span></div><div class=ec-line>
</div><div class=ec-line><span style=color:#e1e4e8>  </span><span style=color:#6a737d>// Send the message (By default, will send a 200 status code)</span></div><div class=ec-line><span style=color:#e1e4e8>  w.</span><span style=color:#79b8ff>Write</span><span style=color:#e1e4e8>([]</span><span style=color:#79b8ff>byte</span><span style=color:#e1e4e8>(</span><span style=color:#9ecbff>"Welcome, "</span><span style=color:#e1e4e8> </span><span style=color:#f97583>+</span><span style=color:#e1e4e8> role </span><span style=color:#f97583>+</span><span style=color:#e1e4e8> </span><span style=color:#9ecbff>"!"</span><span style=color:#e1e4e8>))</span></div><div class=ec-line><span style=color:#e1e4e8>}</span></div></code></pre><div class=copy><button data-code="func (s *Server) handleHelloWorld(w http.ResponseWriter, r *http.Request) {  // Save &#x22;ADMIN&#x22; value into &#x22;user_role&#x22;  s.session.Put(r.Context(), &#x22;user_role&#x22;, &#x22;ADMIN&#x22;)  // Send the message (By default, will send a 200 status code)  w.Write([]byte(&#x22;Hello, World!&#x22;))}func (s *Server) handleAdmin(w http.ResponseWriter, r *http.Request) {  // Get the &#x22;user_role&#x22; value from request context  role := s.session.GetString(r.Context(), &#x22;user_role&#x22;)  // By default, GetString will return an empty string if no value is found  if role == &#x22;&#x22; {    w.WriteHeader(http.StatusUnauthorized)    return  }  // Send the message (By default, will send a 200 status code)  w.Write([]byte(&#x22;Welcome, &#x22; + role + &#x22;!&#x22;))}" data-copied=Copied! title="Copy to clipboard"><div></div></button></div></figure></div><p>Defining the handlers into router:</p><div class="ec ec-2w87v ec-theme-github-dark expressive-code"><figure class="astro-VXbRogkV has-title"><figcaption class=header><span class=title>main.go</span></figcaption><pre tabindex=0><code><div class=ec-line><span style=color:#f97583>type</span><span style=color:#e1e4e8> </span><span style=color:#b392f0>Server</span><span style=color:#e1e4e8> </span><span style=color:#f97583>struct</span><span style=color:#e1e4e8> {</span></div><div class=ec-line><span style=color:#e1e4e8>  session </span><span style=color:#f97583>*</span><span style=color:#e1e4e8>scs.SessionManager</span></div><div class=ec-line><span style=color:#e1e4e8>  router  </span><span style=color:#f97583>*</span><span style=color:#e1e4e8>chi.Mux</span></div><div class=ec-line><span style=color:#e1e4e8>}</span></div><div class=ec-line>
</div><div class=ec-line><span style=color:#f97583>func</span><span style=color:#e1e4e8> </span><span style=color:#b392f0>main</span><span style=color:#e1e4e8>() {</span></div><div class=ec-line><span style=color:#e1e4e8>  session </span><span style=color:#f97583>:=</span><span style=color:#e1e4e8> scs.</span><span style=color:#79b8ff>New</span><span style=color:#e1e4e8>()</span></div><div class=ec-line><span style=color:#e1e4e8>  router </span><span style=color:#f97583>:=</span><span style=color:#e1e4e8> chi.</span><span style=color:#79b8ff>NewRouter</span><span style=color:#e1e4e8>()</span></div><div class=ec-line><span style=color:#e1e4e8>  server </span><span style=color:#f97583>:=</span><span style=color:#e1e4e8> </span><span style=color:#f97583>&#x26;</span><span style=color:#e1e4e8>Server{</span></div><div class=ec-line><span style=color:#e1e4e8>    session: session,</span></div><div class=ec-line><span style=color:#e1e4e8>    router:  router,</span></div><div class=ec-line><span style=color:#e1e4e8>  }</span></div><div class=ec-line>
</div><div class=ec-line><span style=color:#e1e4e8>  router.</span><span style=color:#79b8ff>Use</span><span style=color:#e1e4e8>(session.LoadAndSave)</span></div><div class=ec-line>
</div><div class="ec-line mark"><span style=color:#e1e4e8>  </span><span style=color:#b0b5ba>// Routes</span></div><div class="ec-line mark"><span style=color:#e1e4e8>  router.</span><span style=color:#79b8ff>Get</span><span style=color:#e1e4e8>(</span><span style=color:#9ecbff>"/"</span><span style=color:#e1e4e8>, server.handleHelloWorld)</span></div><div class="ec-line mark"><span style=color:#e1e4e8>  router.</span><span style=color:#79b8ff>Group</span><span style=color:#e1e4e8>(</span><span style=color:#fb99a3>func</span><span style=color:#e1e4e8>(router chi.Router) {</span></div><div class="ec-line mark"><span style=color:#e1e4e8>    router.</span><span style=color:#79b8ff>Get</span><span style=color:#e1e4e8>(</span><span style=color:#9ecbff>"/admin"</span><span style=color:#e1e4e8>, server.handleAdmin)</span></div><div class="ec-line mark"><span style=color:#e1e4e8>  })</span></div><div class=ec-line>
</div><div class=ec-line><span style=color:#e1e4e8>  http.</span><span style=color:#79b8ff>ListenAndServe</span><span style=color:#e1e4e8>(</span><span style=color:#9ecbff>":6987"</span><span style=color:#e1e4e8>, router)</span></div><div class=ec-line><span style=color:#e1e4e8>}</span></div><div class=ec-line>
</div><div class="ec-line mark"><span style=color:#fb99a3>func</span><span style=color:#e1e4e8> (s </span><span style=color:#fb99a3>*</span><span style=color:#e1e4e8>Server) </span><span style=color:#c2a8f3>handleHelloWorld</span><span style=color:#e1e4e8>(w http.ResponseWriter, r </span><span style=color:#fb99a3>*</span><span style=color:#e1e4e8>http.Request) {</span></div><div class="ec-line mark"><span style=color:#e1e4e8>  </span><span style=color:#b0b5ba>// Save "ADMIN" value into "user_role"</span></div><div class="ec-line mark"><span style=color:#e1e4e8>  s.session.</span><span style=color:#79b8ff>Put</span><span style=color:#e1e4e8>(r.</span><span style=color:#79b8ff>Context</span><span style=color:#e1e4e8>(), </span><span style=color:#9ecbff>"user_role"</span><span style=color:#e1e4e8>, </span><span style=color:#9ecbff>"ADMIN"</span><span style=color:#e1e4e8>)</span></div><div class="ec-line mark">
</div><div class="ec-line mark"><span style=color:#e1e4e8>  </span><span style=color:#b0b5ba>// Send the message (By default, will send a 200 status code)</span></div><div class="ec-line mark"><span style=color:#e1e4e8>  w.</span><span style=color:#79b8ff>Write</span><span style=color:#e1e4e8>([]</span><span style=color:#79b8ff>byte</span><span style=color:#e1e4e8>(</span><span style=color:#9ecbff>"Hello, World!"</span><span style=color:#e1e4e8>))</span></div><div class="ec-line mark"><span style=color:#e1e4e8>}</span></div><div class="ec-line mark">
</div><div class="ec-line mark"><span style=color:#fb99a3>func</span><span style=color:#e1e4e8> (s </span><span style=color:#fb99a3>*</span><span style=color:#e1e4e8>Server) </span><span style=color:#c2a8f3>handleAdmin</span><span style=color:#e1e4e8>(w http.ResponseWriter, r </span><span style=color:#fb99a3>*</span><span style=color:#e1e4e8>http.Request) {</span></div><div class="ec-line mark"><span style=color:#e1e4e8>  </span><span style=color:#b0b5ba>// Get the "user_role" value from request context</span></div><div class="ec-line mark"><span style=color:#e1e4e8>  role </span><span style=color:#fb99a3>:=</span><span style=color:#e1e4e8> s.session.</span><span style=color:#79b8ff>GetString</span><span style=color:#e1e4e8>(r.</span><span style=color:#79b8ff>Context</span><span style=color:#e1e4e8>(), </span><span style=color:#9ecbff>"user_role"</span><span style=color:#e1e4e8>)</span></div><div class="ec-line mark">
</div><div class="ec-line mark"><span style=color:#e1e4e8>  </span><span style=color:#b0b5ba>// By default, GetString will return an empty string if no value is found</span></div><div class="ec-line mark"><span style=color:#e1e4e8>  </span><span style=color:#fb99a3>if</span><span style=color:#e1e4e8> role </span><span style=color:#fb99a3>==</span><span style=color:#e1e4e8> </span><span style=color:#9ecbff>""</span><span style=color:#e1e4e8> {</span></div><div class="ec-line mark"><span style=color:#e1e4e8>    w.</span><span style=color:#79b8ff>WriteHeader</span><span style=color:#e1e4e8>(http.StatusUnauthorized)</span></div><div class="ec-line mark"><span style=color:#e1e4e8>    </span><span style=color:#fb99a3>return</span></div><div class="ec-line mark"><span style=color:#e1e4e8>  }</span></div><div class="ec-line mark">
</div><div class="ec-line mark"><span style=color:#e1e4e8>  </span><span style=color:#b0b5ba>// Send the message (By default, will send a 200 status code)</span></div><div class="ec-line mark"><span style=color:#e1e4e8>  w.</span><span style=color:#79b8ff>Write</span><span style=color:#e1e4e8>([]</span><span style=color:#79b8ff>byte</span><span style=color:#e1e4e8>(</span><span style=color:#9ecbff>"Welcome, "</span><span style=color:#e1e4e8> </span><span style=color:#fb99a3>+</span><span style=color:#e1e4e8> role </span><span style=color:#fb99a3>+</span><span style=color:#e1e4e8> </span><span style=color:#9ecbff>"!"</span><span style=color:#e1e4e8>))</span></div><div class="ec-line mark"><span style=color:#e1e4e8>}</span></div></code></pre><div class=copy><button data-code="type Server struct {  session *scs.SessionManager  router  *chi.Mux}func main() {  session := scs.New()  router := chi.NewRouter()  server := &#x26;Server{    session: session,    router:  router,  }  router.Use(session.LoadAndSave)  // Routes  router.Get(&#x22;/&#x22;, server.handleHelloWorld)  router.Group(func(router chi.Router) {    router.Get(&#x22;/admin&#x22;, server.handleAdmin)  })  http.ListenAndServe(&#x22;:6987&#x22;, router)}func (s *Server) handleHelloWorld(w http.ResponseWriter, r *http.Request) {  // Save &#x22;ADMIN&#x22; value into &#x22;user_role&#x22;  s.session.Put(r.Context(), &#x22;user_role&#x22;, &#x22;ADMIN&#x22;)  // Send the message (By default, will send a 200 status code)  w.Write([]byte(&#x22;Hello, World!&#x22;))}func (s *Server) handleAdmin(w http.ResponseWriter, r *http.Request) {  // Get the &#x22;user_role&#x22; value from request context  role := s.session.GetString(r.Context(), &#x22;user_role&#x22;)  // By default, GetString will return an empty string if no value is found  if role == &#x22;&#x22; {    w.WriteHeader(http.StatusUnauthorized)    return  }  // Send the message (By default, will send a 200 status code)  w.Write([]byte(&#x22;Welcome, &#x22; + role + &#x22;!&#x22;))}" data-copied=Copied! title="Copy to clipboard"><div></div></button></div></figure></div><h2 id=middleware-for-user-authorization>Middleware for user authorization<a href=#middleware-for-user-authorization class=astro-XmVVtUzC aria-hidden="" tabindex=-1><svg viewBox="0 0 24 24" width=18 height=18 class=autolink-svg fill=currentColor marginLeft=1rem xmlns=http://www.w3.org/2000/svg><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h2><p>To complete our simple GoLang server, we need a middleware for handling user authorization</p><div class="ec ec-2w87v ec-theme-github-dark expressive-code"><figure class="astro-VXbRogkV has-title"><figcaption class=header><span class=title>main.go</span></figcaption><pre tabindex=0><code><div class=ec-line><span style=color:#f97583>func</span><span style=color:#e1e4e8> (s </span><span style=color:#f97583>*</span><span style=color:#e1e4e8>Server) </span><span style=color:#b392f0>RequireAdmin</span><span style=color:#e1e4e8>(next http.Handler) http.Handler {</span></div><div class=ec-line><span style=color:#e1e4e8>  </span><span style=color:#f97583>return</span><span style=color:#e1e4e8> http.</span><span style=color:#79b8ff>HandlerFunc</span><span style=color:#e1e4e8>(</span><span style=color:#f97583>func</span><span style=color:#e1e4e8>(w http.ResponseWriter, r </span><span style=color:#f97583>*</span><span style=color:#e1e4e8>http.Request) {</span></div><div class=ec-line><span style=color:#e1e4e8>    </span><span style=color:#6a737d>// Get "user_role" value and validate</span></div><div class=ec-line><span style=color:#e1e4e8>    </span><span style=color:#f97583>if</span><span style=color:#e1e4e8> s.session.</span><span style=color:#79b8ff>GetString</span><span style=color:#e1e4e8>(r.</span><span style=color:#79b8ff>Context</span><span style=color:#e1e4e8>(), </span><span style=color:#9ecbff>"user_role"</span><span style=color:#e1e4e8>) </span><span style=color:#f97583>!=</span><span style=color:#e1e4e8> </span><span style=color:#9ecbff>"ADMIN"</span><span style=color:#e1e4e8> {</span></div><div class=ec-line><span style=color:#e1e4e8>      w.</span><span style=color:#79b8ff>WriteHeader</span><span style=color:#e1e4e8>(http.StatusUnauthorized)</span></div><div class=ec-line><span style=color:#e1e4e8>      </span><span style=color:#f97583>return</span></div><div class=ec-line><span style=color:#e1e4e8>    }</span></div><div class=ec-line>
</div><div class=ec-line><span style=color:#e1e4e8>    next.</span><span style=color:#79b8ff>ServeHTTP</span><span style=color:#e1e4e8>(w, r)</span></div><div class=ec-line><span style=color:#e1e4e8>  })</span></div><div class=ec-line><span style=color:#e1e4e8>}</span></div></code></pre><div class=copy><button data-code="func (s *Server) RequireAdmin(next http.Handler) http.Handler {  return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {    // Get &#x22;user_role&#x22; value and validate    if s.session.GetString(r.Context(), &#x22;user_role&#x22;) != &#x22;ADMIN&#x22; {      w.WriteHeader(http.StatusUnauthorized)      return    }    next.ServeHTTP(w, r)  })}" data-copied=Copied! title="Copy to clipboard"><div></div></button></div></figure></div><p>We’ll use this middleware inside the <code>router.Group</code></p><div class="ec ec-2w87v ec-theme-github-dark expressive-code"><figure class="astro-VXbRogkV has-title"><figcaption class=header><span class=title>main.go</span></figcaption><pre tabindex=0><code><div class=ec-line><span style=color:#6a737d>// Routes</span></div><div class=ec-line><span style=color:#e1e4e8>router.</span><span style=color:#79b8ff>Get</span><span style=color:#e1e4e8>(</span><span style=color:#9ecbff>"/"</span><span style=color:#e1e4e8>, server.handleHelloWorld)</span></div><div class=ec-line><span style=color:#e1e4e8>router.</span><span style=color:#79b8ff>Group</span><span style=color:#e1e4e8>(</span><span style=color:#f97583>func</span><span style=color:#e1e4e8>(router chi.Router) {</span></div><div class="ec-line mark"><span style=color:#e1e4e8>  router.</span><span style=color:#79b8ff>Use</span><span style=color:#e1e4e8>(server.RequireAdmin)</span></div><div class=ec-line><span style=color:#e1e4e8>  router.</span><span style=color:#79b8ff>Get</span><span style=color:#e1e4e8>(</span><span style=color:#9ecbff>"/admin"</span><span style=color:#e1e4e8>, server.handleAdmin)</span></div><div class=ec-line><span style=color:#e1e4e8>})</span></div></code></pre><div class=copy><button data-code="// Routesrouter.Get(&#x22;/&#x22;, server.handleHelloWorld)router.Group(func(router chi.Router) {  router.Use(server.RequireAdmin)  router.Get(&#x22;/admin&#x22;, server.handleAdmin)})" data-copied=Copied! title="Copy to clipboard"><div></div></button></div></figure></div><h2 id=the-testing>The testing<a href=#the-testing class=astro-XmVVtUzC aria-hidden="" tabindex=-1><svg viewBox="0 0 24 24" width=18 height=18 class=autolink-svg fill=currentColor marginLeft=1rem xmlns=http://www.w3.org/2000/svg><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h2><p>Now, the testing part.</p><p>Our test will have four paths:</p><ul><li>Public endpoint that will return <code class="remark-text-highlight endpointOk1" style=background-color:green;color:#fff>200 (Ok)</code></li><li>Admin endpoint <strong>without role</strong> that will return <code class="remark-text-highlight endpointUnauthorized1" style=background-color:#daa520;color:#fff>401 (Unauthorized)</code></li><li>Admin endpoint <strong>with wrong role</strong> that will return <code class="remark-text-highlight endpointUnauthorized2" style=background-color:#daa520;color:#fff>401 (Unauthorized)</code></li><li>Admin endpoint <strong>with correct role</strong> that will return <code class="remark-text-highlight endpointOk2" style=background-color:green;color:#fff>200 (Ok)</code></li></ul><div class="ec ec-2w87v ec-theme-github-dark expressive-code"><figure class="astro-VXbRogkV has-title"><figcaption class=header><span class=title>main_test.go</span></figcaption><pre tabindex=0><code><div class=ec-line><span style=color:#f97583>func</span><span style=color:#e1e4e8> </span><span style=color:#b392f0>Test_main</span><span style=color:#e1e4e8>(t </span><span style=color:#f97583>*</span><span style=color:#e1e4e8>testing.T) {</span></div><div class=ec-line><span style=color:#e1e4e8>  tests </span><span style=color:#f97583>:=</span><span style=color:#e1e4e8> []</span><span style=color:#f97583>struct</span><span style=color:#e1e4e8> {</span></div><div class=ec-line><span style=color:#e1e4e8>    name     </span><span style=color:#f97583>string</span></div><div class=ec-line><span style=color:#e1e4e8>    url      </span><span style=color:#f97583>string</span></div><div class=ec-line><span style=color:#e1e4e8>    role     </span><span style=color:#f97583>string</span></div><div class=ec-line><span style=color:#e1e4e8>    wantCode </span><span style=color:#f97583>int</span></div><div class=ec-line><span style=color:#e1e4e8>  }{</span></div><div class=ec-line><span style=color:#e1e4e8>    {</span></div><div class=ec-line><span style=color:#e1e4e8>      name:     </span><span style=color:#9ecbff>"public endpoint"</span><span style=color:#e1e4e8>,</span></div><div class=ec-line><span style=color:#e1e4e8>      url:      </span><span style=color:#9ecbff>"/"</span><span style=color:#e1e4e8>,</span></div><div class=ec-line><span style=color:#e1e4e8>      wantCode: http.StatusOK,</span></div><div class=ec-line><span style=color:#e1e4e8>    },</span></div><div class=ec-line><span style=color:#e1e4e8>    {</span></div><div class=ec-line><span style=color:#e1e4e8>      name:     </span><span style=color:#9ecbff>"admin endpoint without role"</span><span style=color:#e1e4e8>,</span></div><div class=ec-line><span style=color:#e1e4e8>      url:      </span><span style=color:#9ecbff>"/admin"</span><span style=color:#e1e4e8>,</span></div><div class=ec-line><span style=color:#e1e4e8>      wantCode: http.StatusUnauthorized,</span></div><div class=ec-line><span style=color:#e1e4e8>    },</span></div><div class=ec-line><span style=color:#e1e4e8>    {</span></div><div class=ec-line><span style=color:#e1e4e8>      name:     </span><span style=color:#9ecbff>"admin endpoint with wrong role"</span><span style=color:#e1e4e8>,</span></div><div class=ec-line><span style=color:#e1e4e8>      url:      </span><span style=color:#9ecbff>"/admin"</span><span style=color:#e1e4e8>,</span></div><div class=ec-line><span style=color:#e1e4e8>      role:     </span><span style=color:#9ecbff>"OTHER"</span><span style=color:#e1e4e8>,</span></div><div class=ec-line><span style=color:#e1e4e8>      wantCode: http.StatusUnauthorized,</span></div><div class=ec-line><span style=color:#e1e4e8>    },</span></div><div class=ec-line><span style=color:#e1e4e8>    {</span></div><div class=ec-line><span style=color:#e1e4e8>      name:     </span><span style=color:#9ecbff>"admin endpoint with correct role"</span><span style=color:#e1e4e8>,</span></div><div class=ec-line><span style=color:#e1e4e8>      url:      </span><span style=color:#9ecbff>"/admin"</span><span style=color:#e1e4e8>,</span></div><div class=ec-line><span style=color:#e1e4e8>      role:     </span><span style=color:#9ecbff>"ADMIN"</span><span style=color:#e1e4e8>,</span></div><div class=ec-line><span style=color:#e1e4e8>      wantCode: http.StatusOK,</span></div><div class=ec-line><span style=color:#e1e4e8>    },</span></div><div class=ec-line><span style=color:#e1e4e8>  }</span></div><div class=ec-line><span style=color:#e1e4e8>  </span><span style=color:#f97583>for</span><span style=color:#e1e4e8> _, tt </span><span style=color:#f97583>:=</span><span style=color:#e1e4e8> </span><span style=color:#f97583>range</span><span style=color:#e1e4e8> tests {</span></div><div class=ec-line><span style=color:#e1e4e8>    t.</span><span style=color:#79b8ff>Run</span><span style=color:#e1e4e8>(tt.name, </span><span style=color:#f97583>func</span><span style=color:#e1e4e8>(t </span><span style=color:#f97583>*</span><span style=color:#e1e4e8>testing.T) {</span></div><div class=ec-line><span style=color:#e1e4e8>      </span><span style=color:#6a737d>// TODO: Add test logic here</span></div><div class=ec-line><span style=color:#e1e4e8>    })</span></div><div class=ec-line><span style=color:#e1e4e8>  }</span></div><div class=ec-line><span style=color:#e1e4e8>}</span></div></code></pre><div class=copy><button data-code="func Test_main(t *testing.T) {  tests := []struct {    name     string    url      string    role     string    wantCode int  }{    {      name:     &#x22;public endpoint&#x22;,      url:      &#x22;/&#x22;,      wantCode: http.StatusOK,    },    {      name:     &#x22;admin endpoint without role&#x22;,      url:      &#x22;/admin&#x22;,      wantCode: http.StatusUnauthorized,    },    {      name:     &#x22;admin endpoint with wrong role&#x22;,      url:      &#x22;/admin&#x22;,      role:     &#x22;OTHER&#x22;,      wantCode: http.StatusUnauthorized,    },    {      name:     &#x22;admin endpoint with correct role&#x22;,      url:      &#x22;/admin&#x22;,      role:     &#x22;ADMIN&#x22;,      wantCode: http.StatusOK,    },  }  for _, tt := range tests {    t.Run(tt.name, func(t *testing.T) {      // TODO: Add test logic here    })  }}" data-copied=Copied! title="Copy to clipboard"><div></div></button></div></figure></div><p>Implementing the first part of the test logic <strong>(server configuration)</strong>:</p><div class="ec ec-2w87v ec-theme-github-dark expressive-code"><figure class="astro-VXbRogkV has-title"><figcaption class=header><span class=title>main_test.go</span></figcaption><pre tabindex=0><code><div class=ec-line><span style=color:#6a737d>// Set up</span></div><div class=ec-line><span style=color:#e1e4e8>session </span><span style=color:#f97583>:=</span><span style=color:#e1e4e8> scs.</span><span style=color:#79b8ff>New</span><span style=color:#e1e4e8>()</span></div><div class=ec-line><span style=color:#e1e4e8>router </span><span style=color:#f97583>:=</span><span style=color:#e1e4e8> chi.</span><span style=color:#79b8ff>NewRouter</span><span style=color:#e1e4e8>()</span></div><div class=ec-line><span style=color:#e1e4e8>server </span><span style=color:#f97583>:=</span><span style=color:#e1e4e8> </span><span style=color:#f97583>&#x26;</span><span style=color:#e1e4e8>Server{</span></div><div class=ec-line><span style=color:#e1e4e8>    session: session,</span></div><div class=ec-line><span style=color:#e1e4e8>    router:  router,</span></div><div class=ec-line><span style=color:#e1e4e8>}</span></div><div class=ec-line>
</div><div class=ec-line><span style=color:#6a737d>// TODO: Implement session middleware</span></div><div class=ec-line>
</div><div class=ec-line><span style=color:#6a737d>// Routes</span></div><div class=ec-line><span style=color:#e1e4e8>router.</span><span style=color:#79b8ff>Get</span><span style=color:#e1e4e8>(</span><span style=color:#9ecbff>"/"</span><span style=color:#e1e4e8>, server.handleHelloWorld)</span></div><div class=ec-line><span style=color:#e1e4e8>router.</span><span style=color:#79b8ff>Group</span><span style=color:#e1e4e8>(</span><span style=color:#f97583>func</span><span style=color:#e1e4e8>(router chi.Router) {</span></div><div class=ec-line><span style=color:#e1e4e8>  router.</span><span style=color:#79b8ff>Use</span><span style=color:#e1e4e8>(server.RequireAdmin)</span></div><div class=ec-line><span style=color:#e1e4e8>  router.</span><span style=color:#79b8ff>Get</span><span style=color:#e1e4e8>(</span><span style=color:#9ecbff>"/admin"</span><span style=color:#e1e4e8>, server.handleAdmin)</span></div><div class=ec-line><span style=color:#e1e4e8>})</span></div></code></pre><div class=copy><button data-code="// Set upsession := scs.New()router := chi.NewRouter()server := &#x26;Server{    session: session,    router:  router,}// TODO: Implement session middleware// Routesrouter.Get(&#x22;/&#x22;, server.handleHelloWorld)router.Group(func(router chi.Router) {  router.Use(server.RequireAdmin)  router.Get(&#x22;/admin&#x22;, server.handleAdmin)})" data-copied=Copied! title="Copy to clipboard"><div></div></button></div></figure></div><p>Second part of the test logic <strong>(http request and status validation)</strong>:</p><div class="ec ec-2w87v ec-theme-github-dark expressive-code"><figure class="astro-VXbRogkV has-title"><figcaption class=header><span class=title>main_test.go</span></figcaption><pre tabindex=0><code><div class=ec-line><span style=color:#6a737d>// Request</span></div><div class=ec-line><span style=color:#e1e4e8>rr </span><span style=color:#f97583>:=</span><span style=color:#e1e4e8> httptest.</span><span style=color:#79b8ff>NewRecorder</span><span style=color:#e1e4e8>()</span></div><div class=ec-line><span style=color:#e1e4e8>req </span><span style=color:#f97583>:=</span><span style=color:#e1e4e8> httptest.</span><span style=color:#79b8ff>NewRequest</span><span style=color:#e1e4e8>(</span><span style=color:#9ecbff>"GET"</span><span style=color:#e1e4e8>, tt.url, </span><span style=color:#79b8ff>nil</span><span style=color:#e1e4e8>)</span></div><div class=ec-line><span style=color:#e1e4e8>router.</span><span style=color:#79b8ff>ServeHTTP</span><span style=color:#e1e4e8>(rr, req)</span></div><div class=ec-line>
</div><div class=ec-line><span style=color:#6a737d>// Result</span></div><div class=ec-line><span style=color:#e1e4e8>res </span><span style=color:#f97583>:=</span><span style=color:#e1e4e8> rr.</span><span style=color:#79b8ff>Result</span><span style=color:#e1e4e8>()</span></div><div class=ec-line>
</div><div class=ec-line><span style=color:#f97583>if</span><span style=color:#e1e4e8> tt.wantCode </span><span style=color:#f97583>!=</span><span style=color:#e1e4e8> res.StatusCode {</span></div><div class=ec-line><span style=color:#e1e4e8>  t.</span><span style=color:#79b8ff>Errorf</span><span style=color:#e1e4e8>(</span><span style=color:#9ecbff>"Expected response code </span><span style=color:#79b8ff>%d</span><span style=color:#9ecbff>. Got </span><span style=color:#79b8ff>%d\n</span><span style=color:#9ecbff>"</span><span style=color:#e1e4e8>, tt.wantCode, res.StatusCode)</span></div><div class=ec-line><span style=color:#e1e4e8>}</span></div></code></pre><div class=copy><button data-code="// Requestrr := httptest.NewRecorder()req := httptest.NewRequest(&#x22;GET&#x22;, tt.url, nil)router.ServeHTTP(rr, req)// Resultres := rr.Result()if tt.wantCode != res.StatusCode {  t.Errorf(&#x22;Expected response code %d. Got %d\n&#x22;, tt.wantCode, res.StatusCode)}" data-copied=Copied! title="Copy to clipboard"><div></div></button></div></figure></div><h2 id=loadandsavemock-middleware>LoadAndSaveMock middleware<a href=#loadandsavemock-middleware class=astro-XmVVtUzC aria-hidden="" tabindex=-1><svg viewBox="0 0 24 24" width=18 height=18 class=autolink-svg fill=currentColor marginLeft=1rem xmlns=http://www.w3.org/2000/svg><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h2><p>In this section we’ll create a wrapper/middleware of the <code>LoadAndSave</code> middleware from the SCS package, this mock will inject any value we want into our router before recording the test request:</p><div class="ec ec-2w87v ec-theme-github-dark expressive-code"><figure class="astro-VXbRogkV has-title"><figcaption class=header><span class=title>main_test.go</span></figcaption><pre tabindex=0><code><div class=ec-line><span style=color:#f97583>func</span><span style=color:#e1e4e8> </span><span style=color:#b392f0>LoadAndSaveMock</span><span style=color:#e1e4e8>(session </span><span style=color:#f97583>*</span><span style=color:#e1e4e8>scs.SessionManager, key, value </span><span style=color:#f97583>string</span><span style=color:#e1e4e8>) </span><span style=color:#f97583>func</span><span style=color:#e1e4e8>(next http.Handler) http.Handler {</span></div><div class=ec-line><span style=color:#e1e4e8>  </span><span style=color:#f97583>return</span><span style=color:#e1e4e8> </span><span style=color:#f97583>func</span><span style=color:#e1e4e8>(next http.Handler) http.Handler {</span></div><div class=ec-line><span style=color:#e1e4e8>    </span><span style=color:#f97583>return</span><span style=color:#e1e4e8> session.</span><span style=color:#79b8ff>LoadAndSave</span><span style=color:#e1e4e8>(http.</span><span style=color:#79b8ff>HandlerFunc</span><span style=color:#e1e4e8>(</span><span style=color:#f97583>func</span><span style=color:#e1e4e8>(w http.ResponseWriter, r </span><span style=color:#f97583>*</span><span style=color:#e1e4e8>http.Request) {</span></div><div class=ec-line><span style=color:#e1e4e8>      session.</span><span style=color:#79b8ff>Put</span><span style=color:#e1e4e8>(r.</span><span style=color:#79b8ff>Context</span><span style=color:#e1e4e8>(), key, value)</span></div><div class=ec-line><span style=color:#e1e4e8>      next.</span><span style=color:#79b8ff>ServeHTTP</span><span style=color:#e1e4e8>(w, r)</span></div><div class=ec-line><span style=color:#e1e4e8>    }))</span></div><div class=ec-line><span style=color:#e1e4e8>  }</span></div><div class=ec-line><span style=color:#e1e4e8>}</span></div></code></pre><div class=copy><button data-code="func LoadAndSaveMock(session *scs.SessionManager, key, value string) func(next http.Handler) http.Handler {  return func(next http.Handler) http.Handler {    return session.LoadAndSave(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {      session.Put(r.Context(), key, value)      next.ServeHTTP(w, r)    }))  }}" data-copied=Copied! title="Copy to clipboard"><div></div></button></div></figure></div><h2 id=putting-all-together>Putting all together<a href=#putting-all-together class=astro-XmVVtUzC aria-hidden="" tabindex=-1><svg viewBox="0 0 24 24" width=18 height=18 class=autolink-svg fill=currentColor marginLeft=1rem xmlns=http://www.w3.org/2000/svg><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h2><p>The final test code logic:</p><div class="ec ec-2w87v ec-theme-github-dark expressive-code"><figure class="astro-VXbRogkV has-title"><figcaption class=header><span class=title>main_test.go</span></figcaption><pre tabindex=0><code><div class="ec-line mark"><span style=color:#fb99a3>func</span><span style=color:#e1e4e8> </span><span style=color:#c2a8f3>LoadAndSaveMock</span><span style=color:#e1e4e8>(session </span><span style=color:#fb99a3>*</span><span style=color:#e1e4e8>scs.SessionManager, key, value </span><span style=color:#fb99a3>string</span><span style=color:#e1e4e8>) </span><span style=color:#fb99a3>func</span><span style=color:#e1e4e8>(next http.Handler) http.Handler {</span></div><div class="ec-line mark"><span style=color:#e1e4e8>  </span><span style=color:#fb99a3>return</span><span style=color:#e1e4e8> </span><span style=color:#fb99a3>func</span><span style=color:#e1e4e8>(next http.Handler) http.Handler {</span></div><div class="ec-line mark"><span style=color:#e1e4e8>    </span><span style=color:#fb99a3>return</span><span style=color:#e1e4e8> session.</span><span style=color:#79b8ff>LoadAndSave</span><span style=color:#e1e4e8>(http.</span><span style=color:#79b8ff>HandlerFunc</span><span style=color:#e1e4e8>(</span><span style=color:#fb99a3>func</span><span style=color:#e1e4e8>(w http.ResponseWriter, r </span><span style=color:#fb99a3>*</span><span style=color:#e1e4e8>http.Request) {</span></div><div class="ec-line mark"><span style=color:#e1e4e8>      session.</span><span style=color:#79b8ff>Put</span><span style=color:#e1e4e8>(r.</span><span style=color:#79b8ff>Context</span><span style=color:#e1e4e8>(), key, value)</span></div><div class="ec-line mark"><span style=color:#e1e4e8>      next.</span><span style=color:#79b8ff>ServeHTTP</span><span style=color:#e1e4e8>(w, r)</span></div><div class="ec-line mark"><span style=color:#e1e4e8>    }))</span></div><div class="ec-line mark"><span style=color:#e1e4e8>  }</span></div><div class="ec-line mark"><span style=color:#e1e4e8>}</span></div><div class=ec-line>
</div><div class=ec-line><span style=color:#f97583>func</span><span style=color:#e1e4e8> </span><span style=color:#b392f0>Test_main</span><span style=color:#e1e4e8>(t </span><span style=color:#f97583>*</span><span style=color:#e1e4e8>testing.T) {</span></div><div class=ec-line><span style=color:#e1e4e8>  tests </span><span style=color:#f97583>:=</span><span style=color:#e1e4e8> []</span><span style=color:#f97583>struct</span><span style=color:#e1e4e8> {</span></div><div class=ec-line><span style=color:#e1e4e8>    name     </span><span style=color:#f97583>string</span></div><div class=ec-line><span style=color:#e1e4e8>    url      </span><span style=color:#f97583>string</span></div><div class=ec-line><span style=color:#e1e4e8>    role     </span><span style=color:#f97583>string</span></div><div class=ec-line><span style=color:#e1e4e8>    wantCode </span><span style=color:#f97583>int</span></div><div class=ec-line><span style=color:#e1e4e8>  }{</span></div><div class=ec-line><span style=color:#e1e4e8>    {</span></div><div class=ec-line><span style=color:#e1e4e8>      name:     </span><span style=color:#9ecbff>"public endpoint"</span><span style=color:#e1e4e8>,</span></div><div class=ec-line><span style=color:#e1e4e8>      url:      </span><span style=color:#9ecbff>"/"</span><span style=color:#e1e4e8>,</span></div><div class=ec-line><span style=color:#e1e4e8>      wantCode: http.StatusOK,</span></div><div class=ec-line><span style=color:#e1e4e8>    },</span></div><div class=ec-line><span style=color:#e1e4e8>    {</span></div><div class=ec-line><span style=color:#e1e4e8>      name:     </span><span style=color:#9ecbff>"admin endpoint without role"</span><span style=color:#e1e4e8>,</span></div><div class=ec-line><span style=color:#e1e4e8>      url:      </span><span style=color:#9ecbff>"/admin"</span><span style=color:#e1e4e8>,</span></div><div class=ec-line><span style=color:#e1e4e8>      wantCode: http.StatusUnauthorized,</span></div><div class=ec-line><span style=color:#e1e4e8>    },</span></div><div class=ec-line><span style=color:#e1e4e8>    {</span></div><div class=ec-line><span style=color:#e1e4e8>      name:     </span><span style=color:#9ecbff>"admin endpoint with wrong role"</span><span style=color:#e1e4e8>,</span></div><div class=ec-line><span style=color:#e1e4e8>      url:      </span><span style=color:#9ecbff>"/admin"</span><span style=color:#e1e4e8>,</span></div><div class=ec-line><span style=color:#e1e4e8>      role:     </span><span style=color:#9ecbff>"OTHER"</span><span style=color:#e1e4e8>,</span></div><div class=ec-line><span style=color:#e1e4e8>      wantCode: http.StatusUnauthorized,</span></div><div class=ec-line><span style=color:#e1e4e8>    },</span></div><div class=ec-line><span style=color:#e1e4e8>    {</span></div><div class=ec-line><span style=color:#e1e4e8>      name:     </span><span style=color:#9ecbff>"admin endpoint with correct role"</span><span style=color:#e1e4e8>,</span></div><div class=ec-line><span style=color:#e1e4e8>      url:      </span><span style=color:#9ecbff>"/admin"</span><span style=color:#e1e4e8>,</span></div><div class=ec-line><span style=color:#e1e4e8>      role:     </span><span style=color:#9ecbff>"ADMIN"</span><span style=color:#e1e4e8>,</span></div><div class=ec-line><span style=color:#e1e4e8>      wantCode: http.StatusOK,</span></div><div class=ec-line><span style=color:#e1e4e8>    },</span></div><div class=ec-line><span style=color:#e1e4e8>  }</span></div><div class=ec-line><span style=color:#e1e4e8>  </span><span style=color:#f97583>for</span><span style=color:#e1e4e8> _, tt </span><span style=color:#f97583>:=</span><span style=color:#e1e4e8> </span><span style=color:#f97583>range</span><span style=color:#e1e4e8> tests {</span></div><div class=ec-line><span style=color:#e1e4e8>    t.</span><span style=color:#79b8ff>Run</span><span style=color:#e1e4e8>(tt.name, </span><span style=color:#f97583>func</span><span style=color:#e1e4e8>(t </span><span style=color:#f97583>*</span><span style=color:#e1e4e8>testing.T) {</span></div><div class="ec-line mark"><span style=color:#e1e4e8>      </span><span style=color:#b0b5ba>// Set up</span></div><div class="ec-line mark"><span style=color:#e1e4e8>      session </span><span style=color:#fb99a3>:=</span><span style=color:#e1e4e8> scs.</span><span style=color:#79b8ff>New</span><span style=color:#e1e4e8>()</span></div><div class="ec-line mark"><span style=color:#e1e4e8>      router </span><span style=color:#fb99a3>:=</span><span style=color:#e1e4e8> chi.</span><span style=color:#79b8ff>NewRouter</span><span style=color:#e1e4e8>()</span></div><div class="ec-line mark"><span style=color:#e1e4e8>      server </span><span style=color:#fb99a3>:=</span><span style=color:#e1e4e8> </span><span style=color:#fb99a3>&#x26;</span><span style=color:#e1e4e8>Server{</span></div><div class="ec-line mark"><span style=color:#e1e4e8>        session: session,</span></div><div class="ec-line mark"><span style=color:#e1e4e8>        router:  router,</span></div><div class="ec-line mark"><span style=color:#e1e4e8>      }</span></div><div class="ec-line mark">
</div><div class="ec-line mark"><span style=color:#e1e4e8>      </span><span style=color:#b0b5ba>// Session middleware</span></div><div class="ec-line mark"><span style=color:#e1e4e8>      router.</span><span style=color:#79b8ff>Use</span><span style=color:#e1e4e8>(</span><span style=color:#79b8ff>LoadAndSaveMock</span><span style=color:#e1e4e8>(session, </span><span style=color:#9ecbff>"user_role"</span><span style=color:#e1e4e8>, tt.role))</span></div><div class="ec-line mark">
</div><div class="ec-line mark"><span style=color:#e1e4e8>      </span><span style=color:#b0b5ba>// Routes</span></div><div class="ec-line mark"><span style=color:#e1e4e8>      router.</span><span style=color:#79b8ff>Get</span><span style=color:#e1e4e8>(</span><span style=color:#9ecbff>"/"</span><span style=color:#e1e4e8>, server.handleHelloWorld)</span></div><div class="ec-line mark"><span style=color:#e1e4e8>      router.</span><span style=color:#79b8ff>Group</span><span style=color:#e1e4e8>(</span><span style=color:#fb99a3>func</span><span style=color:#e1e4e8>(router chi.Router) {</span></div><div class="ec-line mark"><span style=color:#e1e4e8>        router.</span><span style=color:#79b8ff>Use</span><span style=color:#e1e4e8>(server.RequireAdmin)</span></div><div class="ec-line mark"><span style=color:#e1e4e8>        router.</span><span style=color:#79b8ff>Get</span><span style=color:#e1e4e8>(</span><span style=color:#9ecbff>"/admin"</span><span style=color:#e1e4e8>, server.handleAdmin)</span></div><div class="ec-line mark"><span style=color:#e1e4e8>      })</span></div><div class="ec-line mark">
</div><div class="ec-line mark"><span style=color:#e1e4e8>      </span><span style=color:#b0b5ba>// Request</span></div><div class="ec-line mark"><span style=color:#e1e4e8>      rr </span><span style=color:#fb99a3>:=</span><span style=color:#e1e4e8> httptest.</span><span style=color:#79b8ff>NewRecorder</span><span style=color:#e1e4e8>()</span></div><div class="ec-line mark"><span style=color:#e1e4e8>      req </span><span style=color:#fb99a3>:=</span><span style=color:#e1e4e8> httptest.</span><span style=color:#79b8ff>NewRequest</span><span style=color:#e1e4e8>(</span><span style=color:#9ecbff>"GET"</span><span style=color:#e1e4e8>, tt.url, </span><span style=color:#79b8ff>nil</span><span style=color:#e1e4e8>)</span></div><div class="ec-line mark"><span style=color:#e1e4e8>      router.</span><span style=color:#79b8ff>ServeHTTP</span><span style=color:#e1e4e8>(rr, req)</span></div><div class="ec-line mark">
</div><div class="ec-line mark"><span style=color:#e1e4e8>      </span><span style=color:#b0b5ba>// Result</span></div><div class="ec-line mark"><span style=color:#e1e4e8>      res </span><span style=color:#fb99a3>:=</span><span style=color:#e1e4e8> rr.</span><span style=color:#79b8ff>Result</span><span style=color:#e1e4e8>()</span></div><div class="ec-line mark">
</div><div class="ec-line mark"><span style=color:#e1e4e8>      </span><span style=color:#fb99a3>if</span><span style=color:#e1e4e8> tt.wantCode </span><span style=color:#fb99a3>!=</span><span style=color:#e1e4e8> res.StatusCode {</span></div><div class="ec-line mark"><span style=color:#e1e4e8>        t.</span><span style=color:#79b8ff>Errorf</span><span style=color:#e1e4e8>(</span><span style=color:#9ecbff>"Expected response code </span><span style=color:#79b8ff>%d</span><span style=color:#9ecbff>. Got </span><span style=color:#79b8ff>%d\n</span><span style=color:#9ecbff>"</span><span style=color:#e1e4e8>, tt.wantCode, res.StatusCode)</span></div><div class="ec-line mark"><span style=color:#e1e4e8>      }</span></div><div class=ec-line><span style=color:#e1e4e8>    })</span></div><div class=ec-line><span style=color:#e1e4e8>  }</span></div><div class=ec-line><span style=color:#e1e4e8>}</span></div></code></pre><div class=copy><button data-code="func LoadAndSaveMock(session *scs.SessionManager, key, value string) func(next http.Handler) http.Handler {  return func(next http.Handler) http.Handler {    return session.LoadAndSave(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {      session.Put(r.Context(), key, value)      next.ServeHTTP(w, r)    }))  }}func Test_main(t *testing.T) {  tests := []struct {    name     string    url      string    role     string    wantCode int  }{    {      name:     &#x22;public endpoint&#x22;,      url:      &#x22;/&#x22;,      wantCode: http.StatusOK,    },    {      name:     &#x22;admin endpoint without role&#x22;,      url:      &#x22;/admin&#x22;,      wantCode: http.StatusUnauthorized,    },    {      name:     &#x22;admin endpoint with wrong role&#x22;,      url:      &#x22;/admin&#x22;,      role:     &#x22;OTHER&#x22;,      wantCode: http.StatusUnauthorized,    },    {      name:     &#x22;admin endpoint with correct role&#x22;,      url:      &#x22;/admin&#x22;,      role:     &#x22;ADMIN&#x22;,      wantCode: http.StatusOK,    },  }  for _, tt := range tests {    t.Run(tt.name, func(t *testing.T) {      // Set up      session := scs.New()      router := chi.NewRouter()      server := &#x26;Server{        session: session,        router:  router,      }      // Session middleware      router.Use(LoadAndSaveMock(session, &#x22;user_role&#x22;, tt.role))      // Routes      router.Get(&#x22;/&#x22;, server.handleHelloWorld)      router.Group(func(router chi.Router) {        router.Use(server.RequireAdmin)        router.Get(&#x22;/admin&#x22;, server.handleAdmin)      })      // Request      rr := httptest.NewRecorder()      req := httptest.NewRequest(&#x22;GET&#x22;, tt.url, nil)      router.ServeHTTP(rr, req)      // Result      res := rr.Result()      if tt.wantCode != res.StatusCode {        t.Errorf(&#x22;Expected response code %d. Got %d\n&#x22;, tt.wantCode, res.StatusCode)      }    })  }}" data-copied=Copied! title="Copy to clipboard"><div></div></button></div></figure></div><p>And.. we get this result</p><div class="ec ec-2w87v ec-theme-github-dark expressive-code"><figure class="astro-VXbRogkV is-terminal"><figcaption class=header><span class=title></span><span class=sr-only>Terminal window</span></figcaption><pre tabindex=0><code><div class=ec-line><span style=color:#e1e4e8>=== </span><span style=color:#9ecbff>RUN</span><span style=color:#e1e4e8>   </span><span style=color:#9ecbff>Test_main</span></div><div class=ec-line><span style=color:#e1e4e8>=== </span><span style=color:#9ecbff>RUN</span><span style=color:#e1e4e8>   </span><span style=color:#9ecbff>Test_main/public_endpoint</span></div><div class=ec-line><span style=color:#b392f0>---</span><span style=color:#e1e4e8> </span><span style=color:#9ecbff>PASS:</span><span style=color:#e1e4e8> </span><span style=color:#9ecbff>Test_main/public_endpoint</span><span style=color:#e1e4e8> (0.00s)</span></div><div class=ec-line><span style=color:#e1e4e8>=== </span><span style=color:#9ecbff>RUN</span><span style=color:#e1e4e8>   </span><span style=color:#9ecbff>Test_main/admin_endpoint_without_role</span></div><div class=ec-line><span style=color:#b392f0>---</span><span style=color:#e1e4e8> </span><span style=color:#9ecbff>PASS:</span><span style=color:#e1e4e8> </span><span style=color:#9ecbff>Test_main/admin_endpoint_without_role</span><span style=color:#e1e4e8> (0.00s)</span></div><div class=ec-line><span style=color:#e1e4e8>=== </span><span style=color:#9ecbff>RUN</span><span style=color:#e1e4e8>   </span><span style=color:#9ecbff>Test_main/admin_endpoint_with_wrong_role</span></div><div class=ec-line><span style=color:#b392f0>---</span><span style=color:#e1e4e8> </span><span style=color:#9ecbff>PASS:</span><span style=color:#e1e4e8> </span><span style=color:#9ecbff>Test_main/admin_endpoint_with_wrong_role</span><span style=color:#e1e4e8> (0.00s)</span></div><div class=ec-line><span style=color:#e1e4e8>=== </span><span style=color:#9ecbff>RUN</span><span style=color:#e1e4e8>   </span><span style=color:#9ecbff>Test_main/admin_endpoint_with_correct_role</span></div><div class=ec-line><span style=color:#b392f0>---</span><span style=color:#e1e4e8> </span><span style=color:#9ecbff>PASS:</span><span style=color:#e1e4e8> </span><span style=color:#9ecbff>Test_main/admin_endpoint_with_correct_role</span><span style=color:#e1e4e8> (0.00s)</span></div><div class=ec-line><span style=color:#b392f0>---</span><span style=color:#e1e4e8> </span><span style=color:#9ecbff>PASS:</span><span style=color:#e1e4e8> </span><span style=color:#9ecbff>Test_main</span><span style=color:#e1e4e8> (0.00s)</span></div><div class=ec-line><span style=color:#b392f0>PASS</span></div><div class=ec-line><span style=color:#b392f0>ok</span><span style=color:#e1e4e8>      </span><span style=color:#9ecbff>github.com/LucJosin/go-scs-test</span><span style=color:#e1e4e8> </span><span style=color:#79b8ff>0.002</span><span style=color:#9ecbff>s</span></div></code></pre><div class=copy><button data-code="=== RUN   Test_main=== RUN   Test_main/public_endpoint--- PASS: Test_main/public_endpoint (0.00s)=== RUN   Test_main/admin_endpoint_without_role--- PASS: Test_main/admin_endpoint_without_role (0.00s)=== RUN   Test_main/admin_endpoint_with_wrong_role--- PASS: Test_main/admin_endpoint_with_wrong_role (0.00s)=== RUN   Test_main/admin_endpoint_with_correct_role--- PASS: Test_main/admin_endpoint_with_correct_role (0.00s)--- PASS: Test_main (0.00s)PASSok      github.com/LucJosin/go-scs-test 0.002s" data-copied=Copied! title="Copy to clipboard"><div></div></button></div></figure></div><h2 id=conclusion>Conclusion<a href=#conclusion class=astro-XmVVtUzC aria-hidden="" tabindex=-1><svg viewBox="0 0 24 24" width=18 height=18 class=autolink-svg fill=currentColor marginLeft=1rem xmlns=http://www.w3.org/2000/svg><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h2><p>In this post I show you a solution to a problem that I’ve encountered while implementing auth tests using the SCS session package.</p><h2 id=resources-and-references>Resources and References<a href=#resources-and-references class=astro-XmVVtUzC aria-hidden="" tabindex=-1><svg viewBox="0 0 24 24" width=18 height=18 class=autolink-svg fill=currentColor marginLeft=1rem xmlns=http://www.w3.org/2000/svg><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h2><ul><li><a href=https://go-chi.io/#/ rel="noopener noreferrer" target=_blank>https://go-chi.io/#/<span><svg viewBox="0 0 24 24" width=16 height=16 class=astro-NcINbxXp fill=currentColor marginLeft=1rem xmlns=http://www.w3.org/2000/svg><path d="M14 3v2h3.59l-9.83 9.83l1.41 1.41L19 6.41V10h2V3m-2 16H5V5h7V3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7h-2v7Z"></path></svg></span></a></li><li><a href=https://github.com/alexedwards/scs rel="noopener noreferrer" target=_blank>https://github.com/alexedwards/scs<span><svg viewBox="0 0 24 24" width=16 height=16 class=astro-NcINbxXp fill=currentColor marginLeft=1rem xmlns=http://www.w3.org/2000/svg><path d="M14 3v2h3.59l-9.83 9.83l1.41 1.41L19 6.41V10h2V3m-2 16H5V5h7V3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7h-2v7Z"></path></svg></span></a></li><li><a href=https://stackoverflow.com/questions/76607300 rel="noopener noreferrer" target=_blank>https://stackoverflow.com/questions/76607300<span><svg viewBox="0 0 24 24" width=16 height=16 class=astro-NcINbxXp fill=currentColor marginLeft=1rem xmlns=http://www.w3.org/2000/svg><path d="M14 3v2h3.59l-9.83 9.83l1.41 1.41L19 6.41V10h2V3m-2 16H5V5h7V3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7h-2v7Z"></path></svg></span></a>(<a href=https://stackoverflow.com/a/76608076/14500144 rel="noopener noreferrer" target=_blank>Comment<span><svg viewBox="0 0 24 24" width=16 height=16 class=astro-NcINbxXp fill=currentColor marginLeft=1rem xmlns=http://www.w3.org/2000/svg><path d="M14 3v2h3.59l-9.83 9.83l1.41 1.41L19 6.41V10h2V3m-2 16H5V5h7V3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7h-2v7Z"></path></svg></span></a>)</li><li><a href=https://stackoverflow.com/questions/76606201 rel="noopener noreferrer" target=_blank>https://stackoverflow.com/questions/76606201<span><svg viewBox="0 0 24 24" width=16 height=16 class=astro-NcINbxXp fill=currentColor marginLeft=1rem xmlns=http://www.w3.org/2000/svg><path d="M14 3v2h3.59l-9.83 9.83l1.41 1.41L19 6.41V10h2V3m-2 16H5V5h7V3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7h-2v7Z"></path></svg></span></a>(<a href=https://stackoverflow.com/a/76606952/14500144 rel="noopener noreferrer" target=_blank>Comment<span><svg viewBox="0 0 24 24" width=16 height=16 class=astro-NcINbxXp fill=currentColor marginLeft=1rem xmlns=http://www.w3.org/2000/svg><path d="M14 3v2h3.59l-9.83 9.83l1.41 1.41L19 6.41V10h2V3m-2 16H5V5h7V3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7h-2v7Z"></path></svg></span></a>)</li></ul></article><div class=astro-VMU_gLvC data-astro-cid-52we5p3l><div class=astro-RGZYjsfF data-astro-cid-6h4uzzpe><span class=astro-pXJWSIiv data-astro-cid-6h4uzzpe><svg viewBox="0 0 24 24" width=18 astro-icon=mdi:cards-heart data-astro-cid-6h4uzzpe><path d="m12 21.35-1.45-1.32C5.4 15.36 2 12.27 2 8.5 2 5.41 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.08C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.41 22 8.5c0 3.77-3.4 6.86-8.55 11.53L12 21.35z" fill=currentColor /></svg> Enjoy this post? Feel free to share!</span><div class=astro-XyuZPGRa data-astro-cid-6lpegvfu><div class=astro-RjbOdobi data-astro-cid-fasyqkqy data-href="https://www.linkedin.com/sharing/share-offsite/?url=https://lucjos.in/b/ZfgJzcJf"><span class=astro-__iHymyG data-astro-cid-fasyqkqy>Share to Linkedin</span><a href="https://www.linkedin.com/sharing/share-offsite/?url=https://lucjos.in/b/ZfgJzcJf" class=astro-IDVWWxLX title="Share to Linkedin" style="--padding:0.6rem 0.8rem" data-astro-cid-tpz4yhk7 rel="noopener noreferrer" target=_blank><svg viewBox="0 0 24 24" width=16 height=16 astro-icon=simple-icons:linkedin data-astro-cid-tpz4yhk7><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z" fill=currentColor /></svg></a></div><div class=astro-RjbOdobi data-astro-cid-fasyqkqy data-href="https://twitter.com/intent/tweet?url=https://lucjos.in/b/ZfgJzcJf&#38;text=Go%20Tests:%20Creating%20a%20session%20mock%20for%20authentication%20using%20SCS%20by%20@LucJosin"><span class=astro-__iHymyG data-astro-cid-fasyqkqy>Share to Twitter</span><a href="https://twitter.com/intent/tweet?url=https://lucjos.in/b/ZfgJzcJf&#38;text=Go%20Tests:%20Creating%20a%20session%20mock%20for%20authentication%20using%20SCS%20by%20@LucJosin" class=astro-IDVWWxLX title="Share to Twitter" style="--padding:0.6rem 0.8rem" data-astro-cid-tpz4yhk7 rel="noopener noreferrer" target=_blank><svg viewBox="0 0 24 24" width=16 height=16 astro-icon=simple-icons:twitter data-astro-cid-tpz4yhk7><path d="M23.953 4.57a10 10 0 0 1-2.825.775 4.958 4.958 0 0 0 2.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 0 0-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 0 0-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 0 1-2.228-.616v.06a4.923 4.923 0 0 0 3.946 4.827 4.996 4.996 0 0 1-2.212.085 4.936 4.936 0 0 0 4.604 3.417 9.867 9.867 0 0 1-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 0 0 7.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0 0 24 4.59z" fill=currentColor /></svg></a></div><div class=astro-RjbOdobi data-astro-cid-fasyqkqy data-href="https://reddit.com/submit?url=https://lucjos.in/b/ZfgJzcJf&#38;title=Go%20Tests:%20Creating%20a%20session%20mock%20for%20authentication%20using%20SCS"><span class=astro-__iHymyG data-astro-cid-fasyqkqy>Share to Reddit</span><a href="https://reddit.com/submit?url=https://lucjos.in/b/ZfgJzcJf&#38;title=Go%20Tests:%20Creating%20a%20session%20mock%20for%20authentication%20using%20SCS" class=astro-IDVWWxLX title="Share to Reddit" style="--padding:0.6rem 0.8rem" data-astro-cid-tpz4yhk7 rel="noopener noreferrer" target=_blank><svg viewBox="0 0 24 24" width=16 height=16 astro-icon=simple-icons:reddit data-astro-cid-tpz4yhk7><path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z" fill=currentColor /></svg></a></div><div class=astro-RjbOdobi data-astro-cid-fasyqkqy data-href=https://lucjos.in/b/ZfgJzcJf id=share><span class=astro-__iHymyG data-astro-cid-fasyqkqy id=share-title>Copy link</span><a href=https://lucjos.in/b/ZfgJzcJf class=astro-IDVWWxLX title="Copy link" style="--padding:0.6rem 0.8rem" data-astro-cid-tpz4yhk7 rel="noopener noreferrer" target=_blank><svg viewBox="0 0 24 24" width=16 height=16 astro-icon=mdi:link data-astro-cid-tpz4yhk7><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8v2m9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1 0 1.71-1.39 3.1-3.1 3.1h-4V17h4a5 5 0 0 0 5-5 5 5 0 0 0-5-5z" fill=currentColor /></svg></a></div></div></div><div style=--justifyContent:initial data-astro-cid-4mxiqxos id=tags><h2 data-astro-cid-4mxiqxos style=--justifyContent:initial>Tags</h2><div class=astro-QBdfmTCa style=--justifyContent:initial data-astro-cid-4mxiqxos><a href=/blog/tags/golang class=astro-RCjsrPqZ title="See more posts from 'golang' astro-RCjsrPqZ" data-astro-cid-6ktkooou>golang</a><a href=/blog/tags/go-chi class=astro-RCjsrPqZ title="See more posts from 'go-chi' astro-RCjsrPqZ" data-astro-cid-6ktkooou>go-chi</a><a href=/blog/tags/tests class=astro-RCjsrPqZ title="See more posts from 'tests' astro-RCjsrPqZ" data-astro-cid-6ktkooou>tests</a><a href=/blog/tags/auth class=astro-RCjsrPqZ title="See more posts from 'auth' astro-RCjsrPqZ" data-astro-cid-6ktkooou>auth</a><a href=/blog/tags/session class=astro-RCjsrPqZ title="See more posts from 'session' astro-RCjsrPqZ" data-astro-cid-6ktkooou>session</a></div></div><div class=post-comments data-astro-cid-64uyyklt><h2 id=comments data-astro-cid-64uyyklt>Comments</h2><div class=astro-DwzjAZrO data-astro-cid-64uyyklt></div></div><script src=https://giscus.app/client.js async crossorigin=anonymous data-category=Announcements data-category-id=DIC_kwDOH3GyVM4CZ9W5 data-emit-metadata=0 data-input-position=top data-lang=en data-loading=lazy data-mapping=pathname data-reactions-enabled=1 data-repo=LucJosin/lucasjosino.com data-repo-id=R_kgDOH3GyVA data-strict=0></script><div class=astro-bAqrVGaX style="--height:1px;--width:100%;--margin:1.5rem 0" data-astro-cid-4d7p4lxg></div><div class=astro-EFxMvmFa data-astro-cid-52we5p3l><div class=astro-KvzKiIaS data-astro-cid-52we5p3l>© 2023 <span class=post-footer-home data-astro-cid-52we5p3l><a href=/ class=astro-ePDMdrOI title="Lucas Josino" style=--borderBottom:var(--border-color);--currentGap:0.6rem;--animatedGap:0.6rem;--iconColor:gray data-astro-cid-trf4k3zj><span style=--borderBottom:var(--border-color);--currentGap:0.6rem;--animatedGap:0.6rem;--iconColor:gray data-astro-cid-trf4k3zj>Lucas Josino</span></a></span> All Rights Reserved.</div></div></div></div></main></body></html>