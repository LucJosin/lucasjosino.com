<!DOCTYPE html><html data-astro-cid-sckkx6r4 lang=en><head><meta charset=UTF-8><meta content=en-US http-equiv=content-language><meta content=text/html http-equiv=content-type><meta content="© 2024, Lucas Josino. All Rights Reserved." name=copyright><meta content="In this article, we'll explore how to mock our session when using SCS and inject data into context for authentication tests" name=description><meta content="Lucas Josino" name=author><meta content="java, java developer, kotlin, golang, go, sql, postgresql, hawapi, spring, spring boot, spring mvc, backend, backend developer, portfolio, lucasjosino, lucas josino, lucjosin, lucjos.in, josino, developer, @lucjoin, @lucjos.in, desenvolvedor, desenvolvedor backend, desenvolvedor java" name=tags><meta content="java, java developer, kotlin, golang, go, sql, postgresql, hawapi, spring, spring boot, spring mvc, backend, backend developer, portfolio, lucasjosino, lucas josino, lucjosin, lucjos.in, josino, developer, @lucjoin, @lucjos.in, desenvolvedor, desenvolvedor backend, desenvolvedor java" name=keywords><meta content="width=device-width,initial-scale=1" name=viewport><meta content=index,follow name=robots><meta content=summary_large_image name=twitter:card><meta content=@LucJosin name=twitter:creator><meta content=@LucJosin name=twitter:site><meta content=https://www.lucasjosino.com/ name=twitter:domain><meta content="Go: How to mock SCS session authentication in tests" name=twitter:title><meta content="In this article, we'll explore how to mock our session when using SCS and inject data into context for authentication tests" property=og:description itemprop=description name=twitter:description><meta content=https://www.lucasjosino.com/static/open-graph/go-how-to-mock-scs-session-authentication-in-tests.png property=twitter:image itemprop="image primaryImageOfPage"><meta content=https://www.lucasjosino.com/blog/go-how-to-mock-scs-session-authentication-in-tests/ property=og:url><meta content="Go: How to mock SCS session authentication in tests" property=og:title><meta content="Lucas Josino" property=og:site_name><meta content="In this article, we'll explore how to mock our session when using SCS and inject data into context for authentication tests" property=og:description><meta content=article property=og:type><meta content=https://www.lucasjosino.com/static/open-graph/go-how-to-mock-scs-session-authentication-in-tests.png property=og:image><meta content=https://www.lucasjosino.com/static/open-graph/go-how-to-mock-scs-session-authentication-in-tests.png property=og:image:secure_url><meta content=image/png property=og:image:type><meta content=1200 property=og:image:width><meta content=630 property=og:image:height><script src=https://analytics.us.umami.is/script.js data-website-id=986fb135-7659-4137-9c30-d74a3af505ca defer=defer></script><script>function getGiscusTheme(e){return`${window.location.origin}/static/css/giscus_${e}.css`}const theme="undefined"!=typeof localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme"):window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";document.documentElement.setAttribute("data-theme",theme),window.localStorage.setItem("theme",theme)</script><meta content="2024-02-01 20:00 UTC-3" property=article:published_time><meta content="2024-05-01 12:00 UTC-3" property=article:modified_time><meta content="Lucas Josino" property=article:author><meta content="How to" property=article:section><meta content="golang go-chi tests auth session" property=article:tag><link href=https://lucjos.in/b/ZfgJzcJf rel=shortlink type=text/html><link href=https://www.lucasjosino.com/blog/go-how-to-mock-scs-session-authentication-in-tests/ rel=canonical><link href=https://www.lucasjosino.com/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link href=https://www.lucasjosino.com/favicon-32x32.png rel=icon sizes=32x32 type=image/png><link href=https://www.lucasjosino.com/favicon-16x16.png rel=icon sizes=16x16 type=image/png><link href=https://www.lucasjosino.com/favicon.ico rel=icon media=(prefers-color-scheme:no-preference)><link href=https://www.lucasjosino.com/favicon-light.ico rel=icon media=(prefers-color-scheme:dark)><link href=https://www.lucasjosino.com/favicon.ico rel=icon media=(prefers-color-scheme:light)><meta content="Astro v4.10.1" name=generator><title>Go: How to mock SCS session authentication in tests</title><link href=/_astro/_slug_.DMI9GJH7.css rel=stylesheet><style>.astro-uBZNRUCf[data-astro-cid-4d7p4lxg]{margin:var(--margin);height:var(--height);width:var(--width);background-color:var(--divider-color)}.astro-RzLJuGLC[data-astro-cid-xv6didhw]{margin:var(--margin);font-size:var(--fontSize);font-weight:700;text-align:var(--textAlign);text-rendering:optimizeLegibility}.astro-SHQgmcVV[data-astro-cid-uws3u2zx]{width:100%;display:flex;flex-direction:column;gap:1rem}.astro-_VpPzUQQ[data-astro-cid-uws3u2zx]{width:100%;display:flex;flex-direction:row;align-items:center;justify-content:space-around}.astro-nRTZNuAR[data-astro-cid-uws3u2zx]{width:100%;display:flex;flex-direction:column;align-items:center;font-size:.89em;color:gray;gap:.2rem;text-align:center}.astro-xudBGAzb[data-astro-cid-uws3u2zx]{display:flex;gap:1rem;margin:0 0 1rem}#theme[data-astro-cid-3vjzidht]{height:2rem;width:2rem;display:flex;justify-content:center;align-items:center;cursor:pointer;z-index:10;top:1.5rem;right:1.5rem;border:var(--border-size) solid var(--border-color);border-radius:var(--border-radius);transition:all var(--transition-duration) linear;background-color:transparent;position:var(--position)}#theme[data-astro-cid-3vjzidht]:hover{background-color:var(--contrast-color)}#theme[data-astro-cid-3vjzidht]:hover>[data-astro-cid-3vjzidht][data-icon]{color:var(--primary-color);fill:var(--primary-color)}header[data-astro-cid-vn2w2o5l]{height:3rem;width:100%;display:flex;align-items:center;justify-content:center;margin-bottom:3rem}.astro-EIQgd_Om[data-astro-cid-vn2w2o5l]{width:100%;display:flex;justify-content:space-between;padding:0 1rem}.astro-aSbGFxJW[data-astro-cid-vn2w2o5l]{margin:0}.astro-PXrUPWDT[data-astro-cid-vn2w2o5l],.astro-UPLNbFaf[data-astro-cid-vn2w2o5l]{display:flex;gap:1rem;align-items:center}.astro-SFdfYfqC[data-astro-cid-oulxospg]{margin:3vh 0 4vh;max-width:var(--maxWidth);width:90%;min-width:30rem;border-radius:var(--layout-border-radius);display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative;gap:var(--gap)}.astro-hOVtQZMQ[data-astro-cid-oulxospg]{position:absolute;top:0;left:0}.astro-hOVtQZMQ[data-astro-cid-oulxospg]:hover>[data-astro-cid-oulxospg][data-icon]{fill:gray;color:gray}@media (max-width:560px){.astro-SFdfYfqC[data-astro-cid-oulxospg]{min-width:initial}}:root{--primary-color:#fff;--secondary-color:#f7f7f7;--contrast-color:#000;--contrast-color-rgb:0,0,0;--divider-color:#000;--border-color:#000;--border-size:1px;--primary-text-color:#000;--secondary-text-color:#fff;--description-text-color:#404040;--border-radius:10px;--layout-border-radius:20px;--transition-duration:.2s;--card-padding:.8rem}:root[data-theme=dark]{--primary-color:#111111;--secondary-color:#181818;--contrast-color:#fff;--contrast-color-rgb:255,255,255;--divider-color:#fff;--border-color:#fff;--primary-text-color:#fff;--secondary-text-color:#121212;--description-text-color:#cfcfcf}body,html{padding:0;margin:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;background-color:var(--primary-color);color:var(--primary-text-color);--scroll-behavior:smooth!important;scroll-behavior:smooth!important;scroll-padding-top:2rem;transition:background-color .35s}*{box-sizing:border-box}main{display:flex;flex-direction:column;align-items:center}::-moz-selection{background-color:var(--description-text-color);color:var(--secondary-color)}::selection{background-color:var(--description-text-color);color:var(--secondary-color)}::-webkit-scrollbar{height:8px;width:8px;background-color:var(--secondary-color)}::-webkit-scrollbar-thumb{background-color:var(--contrast-color);border-radius:var(--border-radius)}[data-icon]{fill:var(--primary-text-color);color:var(--primary-text-color);transition:all var(--transition-duration)}a{color:var(--primary-text-color);text-decoration:none}h1,p{margin-block-start:0;margin-block-end:0;margin-inline-start:0;margin-inline-end:0}.astro-ILL_kJwo[data-astro-cid-tpz4yhk7]{height:min-content;border:var(--border-size) solid var(--border-color);border-radius:var(--border-radius);display:flex;align-items:center;justify-content:center;transition:all var(--transition-duration);gap:.5rem;padding:var(--padding);grid-column:var(--gridColumn)}.astro-ILL_kJwo[data-astro-cid-tpz4yhk7]:hover{border:var(--border-size) solid var(--primary-color);background-color:var(--border-color);color:var(--primary-color);cursor:pointer}.astro-ILL_kJwo[data-astro-cid-tpz4yhk7]:hover>[data-astro-cid-tpz4yhk7][data-icon]{fill:var(--secondary-text-color);color:var(--secondary-text-color)}[data-astro-cid-tpz4yhk7][data-icon]{font-size:var(--iconSize)}.astro-BPKjPNjr[data-astro-cid-6ktkooou]{padding:.4rem;border-radius:var(--border-radius);border:var(--border-size) solid var(--border-color);transition:all .2s;white-space:nowrap}.astro-BPKjPNjr[data-astro-cid-6ktkooou]:hover{border:var(--border-size) solid var(--primary-color);background-color:var(--border-color);color:var(--primary-color);cursor:pointer}.astro-VFvkuRY_[data-astro-cid-4mxiqxos]{display:flex;flex-wrap:wrap;flex-direction:row;justify-content:var(--justifyContent);gap:.5rem;font-size:.9em}.astro-AxZFZhah[data-astro-cid-cyj6nqmj]{overflow:hidden;width:var(--width);display:-webkit-box;-webkit-line-clamp:var(--maxLine);-webkit-box-orient:vertical;margin:var(--margin);font-size:var(--fontSize);text-align:var(--textAlign);color:var(--description-text-color)}.astro-dDaGXTVT[data-astro-cid-trf4k3zj]{border-bottom:var(--border-size) solid transparent;transition:all var(--transition-duration);cursor:pointer;gap:var(--currentGap);display:var(--display)}.astro-dDaGXTVT[data-astro-cid-trf4k3zj]:hover{border-bottom:var(--border-size) solid var(--borderBottom);gap:var(--animatedGap)}.astro-dDaGXTVT[data-astro-cid-trf4k3zj]:hover>[data-astro-cid-trf4k3zj][data-icon]{fill:var(--iconColor);color:var(--iconColor)}[data-astro-cid-trf4k3zj][data-icon]{font-size:var(--iconSize)}.astro-CBAzzFXO[data-astro-cid-ze4jrga4],.astro-wfkkxwXL[data-astro-cid-ze4jrga4]{cursor:pointer;user-select:none}.astro-CBAzzFXO[data-astro-cid-ze4jrga4]:hover,.astro-wfkkxwXL[data-astro-cid-ze4jrga4]:hover{border-bottom:var(--border-size) solid var(--border-color)}.astro-CBAzzFXO[data-astro-cid-ze4jrga4]{display:none}.show[data-astro-cid-ze4jrga4]{display:block}.astro-IXbkGEPf[data-astro-cid-ze4jrga4]{display:none}.astro-viNdmmGO[data-astro-cid-w4ghbtci]{min-height:15rem;width:100%;border:var(--border-size) solid var(--border-color);border-radius:var(--border-radius);padding:var(--card-padding);transition:all var(--transition-duration);display:flex;gap:1rem}.astro-viNdmmGO[data-astro-cid-w4ghbtci]:hover{background-color:var(--secondary-color)}h3[data-astro-cid-w4ghbtci]{margin:0;display:inherit}.astro-AbIVZVpH[data-astro-cid-w4ghbtci]{width:50%;max-width:50%;min-width:50%;overflow:hidden;border-radius:var(--border-radius)}.astro-AKAakDDs[data-astro-cid-w4ghbtci]{height:100%;width:100%;object-fit:cover;border-radius:inherit;transition:scale var(--transition-duration)}.astro-viNdmmGO[data-astro-cid-w4ghbtci]:hover .astro-AKAakDDs[data-astro-cid-w4ghbtci]{scale:1.03}.astro-xOituJmN[data-astro-cid-w4ghbtci]{width:50%;display:flex;flex-direction:column;gap:.8rem;position:relative}.astro-pngKSzqY[data-astro-cid-w4ghbtci]{margin-top:.5rem;font-size:.85em;display:flex;align-items:center;justify-content:space-between}.astro-oGvtkzKG[data-astro-cid-w4ghbtci]{display:flex;gap:.4rem}.astro-IAIHowiq[data-astro-cid-w4ghbtci]{display:flex;align-items:center;position:absolute;bottom:0}@media (max-width:768px){.astro-viNdmmGO[data-astro-cid-w4ghbtci]{flex-direction:column}.astro-AbIVZVpH[data-astro-cid-w4ghbtci]{width:100%;max-width:initial;min-width:initial}.astro-xOituJmN[data-astro-cid-w4ghbtci]{width:100%}.astro-pngKSzqY[data-astro-cid-w4ghbtci]{margin-top:0}.astro-IAIHowiq[data-astro-cid-w4ghbtci]{position:initial}}.astro-DsDwf_jD[data-astro-cid-26osaxeh]{margin:var(--margin);font-weight:700;font-size:var(--fontSize);display:var(--display);text-transform:var(--textTransform)}</style><script src=/_astro/hoisted.DcF-wmU6.js type=module></script></head><body data-astro-cid-sckkx6r4><main data-astro-cid-sckkx6r4><div class=astro-SFdfYfqC style=--maxWidth:50rem;--gap:1rem data-astro-cid-oulxospg><header data-astro-cid-vn2w2o5l><div class=astro-EIQgd_Om data-astro-cid-vn2w2o5l><div class=astro-UPLNbFaf data-astro-cid-vn2w2o5l><a href=/ class=astro-dDaGXTVT title=Homepage style=--borderBottom:transparent;--currentGap:0.6rem;--animatedGap:0.6rem;--iconColor:gray;--iconSize:1.2em;--display:flex data-astro-cid-trf4k3zj><h3 class=astro-aSbGFxJW data-astro-cid-vn2w2o5l>LUCAS JOSINO</h3></a></div><nav class=astro-PXrUPWDT data-astro-cid-vn2w2o5l><a href=/blog/ class=astro-dDaGXTVT title="Go to blog page" style=--borderBottom:var(--border-color);--currentGap:0.6rem;--animatedGap:0.6rem;--iconColor:gray;--iconSize:1.2em;--display:flex data-astro-cid-trf4k3zj><span style=--borderBottom:var(--border-color);--currentGap:0.6rem;--animatedGap:0.6rem;--iconColor:gray;--iconSize:1.2em;--display:flex data-astro-cid-trf4k3zj>Blog</span> </a><a href=/projects/ class=astro-dDaGXTVT title="Go to projects page" style=--borderBottom:var(--border-color);--currentGap:0.6rem;--animatedGap:0.6rem;--iconColor:gray;--iconSize:1.2em;--display:flex data-astro-cid-trf4k3zj><span style=--borderBottom:var(--border-color);--currentGap:0.6rem;--animatedGap:0.6rem;--iconColor:gray;--iconSize:1.2em;--display:flex data-astro-cid-trf4k3zj>Projects</span> </a><button data-astro-cid-3vjzidht id=theme style=--position:initial><svg height=1em viewBox="0 0 24 24" width=1em data-icon=mdi:white-balance-sunny data-astro-cid-3vjzidht><symbol id=ai:mdi:white-balance-sunny><path d="m3.55 19.09l1.41 1.41l1.8-1.79l-1.42-1.42M12 6c-3.31 0-6 2.69-6 6s2.69 6 6 6s6-2.69 6-6c0-3.32-2.69-6-6-6m8 7h3v-2h-3m-2.76 7.71l1.8 1.79l1.41-1.41l-1.79-1.8M20.45 5l-1.41-1.4l-1.8 1.79l1.42 1.42M13 1h-2v3h2M6.76 5.39L4.96 3.6L3.55 5l1.79 1.81zM1 13h3v-2H1m12 9h-2v3h2" fill=currentColor /></symbol><use xlink:href=#ai:mdi:white-balance-sunny></use></svg></button><script>function sendMessage(e){const t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:e},"https://giscus.app")}const html=document.documentElement;document.getElementById("theme").addEventListener("click",(()=>{const e="light"===html.getAttribute("data-theme")?"dark":"light";localStorage.setItem("theme",e),html.setAttribute("data-theme",e),sendMessage({setConfig:{theme:getGiscusTheme(e)}})}))</script></nav></div><div class=header-menu-mobile data-astro-cid-vn2w2o5l></div></header><div class=astro-zznBcWrt data-astro-cid-dvdhntu2><div class=astro-NRtPNGTY data-astro-cid-dvdhntu2></div></div><a class=astro-SiSjWqkc data-astro-cid-5rdg3oos><svg height=1em viewBox="0 0 24 24" width=1em data-icon=mdi:arrow-up data-astro-cid-5rdg3oos><symbol id=ai:mdi:arrow-up><path d="M13 20h-2V8l-5.5 5.5l-1.42-1.42L12 4.16l7.92 7.92l-1.42 1.42L13 8z" fill=currentColor /></symbol><use xlink:href=#ai:mdi:arrow-up></use></svg> </a><a href="/blog/categories/How to" class=astro-dDaGXTVT title="See more from this category" style=--borderBottom:var(--border-color);--currentGap:0.6rem;--animatedGap:0.6rem;--iconColor:gray;--iconSize:1.2em;--display:flex data-astro-cid-trf4k3zj><h3 class=astro-DsDwf_jD data-astro-cid-26osaxeh style=--margin:0;--fontSize:1em;--textTransform:uppercase;--display:initial>How to</h3></a><h1 class=astro-RzLJuGLC data-astro-cid-xv6didhw style="--margin:0 0 1rem 0;--fontSize:2.5em;--textAlign:center">Go: How to mock SCS session authentication in tests</h1><img alt="Post - Go: How to mock SCS session authentication in tests" class=astro-pMrClxfx data-astro-cid-fwhsluhj src=https://raw.githubusercontent.com/lucjosin/lucasjosino.com/main/public/static/blog/ZfgJzcJf/golang-session-tests.png><div class=astro-ZPz_slmI data-astro-cid-5rm6lea6><span class=astro-KKpwRqgU data-astro-cid-ejkbpqkz><svg height=1em viewBox="0 0 24 24" width=1em data-icon=mdi:calendar-range data-astro-cid-ejkbpqkz><symbol id=ai:mdi:calendar-range><path d="M9 10H7v2h2zm4 0h-2v2h2zm4 0h-2v2h2zm2-7h-1V1h-2v2H8V1H6v2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2m0 16H5V8h14z" fill=currentColor /></symbol><use xlink:href=#ai:mdi:calendar-range></use></svg> <span class=astro-wfkkxwXL data-astro-cid-ze4jrga4>February 1, 2024 </span><span class=astro-CBAzzFXO data-astro-cid-ze4jrga4>4 months ago </span></span><span class=astro-KKpwRqgU data-astro-cid-ejkbpqkz><svg height=1em viewBox="0 0 24 24" width=1em data-icon=ic:outline-tag data-astro-cid-ejkbpqkz><symbol id=ai:ic:outline-tag><path d="M20 10V8h-4V4h-2v4h-4V4H8v4H4v2h4v4H4v2h4v4h2v-4h4v4h2v-4h4v-2h-4v-4zm-6 4h-4v-4h4z" fill=currentColor /></symbol><use xlink:href=#ai:ic:outline-tag></use></svg> <a href=#tags class=astro-dDaGXTVT title="See all tags" style=--borderBottom:var(--border-color);--currentGap:0.6rem;--animatedGap:0.6rem;--iconColor:gray;--iconSize:1.2em;--display:flex data-astro-cid-trf4k3zj><span style=--borderBottom:var(--border-color);--currentGap:0.6rem;--animatedGap:0.6rem;--iconColor:gray;--iconSize:1.2em;--display:flex data-astro-cid-trf4k3zj>Tags</span> </a></span><span class=astro-KKpwRqgU data-astro-cid-ejkbpqkz><svg height=1em viewBox="0 0 24 24" width=1em data-icon=mdi:clock-outline data-astro-cid-ejkbpqkz><symbol id=ai:mdi:clock-outline><path d="M12 20a8 8 0 0 0 8-8a8 8 0 0 0-8-8a8 8 0 0 0-8 8a8 8 0 0 0 8 8m0-18a10 10 0 0 1 10 10a10 10 0 0 1-10 10C6.47 22 2 17.5 2 12A10 10 0 0 1 12 2m.5 5v5.25l4.5 2.67l-.75 1.23L11 13V7z" fill=currentColor /></symbol><use xlink:href=#ai:mdi:clock-outline></use></svg> 6 min read </span><span class=astro-KKpwRqgU data-astro-cid-ejkbpqkz><svg height=1em viewBox="0 0 24 24" width=1em data-icon=mdi:comment-multiple-outline data-astro-cid-ejkbpqkz><symbol id=ai:mdi:comment-multiple-outline><path d="M12 23a1 1 0 0 1-1-1v-3H7a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-4.1l-3.7 3.71c-.2.19-.45.29-.7.29zm1-6v3.08L16.08 17H21V7H7v10zM3 15H1V3a2 2 0 0 1 2-2h16v2H3z" fill=currentColor /></symbol><use xlink:href=#ai:mdi:comment-multiple-outline></use></svg> <a href=#comments class=astro-dDaGXTVT title="Go to comments" style=--borderBottom:var(--border-color);--currentGap:0.6rem;--animatedGap:0.6rem;--iconColor:gray;--iconSize:1.2em;--display:flex data-astro-cid-trf4k3zj><span style=--borderBottom:var(--border-color);--currentGap:0.6rem;--animatedGap:0.6rem;--iconColor:gray;--iconSize:1.2em;--display:flex data-astro-cid-trf4k3zj>Comments</span></a></span></div><div class=astro-DxKEeFK_ style="--margin:0 0 1rem 0" data-astro-cid-6lpegvfu><div class=astro-wJoIcZrv data-astro-cid-fasyqkqy data-href="https://www.linkedin.com/sharing/share-offsite/?url=https://lucjos.in/b/ZfgJzcJf"><span class=astro-zzxFMCVP data-astro-cid-fasyqkqy>Share to Linkedin</span> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://lucjos.in/b/ZfgJzcJf" class=astro-ILL_kJwo title="Share to Linkedin" style="--padding:0.6rem 0.8rem;--iconSize:1em" data-astro-cid-tpz4yhk7 rel="noopener noreferrer" target=_blank data-umami-event="Post Share (Top) - Linkedin (/b/ZfgJzcJf)"><svg height=1em viewBox="0 0 24 24" width=1em data-icon=simple-icons:linkedin data-astro-cid-tpz4yhk7><symbol id=ai:simple-icons:linkedin><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037c-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85c3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 0 1-2.063-2.065a2.064 2.064 0 1 1 2.063 2.065m1.782 13.019H3.555V9h3.564zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0z" fill=currentColor /></symbol><use xlink:href=#ai:simple-icons:linkedin></use></svg></a></div><div class=astro-wJoIcZrv data-astro-cid-fasyqkqy data-href="https://x.com/intent/tweet?url=https://lucjos.in/b/ZfgJzcJf&text=Go:%20How%20to%20mock%20SCS%20session%20authentication%20in%20tests%20by%20@LucJosin"><span class=astro-zzxFMCVP data-astro-cid-fasyqkqy>Share to X (Twitter)</span> <a href="https://x.com/intent/tweet?url=https://lucjos.in/b/ZfgJzcJf&text=Go:%20How%20to%20mock%20SCS%20session%20authentication%20in%20tests%20by%20@LucJosin" class=astro-ILL_kJwo title="Share to X (Twitter)" style="--padding:0.6rem 0.8rem;--iconSize:1em" data-astro-cid-tpz4yhk7 rel="noopener noreferrer" target=_blank data-umami-event="Post Share (Top) - X (Twitter) (/b/ZfgJzcJf)"><svg height=1em viewBox="0 0 24 24" width=1em data-icon=simple-icons:x data-astro-cid-tpz4yhk7><symbol id=ai:simple-icons:x><path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584l-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z" fill=currentColor /></symbol><use xlink:href=#ai:simple-icons:x></use></svg></a></div><div class=astro-wJoIcZrv data-astro-cid-fasyqkqy data-href="https://reddit.com/submit?url=https://lucjos.in/b/ZfgJzcJf&title=Go:%20How%20to%20mock%20SCS%20session%20authentication%20in%20tests"><span class=astro-zzxFMCVP data-astro-cid-fasyqkqy>Share to Reddit</span> <a href="https://reddit.com/submit?url=https://lucjos.in/b/ZfgJzcJf&title=Go:%20How%20to%20mock%20SCS%20session%20authentication%20in%20tests" class=astro-ILL_kJwo title="Share to Reddit" style="--padding:0.6rem 0.8rem;--iconSize:1em" data-astro-cid-tpz4yhk7 rel="noopener noreferrer" target=_blank data-umami-event="Post Share (Top) - Reddit (/b/ZfgJzcJf)"><svg height=1em viewBox="0 0 24 24" width=1em data-icon=simple-icons:reddit data-astro-cid-tpz4yhk7><symbol id=ai:simple-icons:reddit><path d="M12 0C5.373 0 0 5.373 0 12c0 3.314 1.343 6.314 3.515 8.485l-2.286 2.286A.72.72 0 0 0 1.738 24H12c6.627 0 12-5.373 12-12S18.627 0 12 0m4.388 3.199a1.999 1.999 0 1 1-1.947 2.46v.002a2.368 2.368 0 0 0-2.032 2.341v.007c1.776.067 3.4.567 4.686 1.363a2.802 2.802 0 1 1 2.908 4.753c-.088 3.256-3.637 5.876-7.997 5.876c-4.361 0-7.905-2.617-7.998-5.87a2.8 2.8 0 0 1 1.189-5.34c.645 0 1.239.218 1.712.585c1.275-.79 2.881-1.291 4.64-1.365v-.01a3.229 3.229 0 0 1 2.88-3.207a2 2 0 0 1 1.959-1.595m-8.085 8.376c-.784 0-1.459.78-1.506 1.797c-.047 1.016.64 1.429 1.426 1.429c.786 0 1.371-.369 1.418-1.385c.047-1.017-.553-1.841-1.338-1.841m7.406 0c-.786 0-1.385.824-1.338 1.841c.047 1.017.634 1.385 1.418 1.385c.785 0 1.473-.413 1.426-1.429c-.046-1.017-.721-1.797-1.506-1.797m-3.703 4.013c-.974 0-1.907.048-2.77.135a.222.222 0 0 0-.183.305a3.199 3.199 0 0 0 2.953 1.964a3.2 3.2 0 0 0 2.953-1.964a.222.222 0 0 0-.184-.305a27.75 27.75 0 0 0-2.769-.135" fill=currentColor /></symbol><use xlink:href=#ai:simple-icons:reddit></use></svg></a></div><div class=astro-wJoIcZrv data-astro-cid-fasyqkqy data-href="https://bsky.app/intent/compose?text=Go%3A%20How%20to%20mock%20SCS%20session%20authentication%20in%20tests%20%23golang%20%23go-chi%20%23tests%20%23auth%20%23session%20https%3A%2F%2Flucjos.in%2Fb%2FZfgJzcJf"><span class=astro-zzxFMCVP data-astro-cid-fasyqkqy>Share to Bluesky</span> <a href="https://bsky.app/intent/compose?text=Go%3A%20How%20to%20mock%20SCS%20session%20authentication%20in%20tests%20%23golang%20%23go-chi%20%23tests%20%23auth%20%23session%20https%3A%2F%2Flucjos.in%2Fb%2FZfgJzcJf" class=astro-ILL_kJwo title="Share to Bluesky" style="--padding:0.6rem 0.8rem;--iconSize:1em" data-astro-cid-tpz4yhk7 rel="noopener noreferrer" target=_blank data-umami-event="Post Share (Top) - Blueksy (/b/ZfgJzcJf)"><svg height=1em viewBox="0 0 24 24" width=1em data-icon=simple-icons:bluesky data-astro-cid-tpz4yhk7><symbol id=ai:simple-icons:bluesky><path d="M12 10.8c-1.087-2.114-4.046-6.053-6.798-7.995C2.566.944 1.561 1.266.902 1.565C.139 1.908 0 3.08 0 3.768c0 .69.378 5.65.624 6.479c.815 2.736 3.713 3.66 6.383 3.364c.136-.02.275-.039.415-.056c-.138.022-.276.04-.415.056c-3.912.58-7.387 2.005-2.83 7.078c5.013 5.19 6.87-1.113 7.823-4.308c.953 3.195 2.05 9.271 7.733 4.308c4.267-4.308 1.172-6.498-2.74-7.078a8.741 8.741 0 0 1-.415-.056c.14.017.279.036.415.056c2.67.297 5.568-.628 6.383-3.364c.246-.828.624-5.79.624-6.478c0-.69-.139-1.861-.902-2.206c-.659-.298-1.664-.62-4.3 1.24C16.046 4.748 13.087 8.687 12 10.8" fill=currentColor /></symbol><use xlink:href=#ai:simple-icons:bluesky></use></svg></a></div><div class=astro-wJoIcZrv data-astro-cid-fasyqkqy data-href=https://lucjos.in/b/ZfgJzcJf id=share><span class=astro-zzxFMCVP data-astro-cid-fasyqkqy id=share-title>Copy link</span> <a href=https://lucjos.in/b/ZfgJzcJf class=astro-ILL_kJwo title="Copy link" style="--padding:0.6rem 0.8rem;--iconSize:1em" data-astro-cid-tpz4yhk7 rel="noopener noreferrer" target=_blank data-umami-event="Post Share (Top) - Copy link (/b/ZfgJzcJf)"><svg height=1em viewBox="0 0 24 24" width=1em data-icon=mdi:link data-astro-cid-tpz4yhk7><symbol id=ai:mdi:link><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7a5 5 0 0 0-5 5a5 5 0 0 0 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1c0 1.71-1.39 3.1-3.1 3.1h-4V17h4a5 5 0 0 0 5-5a5 5 0 0 0-5-5" fill=currentColor /></symbol><use xlink:href=#ai:mdi:link></use></svg></a></div></div><div class=astro-uBZNRUCf style=--height:1px;--width:100%;--margin:0 data-astro-cid-4d7p4lxg></div><article class="astro-kJzNRUUP astro-stOMIxRY"><h2 id=table-of-contents>Table of Contents<a href=#table-of-contents class=astro-brwhiAEl aria-hidden="" tabindex=-1><svg height=18 viewBox="0 0 24 24" width=18 class=autolink-svg fill=currentColor marginLeft=1rem xmlns=http://www.w3.org/2000/svg><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h2><p></p><details><summary>Open Table of Contents</summary><p></p><ul><li><a href=#introduction>Introduction</a></li><li><a href=#server-config>Server config</a></li><li><a href=#server-routes>Server routes</a></li><li><a href=#middleware-for-user-authorization>Middleware for user authorization</a></li><li><a href=#the-testing>The testing</a></li><li><a href=#loadandsavemock-middleware>LoadAndSaveMock middleware</a></li><li><a href=#putting-all-together>Putting all together</a></li><li><a href=#conclusion>Conclusion</a></li><li><a href=#resources-and-references>Resources and References</a></li></ul><p></p></details><p></p><h2 id=introduction>Introduction<a href=#introduction class=astro-brwhiAEl aria-hidden="" tabindex=-1><svg height=18 viewBox="0 0 24 24" width=18 class=autolink-svg fill=currentColor marginLeft=1rem xmlns=http://www.w3.org/2000/svg><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h2><p>While working on a personal project using Go and <a href=https://github.com/alexedwards/scs rel="noopener noreferrer" target=_blank>alexedwards/scs<span><svg height=16 viewBox="0 0 24 24" width=16 class=astro-zThxBkxg fill=currentColor marginLeft=1rem xmlns=http://www.w3.org/2000/svg><path d="M14 3v2h3.59l-9.83 9.83l1.41 1.41L19 6.41V10h2V3m-2 16H5V5h7V3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7h-2v7Z"></path></svg></span></a>for handling sessions, I’ve come across an issue when creating tests: After setting up the configuration and the <code>LoadAndSave</code> middleware, all tests started failing with 401 (Unauthorized) response.</p><p>In this quickly post we’ll simple a small GoLang server using <a href=https://go-chi.io rel="noopener noreferrer" target=_blank>go-chi<span><svg height=16 viewBox="0 0 24 24" width=16 class=astro-zThxBkxg fill=currentColor marginLeft=1rem xmlns=http://www.w3.org/2000/svg><path d="M14 3v2h3.59l-9.83 9.83l1.41 1.41L19 6.41V10h2V3m-2 16H5V5h7V3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7h-2v7Z"></path></svg></span></a>router and implement a <code>LoadAndSaveMock</code> middleware to inject any session information into our test.</p><p>Or if you want to go direct to the <a href=#implementing-loadandsavemock-middleware>LoadAndSaveMock middleware</a> :)</p><h2 id=server-config>Server config<a href=#server-config class=astro-brwhiAEl aria-hidden="" tabindex=-1><svg height=18 viewBox="0 0 24 24" width=18 class=autolink-svg fill=currentColor marginLeft=1rem xmlns=http://www.w3.org/2000/svg><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h2><p>First, let’s create a <code>Server</code> struct to hold our session manager and router</p><div class=expressive-code><link href=/_astro/ec.9oy3g.css rel=stylesheet><script src=/_astro/ec.3zb7u.js type=module></script><figure class="frame has-title"><figcaption class=header><span class=title>main.go</span></figcaption><pre data-language=go><code><div class=ec-line><div class=gutter><div class=ln>1</div></div><div class=code><span style=--0:#569CD6;--1:#0000FF>type</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#4EC9B0;--1:#227188>Server</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#569CD6;--1:#0000FF>struct</span><span style=--0:#D4D4D4;--1:#000000> {</span></div></div><div class=ec-line><div class=gutter><div class=ln>2</div></div><div class=code><span class=indent>  </span><span style=--0:#9CDCFE;--1:#001080>session</span><span style=--0:#D4D4D4;--1:#000000> *</span><span style=--0:#4EC9B0;--1:#227188>scs</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#4EC9B0;--1:#227188>SessionManager</span></div></div><div class=ec-line><div class=gutter><div class=ln>3</div></div><div class=code><span class=indent>  </span><span style=--0:#9CDCFE;--1:#001080>router</span><span style=--0:#D4D4D4;--1:#000000>  *</span><span style=--0:#4EC9B0;--1:#227188>chi</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#4EC9B0;--1:#227188>Mux</span></div></div><div class=ec-line><div class=gutter><div class=ln>4</div></div><div class=code><span style=--0:#D4D4D4;--1:#000000>}</span></div></div></code></pre><div class=copy><button data-code="type Server struct {  session *scs.SessionManager  router  *chi.Mux}" data-copied=Copied! title="Copy to clipboard"><div></div></button></div></figure></div><p>And now, create our main function, session, router and server</p><div class=expressive-code><figure class="frame has-title"><figcaption class=header><span class=title>main.go</span></figcaption><pre data-language=go><code><div class=ec-line><div class=gutter><div class=ln>1</div></div><div class=code><span style=--0:#569CD6;--1:#0000FF>type</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#4EC9B0;--1:#227188>Server</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#569CD6;--1:#0000FF>struct</span><span style=--0:#D4D4D4;--1:#000000> {</span></div></div><div class=ec-line><div class=gutter><div class=ln>2</div></div><div class=code><span class=indent>  </span><span style=--0:#9CDCFE;--1:#001080>session</span><span style=--0:#D4D4D4;--1:#000000> *</span><span style=--0:#4EC9B0;--1:#227188>scs</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#4EC9B0;--1:#227188>SessionManager</span></div></div><div class=ec-line><div class=gutter><div class=ln>3</div></div><div class=code><span class=indent>  </span><span style=--0:#9CDCFE;--1:#001080>router</span><span style=--0:#D4D4D4;--1:#000000>  *</span><span style=--0:#4EC9B0;--1:#227188>chi</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#4EC9B0;--1:#227188>Mux</span></div></div><div class=ec-line><div class=gutter><div class=ln>4</div></div><div class=code><span style=--0:#D4D4D4;--1:#000000>}</span></div></div><div class=ec-line><div class=gutter><div class=ln>5</div></div><div class=code>
</div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>6</div></div><div class=code><span style=--0:#7cb3df;--1:#0000FF>func</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#DCDCAA;--1:#664f20>main</span><span style=--0:#D4D4D4;--1:#000000>() {</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>7</div></div><div class=code><span class=indent>  </span><span style=--0:#9CDCFE;--1:#001080>session</span><span style=--0:#D4D4D4;--1:#000000> := </span><span style=--0:#9CDCFE;--1:#001080>scs</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#664f20>New</span><span style=--0:#D4D4D4;--1:#000000>()</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>8</div></div><div class=code><span class=indent>  </span><span style=--0:#9CDCFE;--1:#001080>router</span><span style=--0:#D4D4D4;--1:#000000> := </span><span style=--0:#9CDCFE;--1:#001080>chi</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#664f20>NewRouter</span><span style=--0:#D4D4D4;--1:#000000>()</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>9</div></div><div class=code><span class=indent>  </span><span style=--0:#9CDCFE;--1:#001080>server</span><span style=--0:#D4D4D4;--1:#000000> := &#x26;</span><span style=--0:#4EC9B0;--1:#1b5a6c>Server</span><span style=--0:#D4D4D4;--1:#000000>{</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>10</div></div><div class=code><span class=indent>    </span><span style=--0:#9CDCFE;--1:#001080>session</span><span style=--0:#D4D4D4;--1:#000000>: </span><span style=--0:#9CDCFE;--1:#001080>session</span><span style=--0:#D4D4D4;--1:#000000>,</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>11</div></div><div class=code><span class=indent>    </span><span style=--0:#9CDCFE;--1:#001080>router</span><span style=--0:#D4D4D4;--1:#000000>:  </span><span style=--0:#9CDCFE;--1:#001080>router</span><span style=--0:#D4D4D4;--1:#000000>,</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>12</div></div><div class=code><span class=indent><span style=--0:#D4D4D4;--1:#000000>  </span></span><span style=--0:#D4D4D4;--1:#000000>}</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>13</div></div><div class=code>
</div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>14</div></div><div class=code><span class=indent>  </span><span style=--0:#9CDCFE;--1:#001080>router</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#664f20>Use</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#9CDCFE;--1:#001080>session</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#9CDCFE;--1:#001080>LoadAndSave</span><span style=--0:#D4D4D4;--1:#000000>)</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>15</div></div><div class=code><span style=--0:#D4D4D4;--1:#000000>}</span></div></div></code></pre><div class=copy><button data-code="type Server struct {  session *scs.SessionManager  router  *chi.Mux}func main() {  session := scs.New()  router := chi.NewRouter()  server := &#x26;Server{    session: session,    router:  router,  }  router.Use(session.LoadAndSave)}" data-copied=Copied! title="Copy to clipboard"><div></div></button></div></figure></div><div class="astro-dVIMOxAO astro-hLESpbTV"><p>Note that we are defining the <code>LoadAndSave</code> middleware from the SCS session. This middleware will get the value from the cookie and save into our request context.</p></div><h2 id=server-routes>Server routes<a href=#server-routes class=astro-brwhiAEl aria-hidden="" tabindex=-1><svg height=18 viewBox="0 0 24 24" width=18 class=autolink-svg fill=currentColor marginLeft=1rem xmlns=http://www.w3.org/2000/svg><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h2><p>We can now define two routes:</p><ul><li>/ - Will return 200 (Ok) with the message “Hello, World!” and insert an <code>user_role</code> value into our context</li><li>/admin - Will return 200 (Ok) with the message “Hello, &#x3C;role>!”</li></ul><div class="astro-dVIMOxAO astro-yVAZZnYw"><p>If we request the <code>/admin</code> endpoint before requesting the root endpoint, we should get an 401 (Unauthorized) status code.</p></div><p>Let’s implement all handlers:</p><div class=expressive-code><figure class="frame has-title"><figcaption class=header><span class=title>main.go</span></figcaption><pre data-language=go><code><div class=ec-line><div class=gutter><div class=ln>1</div></div><div class=code><span style=--0:#569CD6;--1:#0000FF>func</span><span style=--0:#D4D4D4;--1:#000000> (</span><span style=--0:#9CDCFE;--1:#001080>s </span><span style=--0:#D4D4D4;--1:#000000>*</span><span style=--0:#4EC9B0;--1:#227188>Server</span><span style=--0:#D4D4D4;--1:#000000>) </span><span style=--0:#DCDCAA;--1:#795E26>handleHelloWorld</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#9CDCFE;--1:#001080>w</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#4EC9B0;--1:#227188>http</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#4EC9B0;--1:#227188>ResponseWriter</span><span style=--0:#D4D4D4;--1:#000000>, </span><span style=--0:#9CDCFE;--1:#001080>r</span><span style=--0:#D4D4D4;--1:#000000> *</span><span style=--0:#4EC9B0;--1:#227188>http</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#4EC9B0;--1:#227188>Request</span><span style=--0:#D4D4D4;--1:#000000>) {</span></div></div><div class=ec-line><div class=gutter><div class=ln>2</div></div><div class=code><span class=indent>  </span><span style=--0:#74A061;--1:#007A00>// Save "ADMIN" value into "user_role"</span></div></div><div class=ec-line><div class=gutter><div class=ln>3</div></div><div class=code><span class=indent>  </span><span style=--0:#9CDCFE;--1:#001080>s</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#9CDCFE;--1:#001080>session</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#795E26>Put</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#9CDCFE;--1:#001080>r</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#795E26>Context</span><span style=--0:#D4D4D4;--1:#000000>(), </span><span style=--0:#CE9178;--1:#A31515>"user_role"</span><span style=--0:#D4D4D4;--1:#000000>, </span><span style=--0:#CE9178;--1:#A31515>"ADMIN"</span><span style=--0:#D4D4D4;--1:#000000>)</span></div></div><div class=ec-line><div class=gutter><div class=ln>4</div></div><div class=code>
</div></div><div class=ec-line><div class=gutter><div class=ln>5</div></div><div class=code><span class=indent>  </span><span style=--0:#74A061;--1:#007A00>// Send the message (By default, will send a 200 status code)</span></div></div><div class=ec-line><div class=gutter><div class=ln>6</div></div><div class=code><span class=indent>  </span><span style=--0:#9CDCFE;--1:#001080>w</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#795E26>Write</span><span style=--0:#D4D4D4;--1:#000000>([]</span><span style=--0:#4EC9B0;--1:#227188>byte</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#CE9178;--1:#A31515>"Hello, World!"</span><span style=--0:#D4D4D4;--1:#000000>))</span></div></div><div class=ec-line><div class=gutter><div class=ln>7</div></div><div class=code><span style=--0:#D4D4D4;--1:#000000>}</span></div></div><div class=ec-line><div class=gutter><div class=ln>8</div></div><div class=code>
</div></div><div class=ec-line><div class=gutter><div class=ln>9</div></div><div class=code><span style=--0:#569CD6;--1:#0000FF>func</span><span style=--0:#D4D4D4;--1:#000000> (</span><span style=--0:#9CDCFE;--1:#001080>s </span><span style=--0:#D4D4D4;--1:#000000>*</span><span style=--0:#4EC9B0;--1:#227188>Server</span><span style=--0:#D4D4D4;--1:#000000>) </span><span style=--0:#DCDCAA;--1:#795E26>handleAdmin</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#9CDCFE;--1:#001080>w</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#4EC9B0;--1:#227188>http</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#4EC9B0;--1:#227188>ResponseWriter</span><span style=--0:#D4D4D4;--1:#000000>, </span><span style=--0:#9CDCFE;--1:#001080>r</span><span style=--0:#D4D4D4;--1:#000000> *</span><span style=--0:#4EC9B0;--1:#227188>http</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#4EC9B0;--1:#227188>Request</span><span style=--0:#D4D4D4;--1:#000000>) {</span></div></div><div class=ec-line><div class=gutter><div class=ln>10</div></div><div class=code><span class=indent>  </span><span style=--0:#74A061;--1:#007A00>// Get the "user_role" value from request context</span></div></div><div class=ec-line><div class=gutter><div class=ln>11</div></div><div class=code><span class=indent>  </span><span style=--0:#9CDCFE;--1:#001080>role</span><span style=--0:#D4D4D4;--1:#000000> := </span><span style=--0:#9CDCFE;--1:#001080>s</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#9CDCFE;--1:#001080>session</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#795E26>GetString</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#9CDCFE;--1:#001080>r</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#795E26>Context</span><span style=--0:#D4D4D4;--1:#000000>(), </span><span style=--0:#CE9178;--1:#A31515>"user_role"</span><span style=--0:#D4D4D4;--1:#000000>)</span></div></div><div class=ec-line><div class=gutter><div class=ln>12</div></div><div class=code>
</div></div><div class=ec-line><div class=gutter><div class=ln>13</div></div><div class=code><span class=indent>  </span><span style=--0:#74A061;--1:#007A00>// By default, GetString will return an empty string if no value is found</span></div></div><div class=ec-line><div class=gutter><div class=ln>14</div></div><div class=code><span class=indent>  </span><span style=--0:#C586C0;--1:#AC00D8>if</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#9CDCFE;--1:#001080>role</span><span style=--0:#D4D4D4;--1:#000000> == </span><span style=--0:#CE9178;--1:#A31515>""</span><span style=--0:#D4D4D4;--1:#000000> {</span></div></div><div class=ec-line><div class=gutter><div class=ln>15</div></div><div class=code><span class=indent>    </span><span style=--0:#9CDCFE;--1:#001080>w</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#795E26>WriteHeader</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#9CDCFE;--1:#001080>http</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#9CDCFE;--1:#001080>StatusUnauthorized</span><span style=--0:#D4D4D4;--1:#000000>)</span></div></div><div class=ec-line><div class=gutter><div class=ln>16</div></div><div class=code><span class=indent>    </span><span style=--0:#C586C0;--1:#AC00D8>return</span></div></div><div class=ec-line><div class=gutter><div class=ln>17</div></div><div class=code><span class=indent><span style=--0:#D4D4D4;--1:#000000>  </span></span><span style=--0:#D4D4D4;--1:#000000>}</span></div></div><div class=ec-line><div class=gutter><div class=ln>18</div></div><div class=code>
</div></div><div class=ec-line><div class=gutter><div class=ln>19</div></div><div class=code><span class=indent>  </span><span style=--0:#74A061;--1:#007A00>// Send the message (By default, will send a 200 status code)</span></div></div><div class=ec-line><div class=gutter><div class=ln>20</div></div><div class=code><span class=indent>  </span><span style=--0:#9CDCFE;--1:#001080>w</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#795E26>Write</span><span style=--0:#D4D4D4;--1:#000000>([]</span><span style=--0:#4EC9B0;--1:#227188>byte</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#CE9178;--1:#A31515>"Welcome, "</span><span style=--0:#D4D4D4;--1:#000000> + </span><span style=--0:#9CDCFE;--1:#001080>role</span><span style=--0:#D4D4D4;--1:#000000> + </span><span style=--0:#CE9178;--1:#A31515>"!"</span><span style=--0:#D4D4D4;--1:#000000>))</span></div></div><div class=ec-line><div class=gutter><div class=ln>21</div></div><div class=code><span style=--0:#D4D4D4;--1:#000000>}</span></div></div></code></pre><div class=copy><button data-code="func (s *Server) handleHelloWorld(w http.ResponseWriter, r *http.Request) {  // Save &#x22;ADMIN&#x22; value into &#x22;user_role&#x22;  s.session.Put(r.Context(), &#x22;user_role&#x22;, &#x22;ADMIN&#x22;)  // Send the message (By default, will send a 200 status code)  w.Write([]byte(&#x22;Hello, World!&#x22;))}func (s *Server) handleAdmin(w http.ResponseWriter, r *http.Request) {  // Get the &#x22;user_role&#x22; value from request context  role := s.session.GetString(r.Context(), &#x22;user_role&#x22;)  // By default, GetString will return an empty string if no value is found  if role == &#x22;&#x22; {    w.WriteHeader(http.StatusUnauthorized)    return  }  // Send the message (By default, will send a 200 status code)  w.Write([]byte(&#x22;Welcome, &#x22; + role + &#x22;!&#x22;))}" data-copied=Copied! title="Copy to clipboard"><div></div></button></div></figure></div><p>Defining the handlers into router:</p><div class=expressive-code><figure class="frame has-title"><figcaption class=header><span class=title>main.go</span></figcaption><pre data-language=go><code><div class=ec-line><div class=gutter><div class=ln>1</div></div><div class=code><span style=--0:#569CD6;--1:#0000FF>type</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#4EC9B0;--1:#227188>Server</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#569CD6;--1:#0000FF>struct</span><span style=--0:#D4D4D4;--1:#000000> {</span></div></div><div class=ec-line><div class=gutter><div class=ln>2</div></div><div class=code><span class=indent>  </span><span style=--0:#9CDCFE;--1:#001080>session</span><span style=--0:#D4D4D4;--1:#000000> *</span><span style=--0:#4EC9B0;--1:#227188>scs</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#4EC9B0;--1:#227188>SessionManager</span></div></div><div class=ec-line><div class=gutter><div class=ln>3</div></div><div class=code><span class=indent>  </span><span style=--0:#9CDCFE;--1:#001080>router</span><span style=--0:#D4D4D4;--1:#000000>  *</span><span style=--0:#4EC9B0;--1:#227188>chi</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#4EC9B0;--1:#227188>Mux</span></div></div><div class=ec-line><div class=gutter><div class=ln>4</div></div><div class=code><span style=--0:#D4D4D4;--1:#000000>}</span></div></div><div class=ec-line><div class=gutter><div class=ln>5</div></div><div class=code>
</div></div><div class=ec-line><div class=gutter><div class=ln>6</div></div><div class=code><span style=--0:#569CD6;--1:#0000FF>func</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#DCDCAA;--1:#795E26>main</span><span style=--0:#D4D4D4;--1:#000000>() {</span></div></div><div class=ec-line><div class=gutter><div class=ln>7</div></div><div class=code><span class=indent>  </span><span style=--0:#9CDCFE;--1:#001080>session</span><span style=--0:#D4D4D4;--1:#000000> := </span><span style=--0:#9CDCFE;--1:#001080>scs</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#795E26>New</span><span style=--0:#D4D4D4;--1:#000000>()</span></div></div><div class=ec-line><div class=gutter><div class=ln>8</div></div><div class=code><span class=indent>  </span><span style=--0:#9CDCFE;--1:#001080>router</span><span style=--0:#D4D4D4;--1:#000000> := </span><span style=--0:#9CDCFE;--1:#001080>chi</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#795E26>NewRouter</span><span style=--0:#D4D4D4;--1:#000000>()</span></div></div><div class=ec-line><div class=gutter><div class=ln>9</div></div><div class=code><span class=indent>  </span><span style=--0:#9CDCFE;--1:#001080>server</span><span style=--0:#D4D4D4;--1:#000000> := &#x26;</span><span style=--0:#4EC9B0;--1:#227188>Server</span><span style=--0:#D4D4D4;--1:#000000>{</span></div></div><div class=ec-line><div class=gutter><div class=ln>10</div></div><div class=code><span class=indent>    </span><span style=--0:#9CDCFE;--1:#001080>session</span><span style=--0:#D4D4D4;--1:#000000>: </span><span style=--0:#9CDCFE;--1:#001080>session</span><span style=--0:#D4D4D4;--1:#000000>,</span></div></div><div class=ec-line><div class=gutter><div class=ln>11</div></div><div class=code><span class=indent>    </span><span style=--0:#9CDCFE;--1:#001080>router</span><span style=--0:#D4D4D4;--1:#000000>:  </span><span style=--0:#9CDCFE;--1:#001080>router</span><span style=--0:#D4D4D4;--1:#000000>,</span></div></div><div class=ec-line><div class=gutter><div class=ln>12</div></div><div class=code><span class=indent><span style=--0:#D4D4D4;--1:#000000>  </span></span><span style=--0:#D4D4D4;--1:#000000>}</span></div></div><div class=ec-line><div class=gutter><div class=ln>13</div></div><div class=code>
</div></div><div class=ec-line><div class=gutter><div class=ln>14</div></div><div class=code><span class=indent>  </span><span style=--0:#9CDCFE;--1:#001080>router</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#795E26>Use</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#9CDCFE;--1:#001080>session</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#9CDCFE;--1:#001080>LoadAndSave</span><span style=--0:#D4D4D4;--1:#000000>)</span></div></div><div class=ec-line><div class=gutter><div class=ln>15</div></div><div class=code>
</div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>16</div></div><div class=code><span class=indent>  </span><span style=--0:#95b686;--1:#006100>// Routes</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>17</div></div><div class=code><span class=indent>  </span><span style=--0:#9CDCFE;--1:#001080>router</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#664f20>Get</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#d5a18c;--1:#A31515>"/"</span><span style=--0:#D4D4D4;--1:#000000>, </span><span style=--0:#9CDCFE;--1:#001080>server</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#9CDCFE;--1:#001080>handleHelloWorld</span><span style=--0:#D4D4D4;--1:#000000>)</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>18</div></div><div class=code><span class=indent>  </span><span style=--0:#9CDCFE;--1:#001080>router</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#664f20>Group</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#7cb3df;--1:#0000FF>func</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#9CDCFE;--1:#001080>router</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#4EC9B0;--1:#1b5a6c>chi</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#4EC9B0;--1:#1b5a6c>Router</span><span style=--0:#D4D4D4;--1:#000000>) {</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>19</div></div><div class=code><span class=indent>    </span><span style=--0:#9CDCFE;--1:#001080>router</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#664f20>Get</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#d5a18c;--1:#A31515>"/admin"</span><span style=--0:#D4D4D4;--1:#000000>, </span><span style=--0:#9CDCFE;--1:#001080>server</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#9CDCFE;--1:#001080>handleAdmin</span><span style=--0:#D4D4D4;--1:#000000>)</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>20</div></div><div class=code><span class=indent><span style=--0:#D4D4D4;--1:#000000>  </span></span><span style=--0:#D4D4D4;--1:#000000>})</span></div></div><div class=ec-line><div class=gutter><div class=ln>21</div></div><div class=code>
</div></div><div class=ec-line><div class=gutter><div class=ln>22</div></div><div class=code><span class=indent>  </span><span style=--0:#9CDCFE;--1:#001080>http</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#795E26>ListenAndServe</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#CE9178;--1:#A31515>":6987"</span><span style=--0:#D4D4D4;--1:#000000>, </span><span style=--0:#9CDCFE;--1:#001080>router</span><span style=--0:#D4D4D4;--1:#000000>)</span></div></div><div class=ec-line><div class=gutter><div class=ln>23</div></div><div class=code><span style=--0:#D4D4D4;--1:#000000>}</span></div></div><div class=ec-line><div class=gutter><div class=ln>24</div></div><div class=code>
</div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>25</div></div><div class=code><span style=--0:#7cb3df;--1:#0000FF>func</span><span style=--0:#D4D4D4;--1:#000000> (</span><span style=--0:#9CDCFE;--1:#001080>s </span><span style=--0:#D4D4D4;--1:#000000>*</span><span style=--0:#4EC9B0;--1:#1b5a6c>Server</span><span style=--0:#D4D4D4;--1:#000000>) </span><span style=--0:#DCDCAA;--1:#664f20>handleHelloWorld</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#9CDCFE;--1:#001080>w</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#4EC9B0;--1:#1b5a6c>http</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#4EC9B0;--1:#1b5a6c>ResponseWriter</span><span style=--0:#D4D4D4;--1:#000000>, </span><span style=--0:#9CDCFE;--1:#001080>r</span><span style=--0:#D4D4D4;--1:#000000> *</span><span style=--0:#4EC9B0;--1:#1b5a6c>http</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#4EC9B0;--1:#1b5a6c>Request</span><span style=--0:#D4D4D4;--1:#000000>) {</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>26</div></div><div class=code><span class=indent>  </span><span style=--0:#95b686;--1:#006100>// Save "ADMIN" value into "user_role"</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>27</div></div><div class=code><span class=indent>  </span><span style=--0:#9CDCFE;--1:#001080>s</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#9CDCFE;--1:#001080>session</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#664f20>Put</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#9CDCFE;--1:#001080>r</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#664f20>Context</span><span style=--0:#D4D4D4;--1:#000000>(), </span><span style=--0:#d5a18c;--1:#A31515>"user_role"</span><span style=--0:#D4D4D4;--1:#000000>, </span><span style=--0:#d5a18c;--1:#A31515>"ADMIN"</span><span style=--0:#D4D4D4;--1:#000000>)</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>28</div></div><div class=code>
</div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>29</div></div><div class=code><span class=indent>  </span><span style=--0:#95b686;--1:#006100>// Send the message (By default, will send a 200 status code)</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>30</div></div><div class=code><span class=indent>  </span><span style=--0:#9CDCFE;--1:#001080>w</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#664f20>Write</span><span style=--0:#D4D4D4;--1:#000000>([]</span><span style=--0:#4EC9B0;--1:#1b5a6c>byte</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#d5a18c;--1:#A31515>"Hello, World!"</span><span style=--0:#D4D4D4;--1:#000000>))</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>31</div></div><div class=code><span style=--0:#D4D4D4;--1:#000000>}</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>32</div></div><div class=code>
</div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>33</div></div><div class=code><span style=--0:#7cb3df;--1:#0000FF>func</span><span style=--0:#D4D4D4;--1:#000000> (</span><span style=--0:#9CDCFE;--1:#001080>s </span><span style=--0:#D4D4D4;--1:#000000>*</span><span style=--0:#4EC9B0;--1:#1b5a6c>Server</span><span style=--0:#D4D4D4;--1:#000000>) </span><span style=--0:#DCDCAA;--1:#664f20>handleAdmin</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#9CDCFE;--1:#001080>w</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#4EC9B0;--1:#1b5a6c>http</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#4EC9B0;--1:#1b5a6c>ResponseWriter</span><span style=--0:#D4D4D4;--1:#000000>, </span><span style=--0:#9CDCFE;--1:#001080>r</span><span style=--0:#D4D4D4;--1:#000000> *</span><span style=--0:#4EC9B0;--1:#1b5a6c>http</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#4EC9B0;--1:#1b5a6c>Request</span><span style=--0:#D4D4D4;--1:#000000>) {</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>34</div></div><div class=code><span class=indent>  </span><span style=--0:#95b686;--1:#006100>// Get the "user_role" value from request context</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>35</div></div><div class=code><span class=indent>  </span><span style=--0:#9CDCFE;--1:#001080>role</span><span style=--0:#D4D4D4;--1:#000000> := </span><span style=--0:#9CDCFE;--1:#001080>s</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#9CDCFE;--1:#001080>session</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#664f20>GetString</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#9CDCFE;--1:#001080>r</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#664f20>Context</span><span style=--0:#D4D4D4;--1:#000000>(), </span><span style=--0:#d5a18c;--1:#A31515>"user_role"</span><span style=--0:#D4D4D4;--1:#000000>)</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>36</div></div><div class=code>
</div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>37</div></div><div class=code><span class=indent>  </span><span style=--0:#95b686;--1:#006100>// By default, GetString will return an empty string if no value is found</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>38</div></div><div class=code><span class=indent>  </span><span style=--0:#d09dcc;--1:#8c00b0>if</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#9CDCFE;--1:#001080>role</span><span style=--0:#D4D4D4;--1:#000000> == </span><span style=--0:#d5a18c;--1:#A31515>""</span><span style=--0:#D4D4D4;--1:#000000> {</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>39</div></div><div class=code><span class=indent>    </span><span style=--0:#9CDCFE;--1:#001080>w</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#664f20>WriteHeader</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#9CDCFE;--1:#001080>http</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#9CDCFE;--1:#001080>StatusUnauthorized</span><span style=--0:#D4D4D4;--1:#000000>)</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>40</div></div><div class=code><span class=indent>    </span><span style=--0:#d09dcc;--1:#8c00b0>return</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>41</div></div><div class=code><span class=indent><span style=--0:#D4D4D4;--1:#000000>  </span></span><span style=--0:#D4D4D4;--1:#000000>}</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>42</div></div><div class=code>
</div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>43</div></div><div class=code><span class=indent>  </span><span style=--0:#95b686;--1:#006100>// Send the message (By default, will send a 200 status code)</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>44</div></div><div class=code><span class=indent>  </span><span style=--0:#9CDCFE;--1:#001080>w</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#664f20>Write</span><span style=--0:#D4D4D4;--1:#000000>([]</span><span style=--0:#4EC9B0;--1:#1b5a6c>byte</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#d5a18c;--1:#A31515>"Welcome, "</span><span style=--0:#D4D4D4;--1:#000000> + </span><span style=--0:#9CDCFE;--1:#001080>role</span><span style=--0:#D4D4D4;--1:#000000> + </span><span style=--0:#d5a18c;--1:#A31515>"!"</span><span style=--0:#D4D4D4;--1:#000000>))</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>45</div></div><div class=code><span style=--0:#D4D4D4;--1:#000000>}</span></div></div></code></pre><div class=copy><button data-code="type Server struct {  session *scs.SessionManager  router  *chi.Mux}func main() {  session := scs.New()  router := chi.NewRouter()  server := &#x26;Server{    session: session,    router:  router,  }  router.Use(session.LoadAndSave)  // Routes  router.Get(&#x22;/&#x22;, server.handleHelloWorld)  router.Group(func(router chi.Router) {    router.Get(&#x22;/admin&#x22;, server.handleAdmin)  })  http.ListenAndServe(&#x22;:6987&#x22;, router)}func (s *Server) handleHelloWorld(w http.ResponseWriter, r *http.Request) {  // Save &#x22;ADMIN&#x22; value into &#x22;user_role&#x22;  s.session.Put(r.Context(), &#x22;user_role&#x22;, &#x22;ADMIN&#x22;)  // Send the message (By default, will send a 200 status code)  w.Write([]byte(&#x22;Hello, World!&#x22;))}func (s *Server) handleAdmin(w http.ResponseWriter, r *http.Request) {  // Get the &#x22;user_role&#x22; value from request context  role := s.session.GetString(r.Context(), &#x22;user_role&#x22;)  // By default, GetString will return an empty string if no value is found  if role == &#x22;&#x22; {    w.WriteHeader(http.StatusUnauthorized)    return  }  // Send the message (By default, will send a 200 status code)  w.Write([]byte(&#x22;Welcome, &#x22; + role + &#x22;!&#x22;))}" data-copied=Copied! title="Copy to clipboard"><div></div></button></div></figure></div><h2 id=middleware-for-user-authorization>Middleware for user authorization<a href=#middleware-for-user-authorization class=astro-brwhiAEl aria-hidden="" tabindex=-1><svg height=18 viewBox="0 0 24 24" width=18 class=autolink-svg fill=currentColor marginLeft=1rem xmlns=http://www.w3.org/2000/svg><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h2><p>To complete our simple GoLang server, we need a middleware for handling user authorization</p><div class=expressive-code><figure class="frame has-title"><figcaption class=header><span class=title>main.go</span></figcaption><pre data-language=go><code><div class=ec-line><div class=gutter><div class=ln>1</div></div><div class=code><span style=--0:#569CD6;--1:#0000FF>func</span><span style=--0:#D4D4D4;--1:#000000> (</span><span style=--0:#9CDCFE;--1:#001080>s </span><span style=--0:#D4D4D4;--1:#000000>*</span><span style=--0:#4EC9B0;--1:#227188>Server</span><span style=--0:#D4D4D4;--1:#000000>) </span><span style=--0:#DCDCAA;--1:#795E26>RequireAdmin</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#9CDCFE;--1:#001080>next</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#4EC9B0;--1:#227188>http</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#4EC9B0;--1:#227188>Handler</span><span style=--0:#D4D4D4;--1:#000000>) </span><span style=--0:#4EC9B0;--1:#227188>http</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#4EC9B0;--1:#227188>Handler</span><span style=--0:#D4D4D4;--1:#000000> {</span></div></div><div class=ec-line><div class=gutter><div class=ln>2</div></div><div class=code><span class=indent>  </span><span style=--0:#C586C0;--1:#AC00D8>return</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#9CDCFE;--1:#001080>http</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#795E26>HandlerFunc</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#569CD6;--1:#0000FF>func</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#9CDCFE;--1:#001080>w</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#4EC9B0;--1:#227188>http</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#4EC9B0;--1:#227188>ResponseWriter</span><span style=--0:#D4D4D4;--1:#000000>, </span><span style=--0:#9CDCFE;--1:#001080>r</span><span style=--0:#D4D4D4;--1:#000000> *</span><span style=--0:#4EC9B0;--1:#227188>http</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#4EC9B0;--1:#227188>Request</span><span style=--0:#D4D4D4;--1:#000000>) {</span></div></div><div class=ec-line><div class=gutter><div class=ln>3</div></div><div class=code><span class=indent>    </span><span style=--0:#74A061;--1:#007A00>// Get "user_role" value and validate</span></div></div><div class=ec-line><div class=gutter><div class=ln>4</div></div><div class=code><span class=indent>    </span><span style=--0:#C586C0;--1:#AC00D8>if</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#9CDCFE;--1:#001080>s</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#9CDCFE;--1:#001080>session</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#795E26>GetString</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#9CDCFE;--1:#001080>r</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#795E26>Context</span><span style=--0:#D4D4D4;--1:#000000>(), </span><span style=--0:#CE9178;--1:#A31515>"user_role"</span><span style=--0:#D4D4D4;--1:#000000>) != </span><span style=--0:#CE9178;--1:#A31515>"ADMIN"</span><span style=--0:#D4D4D4;--1:#000000> {</span></div></div><div class=ec-line><div class=gutter><div class=ln>5</div></div><div class=code><span class=indent>      </span><span style=--0:#9CDCFE;--1:#001080>w</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#795E26>WriteHeader</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#9CDCFE;--1:#001080>http</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#9CDCFE;--1:#001080>StatusUnauthorized</span><span style=--0:#D4D4D4;--1:#000000>)</span></div></div><div class=ec-line><div class=gutter><div class=ln>6</div></div><div class=code><span class=indent>      </span><span style=--0:#C586C0;--1:#AC00D8>return</span></div></div><div class=ec-line><div class=gutter><div class=ln>7</div></div><div class=code><span class=indent><span style=--0:#D4D4D4;--1:#000000>    </span></span><span style=--0:#D4D4D4;--1:#000000>}</span></div></div><div class=ec-line><div class=gutter><div class=ln>8</div></div><div class=code>
</div></div><div class=ec-line><div class=gutter><div class=ln>9</div></div><div class=code><span class=indent>    </span><span style=--0:#9CDCFE;--1:#001080>next</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#795E26>ServeHTTP</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#9CDCFE;--1:#001080>w</span><span style=--0:#D4D4D4;--1:#000000>, </span><span style=--0:#9CDCFE;--1:#001080>r</span><span style=--0:#D4D4D4;--1:#000000>)</span></div></div><div class=ec-line><div class=gutter><div class=ln>10</div></div><div class=code><span class=indent><span style=--0:#D4D4D4;--1:#000000>  </span></span><span style=--0:#D4D4D4;--1:#000000>})</span></div></div><div class=ec-line><div class=gutter><div class=ln>11</div></div><div class=code><span style=--0:#D4D4D4;--1:#000000>}</span></div></div></code></pre><div class=copy><button data-code="func (s *Server) RequireAdmin(next http.Handler) http.Handler {  return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {    // Get &#x22;user_role&#x22; value and validate    if s.session.GetString(r.Context(), &#x22;user_role&#x22;) != &#x22;ADMIN&#x22; {      w.WriteHeader(http.StatusUnauthorized)      return    }    next.ServeHTTP(w, r)  })}" data-copied=Copied! title="Copy to clipboard"><div></div></button></div></figure></div><p>We’ll use this middleware inside the <code>router.Group</code></p><div class=expressive-code><figure class="frame has-title"><figcaption class=header><span class=title>main.go</span></figcaption><pre data-language=go><code><div class=ec-line><div class=gutter><div class=ln>1</div></div><div class=code><span style=--0:#74A061;--1:#007A00>// Routes</span></div></div><div class=ec-line><div class=gutter><div class=ln>2</div></div><div class=code><span style=--0:#9CDCFE;--1:#001080>router</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#795E26>Get</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#CE9178;--1:#A31515>"/"</span><span style=--0:#D4D4D4;--1:#000000>, </span><span style=--0:#9CDCFE;--1:#001080>server</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#9CDCFE;--1:#001080>handleHelloWorld</span><span style=--0:#D4D4D4;--1:#000000>)</span></div></div><div class=ec-line><div class=gutter><div class=ln>3</div></div><div class=code><span style=--0:#9CDCFE;--1:#001080>router</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#795E26>Group</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#569CD6;--1:#0000FF>func</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#9CDCFE;--1:#001080>router</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#4EC9B0;--1:#227188>chi</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#4EC9B0;--1:#227188>Router</span><span style=--0:#D4D4D4;--1:#000000>) {</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>4</div></div><div class=code><span class=indent>  </span><span style=--0:#9CDCFE;--1:#001080>router</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#664f20>Use</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#9CDCFE;--1:#001080>server</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#9CDCFE;--1:#001080>RequireAdmin</span><span style=--0:#D4D4D4;--1:#000000>)</span></div></div><div class=ec-line><div class=gutter><div class=ln>5</div></div><div class=code><span class=indent>  </span><span style=--0:#9CDCFE;--1:#001080>router</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#795E26>Get</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#CE9178;--1:#A31515>"/admin"</span><span style=--0:#D4D4D4;--1:#000000>, </span><span style=--0:#9CDCFE;--1:#001080>server</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#9CDCFE;--1:#001080>handleAdmin</span><span style=--0:#D4D4D4;--1:#000000>)</span></div></div><div class=ec-line><div class=gutter><div class=ln>6</div></div><div class=code><span style=--0:#D4D4D4;--1:#000000>})</span></div></div></code></pre><div class=copy><button data-code="// Routesrouter.Get(&#x22;/&#x22;, server.handleHelloWorld)router.Group(func(router chi.Router) {  router.Use(server.RequireAdmin)  router.Get(&#x22;/admin&#x22;, server.handleAdmin)})" data-copied=Copied! title="Copy to clipboard"><div></div></button></div></figure></div><h2 id=the-testing>The testing<a href=#the-testing class=astro-brwhiAEl aria-hidden="" tabindex=-1><svg height=18 viewBox="0 0 24 24" width=18 class=autolink-svg fill=currentColor marginLeft=1rem xmlns=http://www.w3.org/2000/svg><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h2><p>Now, the testing part.</p><p>Our test will have four paths:</p><ul><li>Public endpoint that will return <code class="remark-text-highlight endpointOk1" style=background-color:green;color:#fff>200 (Ok)</code></li><li>Admin endpoint <strong>without role</strong> that will return <code class="remark-text-highlight endpointUnauthorized1" style=background-color:#daa520;color:#fff>401 (Unauthorized)</code></li><li>Admin endpoint <strong>with wrong role</strong> that will return <code class="remark-text-highlight endpointUnauthorized2" style=background-color:#daa520;color:#fff>401 (Unauthorized)</code></li><li>Admin endpoint <strong>with correct role</strong> that will return <code class="remark-text-highlight endpointOk2" style=background-color:green;color:#fff>200 (Ok)</code></li></ul><div class=expressive-code><figure class="frame has-title"><figcaption class=header><span class=title>main_test.go</span></figcaption><pre data-language=go><code><div class=ec-line><div class=gutter><div class=ln>1</div></div><div class=code><span style=--0:#569CD6;--1:#0000FF>func</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#DCDCAA;--1:#795E26>Test_main</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#9CDCFE;--1:#001080>t</span><span style=--0:#D4D4D4;--1:#000000> *</span><span style=--0:#4EC9B0;--1:#227188>testing</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#4EC9B0;--1:#227188>T</span><span style=--0:#D4D4D4;--1:#000000>) {</span></div></div><div class=ec-line><div class=gutter><div class=ln>2</div></div><div class=code><span class=indent>  </span><span style=--0:#9CDCFE;--1:#001080>tests</span><span style=--0:#D4D4D4;--1:#000000> := []</span><span style=--0:#569CD6;--1:#0000FF>struct</span><span style=--0:#D4D4D4;--1:#000000> {</span></div></div><div class=ec-line><div class=gutter><div class=ln>3</div></div><div class=code><span class=indent>    </span><span style=--0:#9CDCFE;--1:#001080>name</span><span style=--0:#D4D4D4;--1:#000000>     </span><span style=--0:#4EC9B0;--1:#227188>string</span></div></div><div class=ec-line><div class=gutter><div class=ln>4</div></div><div class=code><span class=indent>    </span><span style=--0:#9CDCFE;--1:#001080>url</span><span style=--0:#D4D4D4;--1:#000000>      </span><span style=--0:#4EC9B0;--1:#227188>string</span></div></div><div class=ec-line><div class=gutter><div class=ln>5</div></div><div class=code><span class=indent>    </span><span style=--0:#9CDCFE;--1:#001080>role</span><span style=--0:#D4D4D4;--1:#000000>     </span><span style=--0:#4EC9B0;--1:#227188>string</span></div></div><div class=ec-line><div class=gutter><div class=ln>6</div></div><div class=code><span class=indent>    </span><span style=--0:#9CDCFE;--1:#001080>wantCode</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#4EC9B0;--1:#227188>int</span></div></div><div class=ec-line><div class=gutter><div class=ln>7</div></div><div class=code><span class=indent><span style=--0:#D4D4D4;--1:#000000>  </span></span><span style=--0:#D4D4D4;--1:#000000>}{</span></div></div><div class=ec-line><div class=gutter><div class=ln>8</div></div><div class=code><span class=indent><span style=--0:#D4D4D4;--1:#000000>    </span></span><span style=--0:#D4D4D4;--1:#000000>{</span></div></div><div class=ec-line><div class=gutter><div class=ln>9</div></div><div class=code><span class=indent>      </span><span style=--0:#9CDCFE;--1:#001080>name</span><span style=--0:#D4D4D4;--1:#000000>:     </span><span style=--0:#CE9178;--1:#A31515>"public endpoint"</span><span style=--0:#D4D4D4;--1:#000000>,</span></div></div><div class=ec-line><div class=gutter><div class=ln>10</div></div><div class=code><span class=indent>      </span><span style=--0:#9CDCFE;--1:#001080>url</span><span style=--0:#D4D4D4;--1:#000000>:      </span><span style=--0:#CE9178;--1:#A31515>"/"</span><span style=--0:#D4D4D4;--1:#000000>,</span></div></div><div class=ec-line><div class=gutter><div class=ln>11</div></div><div class=code><span class=indent>      </span><span style=--0:#9CDCFE;--1:#001080>wantCode</span><span style=--0:#D4D4D4;--1:#000000>: </span><span style=--0:#9CDCFE;--1:#001080>http</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#9CDCFE;--1:#001080>StatusOK</span><span style=--0:#D4D4D4;--1:#000000>,</span></div></div><div class=ec-line><div class=gutter><div class=ln>12</div></div><div class=code><span class=indent><span style=--0:#D4D4D4;--1:#000000>    </span></span><span style=--0:#D4D4D4;--1:#000000>},</span></div></div><div class=ec-line><div class=gutter><div class=ln>13</div></div><div class=code><span class=indent><span style=--0:#D4D4D4;--1:#000000>    </span></span><span style=--0:#D4D4D4;--1:#000000>{</span></div></div><div class=ec-line><div class=gutter><div class=ln>14</div></div><div class=code><span class=indent>      </span><span style=--0:#9CDCFE;--1:#001080>name</span><span style=--0:#D4D4D4;--1:#000000>:     </span><span style=--0:#CE9178;--1:#A31515>"admin endpoint without role"</span><span style=--0:#D4D4D4;--1:#000000>,</span></div></div><div class=ec-line><div class=gutter><div class=ln>15</div></div><div class=code><span class=indent>      </span><span style=--0:#9CDCFE;--1:#001080>url</span><span style=--0:#D4D4D4;--1:#000000>:      </span><span style=--0:#CE9178;--1:#A31515>"/admin"</span><span style=--0:#D4D4D4;--1:#000000>,</span></div></div><div class=ec-line><div class=gutter><div class=ln>16</div></div><div class=code><span class=indent>      </span><span style=--0:#9CDCFE;--1:#001080>wantCode</span><span style=--0:#D4D4D4;--1:#000000>: </span><span style=--0:#9CDCFE;--1:#001080>http</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#9CDCFE;--1:#001080>StatusUnauthorized</span><span style=--0:#D4D4D4;--1:#000000>,</span></div></div><div class=ec-line><div class=gutter><div class=ln>17</div></div><div class=code><span class=indent><span style=--0:#D4D4D4;--1:#000000>    </span></span><span style=--0:#D4D4D4;--1:#000000>},</span></div></div><div class=ec-line><div class=gutter><div class=ln>18</div></div><div class=code><span class=indent><span style=--0:#D4D4D4;--1:#000000>    </span></span><span style=--0:#D4D4D4;--1:#000000>{</span></div></div><div class=ec-line><div class=gutter><div class=ln>19</div></div><div class=code><span class=indent>      </span><span style=--0:#9CDCFE;--1:#001080>name</span><span style=--0:#D4D4D4;--1:#000000>:     </span><span style=--0:#CE9178;--1:#A31515>"admin endpoint with wrong role"</span><span style=--0:#D4D4D4;--1:#000000>,</span></div></div><div class=ec-line><div class=gutter><div class=ln>20</div></div><div class=code><span class=indent>      </span><span style=--0:#9CDCFE;--1:#001080>url</span><span style=--0:#D4D4D4;--1:#000000>:      </span><span style=--0:#CE9178;--1:#A31515>"/admin"</span><span style=--0:#D4D4D4;--1:#000000>,</span></div></div><div class=ec-line><div class=gutter><div class=ln>21</div></div><div class=code><span class=indent>      </span><span style=--0:#9CDCFE;--1:#001080>role</span><span style=--0:#D4D4D4;--1:#000000>:     </span><span style=--0:#CE9178;--1:#A31515>"OTHER"</span><span style=--0:#D4D4D4;--1:#000000>,</span></div></div><div class=ec-line><div class=gutter><div class=ln>22</div></div><div class=code><span class=indent>      </span><span style=--0:#9CDCFE;--1:#001080>wantCode</span><span style=--0:#D4D4D4;--1:#000000>: </span><span style=--0:#9CDCFE;--1:#001080>http</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#9CDCFE;--1:#001080>StatusUnauthorized</span><span style=--0:#D4D4D4;--1:#000000>,</span></div></div><div class=ec-line><div class=gutter><div class=ln>23</div></div><div class=code><span class=indent><span style=--0:#D4D4D4;--1:#000000>    </span></span><span style=--0:#D4D4D4;--1:#000000>},</span></div></div><div class=ec-line><div class=gutter><div class=ln>24</div></div><div class=code><span class=indent><span style=--0:#D4D4D4;--1:#000000>    </span></span><span style=--0:#D4D4D4;--1:#000000>{</span></div></div><div class=ec-line><div class=gutter><div class=ln>25</div></div><div class=code><span class=indent>      </span><span style=--0:#9CDCFE;--1:#001080>name</span><span style=--0:#D4D4D4;--1:#000000>:     </span><span style=--0:#CE9178;--1:#A31515>"admin endpoint with correct role"</span><span style=--0:#D4D4D4;--1:#000000>,</span></div></div><div class=ec-line><div class=gutter><div class=ln>26</div></div><div class=code><span class=indent>      </span><span style=--0:#9CDCFE;--1:#001080>url</span><span style=--0:#D4D4D4;--1:#000000>:      </span><span style=--0:#CE9178;--1:#A31515>"/admin"</span><span style=--0:#D4D4D4;--1:#000000>,</span></div></div><div class=ec-line><div class=gutter><div class=ln>27</div></div><div class=code><span class=indent>      </span><span style=--0:#9CDCFE;--1:#001080>role</span><span style=--0:#D4D4D4;--1:#000000>:     </span><span style=--0:#CE9178;--1:#A31515>"ADMIN"</span><span style=--0:#D4D4D4;--1:#000000>,</span></div></div><div class=ec-line><div class=gutter><div class=ln>28</div></div><div class=code><span class=indent>      </span><span style=--0:#9CDCFE;--1:#001080>wantCode</span><span style=--0:#D4D4D4;--1:#000000>: </span><span style=--0:#9CDCFE;--1:#001080>http</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#9CDCFE;--1:#001080>StatusOK</span><span style=--0:#D4D4D4;--1:#000000>,</span></div></div><div class=ec-line><div class=gutter><div class=ln>29</div></div><div class=code><span class=indent><span style=--0:#D4D4D4;--1:#000000>    </span></span><span style=--0:#D4D4D4;--1:#000000>},</span></div></div><div class=ec-line><div class=gutter><div class=ln>30</div></div><div class=code><span class=indent><span style=--0:#D4D4D4;--1:#000000>  </span></span><span style=--0:#D4D4D4;--1:#000000>}</span></div></div><div class=ec-line><div class=gutter><div class=ln>31</div></div><div class=code><span class=indent>  </span><span style=--0:#C586C0;--1:#AC00D8>for</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#9CDCFE;--1:#001080>_</span><span style=--0:#D4D4D4;--1:#000000>, </span><span style=--0:#9CDCFE;--1:#001080>tt</span><span style=--0:#D4D4D4;--1:#000000> := </span><span style=--0:#C586C0;--1:#AC00D8>range</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#9CDCFE;--1:#001080>tests</span><span style=--0:#D4D4D4;--1:#000000> {</span></div></div><div class=ec-line><div class=gutter><div class=ln>32</div></div><div class=code><span class=indent>    </span><span style=--0:#9CDCFE;--1:#001080>t</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#795E26>Run</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#9CDCFE;--1:#001080>tt</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#9CDCFE;--1:#001080>name</span><span style=--0:#D4D4D4;--1:#000000>, </span><span style=--0:#569CD6;--1:#0000FF>func</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#9CDCFE;--1:#001080>t</span><span style=--0:#D4D4D4;--1:#000000> *</span><span style=--0:#4EC9B0;--1:#227188>testing</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#4EC9B0;--1:#227188>T</span><span style=--0:#D4D4D4;--1:#000000>) {</span></div></div><div class=ec-line><div class=gutter><div class=ln>33</div></div><div class=code><span class=indent>      </span><span style=--0:#74A061;--1:#007A00>// TODO: Add test logic here</span></div></div><div class=ec-line><div class=gutter><div class=ln>34</div></div><div class=code><span class=indent><span style=--0:#D4D4D4;--1:#000000>    </span></span><span style=--0:#D4D4D4;--1:#000000>})</span></div></div><div class=ec-line><div class=gutter><div class=ln>35</div></div><div class=code><span class=indent><span style=--0:#D4D4D4;--1:#000000>  </span></span><span style=--0:#D4D4D4;--1:#000000>}</span></div></div><div class=ec-line><div class=gutter><div class=ln>36</div></div><div class=code><span style=--0:#D4D4D4;--1:#000000>}</span></div></div></code></pre><div class=copy><button data-code="func Test_main(t *testing.T) {  tests := []struct {    name     string    url      string    role     string    wantCode int  }{    {      name:     &#x22;public endpoint&#x22;,      url:      &#x22;/&#x22;,      wantCode: http.StatusOK,    },    {      name:     &#x22;admin endpoint without role&#x22;,      url:      &#x22;/admin&#x22;,      wantCode: http.StatusUnauthorized,    },    {      name:     &#x22;admin endpoint with wrong role&#x22;,      url:      &#x22;/admin&#x22;,      role:     &#x22;OTHER&#x22;,      wantCode: http.StatusUnauthorized,    },    {      name:     &#x22;admin endpoint with correct role&#x22;,      url:      &#x22;/admin&#x22;,      role:     &#x22;ADMIN&#x22;,      wantCode: http.StatusOK,    },  }  for _, tt := range tests {    t.Run(tt.name, func(t *testing.T) {      // TODO: Add test logic here    })  }}" data-copied=Copied! title="Copy to clipboard"><div></div></button></div></figure></div><p>Implementing the first part of the test logic <strong>(server configuration)</strong>:</p><div class=expressive-code><figure class="frame has-title"><figcaption class=header><span class=title>main_test.go</span></figcaption><pre data-language=go><code><div class=ec-line><div class=gutter><div class=ln>1</div></div><div class=code><span style=--0:#74A061;--1:#007A00>// Set up</span></div></div><div class=ec-line><div class=gutter><div class=ln>2</div></div><div class=code><span style=--0:#9CDCFE;--1:#001080>session</span><span style=--0:#D4D4D4;--1:#000000> := </span><span style=--0:#9CDCFE;--1:#001080>scs</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#795E26>New</span><span style=--0:#D4D4D4;--1:#000000>()</span></div></div><div class=ec-line><div class=gutter><div class=ln>3</div></div><div class=code><span style=--0:#9CDCFE;--1:#001080>router</span><span style=--0:#D4D4D4;--1:#000000> := </span><span style=--0:#9CDCFE;--1:#001080>chi</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#795E26>NewRouter</span><span style=--0:#D4D4D4;--1:#000000>()</span></div></div><div class=ec-line><div class=gutter><div class=ln>4</div></div><div class=code><span style=--0:#9CDCFE;--1:#001080>server</span><span style=--0:#D4D4D4;--1:#000000> := &#x26;</span><span style=--0:#4EC9B0;--1:#227188>Server</span><span style=--0:#D4D4D4;--1:#000000>{</span></div></div><div class=ec-line><div class=gutter><div class=ln>5</div></div><div class=code><span class=indent>    </span><span style=--0:#9CDCFE;--1:#001080>session</span><span style=--0:#D4D4D4;--1:#000000>: </span><span style=--0:#9CDCFE;--1:#001080>session</span><span style=--0:#D4D4D4;--1:#000000>,</span></div></div><div class=ec-line><div class=gutter><div class=ln>6</div></div><div class=code><span class=indent>    </span><span style=--0:#9CDCFE;--1:#001080>router</span><span style=--0:#D4D4D4;--1:#000000>:  </span><span style=--0:#9CDCFE;--1:#001080>router</span><span style=--0:#D4D4D4;--1:#000000>,</span></div></div><div class=ec-line><div class=gutter><div class=ln>7</div></div><div class=code><span style=--0:#D4D4D4;--1:#000000>}</span></div></div><div class=ec-line><div class=gutter><div class=ln>8</div></div><div class=code>
</div></div><div class=ec-line><div class=gutter><div class=ln>9</div></div><div class=code><span style=--0:#74A061;--1:#007A00>// TODO: Implement session middleware</span></div></div><div class=ec-line><div class=gutter><div class=ln>10</div></div><div class=code>
</div></div><div class=ec-line><div class=gutter><div class=ln>11</div></div><div class=code><span style=--0:#74A061;--1:#007A00>// Routes</span></div></div><div class=ec-line><div class=gutter><div class=ln>12</div></div><div class=code><span style=--0:#9CDCFE;--1:#001080>router</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#795E26>Get</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#CE9178;--1:#A31515>"/"</span><span style=--0:#D4D4D4;--1:#000000>, </span><span style=--0:#9CDCFE;--1:#001080>server</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#9CDCFE;--1:#001080>handleHelloWorld</span><span style=--0:#D4D4D4;--1:#000000>)</span></div></div><div class=ec-line><div class=gutter><div class=ln>13</div></div><div class=code><span style=--0:#9CDCFE;--1:#001080>router</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#795E26>Group</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#569CD6;--1:#0000FF>func</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#9CDCFE;--1:#001080>router</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#4EC9B0;--1:#227188>chi</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#4EC9B0;--1:#227188>Router</span><span style=--0:#D4D4D4;--1:#000000>) {</span></div></div><div class=ec-line><div class=gutter><div class=ln>14</div></div><div class=code><span class=indent>  </span><span style=--0:#9CDCFE;--1:#001080>router</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#795E26>Use</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#9CDCFE;--1:#001080>server</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#9CDCFE;--1:#001080>RequireAdmin</span><span style=--0:#D4D4D4;--1:#000000>)</span></div></div><div class=ec-line><div class=gutter><div class=ln>15</div></div><div class=code><span class=indent>  </span><span style=--0:#9CDCFE;--1:#001080>router</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#795E26>Get</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#CE9178;--1:#A31515>"/admin"</span><span style=--0:#D4D4D4;--1:#000000>, </span><span style=--0:#9CDCFE;--1:#001080>server</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#9CDCFE;--1:#001080>handleAdmin</span><span style=--0:#D4D4D4;--1:#000000>)</span></div></div><div class=ec-line><div class=gutter><div class=ln>16</div></div><div class=code><span style=--0:#D4D4D4;--1:#000000>})</span></div></div></code></pre><div class=copy><button data-code="// Set upsession := scs.New()router := chi.NewRouter()server := &#x26;Server{    session: session,    router:  router,}// TODO: Implement session middleware// Routesrouter.Get(&#x22;/&#x22;, server.handleHelloWorld)router.Group(func(router chi.Router) {  router.Use(server.RequireAdmin)  router.Get(&#x22;/admin&#x22;, server.handleAdmin)})" data-copied=Copied! title="Copy to clipboard"><div></div></button></div></figure></div><p>Second part of the test logic <strong>(http request and status validation)</strong>:</p><div class=expressive-code><figure class="frame has-title"><figcaption class=header><span class=title>main_test.go</span></figcaption><pre data-language=go><code><div class=ec-line><div class=gutter><div class=ln>1</div></div><div class=code><span style=--0:#74A061;--1:#007A00>// Request</span></div></div><div class=ec-line><div class=gutter><div class=ln>2</div></div><div class=code><span style=--0:#9CDCFE;--1:#001080>rr</span><span style=--0:#D4D4D4;--1:#000000> := </span><span style=--0:#9CDCFE;--1:#001080>httptest</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#795E26>NewRecorder</span><span style=--0:#D4D4D4;--1:#000000>()</span></div></div><div class=ec-line><div class=gutter><div class=ln>3</div></div><div class=code><span style=--0:#9CDCFE;--1:#001080>req</span><span style=--0:#D4D4D4;--1:#000000> := </span><span style=--0:#9CDCFE;--1:#001080>httptest</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#795E26>NewRequest</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#CE9178;--1:#A31515>"GET"</span><span style=--0:#D4D4D4;--1:#000000>, </span><span style=--0:#9CDCFE;--1:#001080>tt</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#9CDCFE;--1:#001080>url</span><span style=--0:#D4D4D4;--1:#000000>, </span><span style=--0:#569CD6;--1:#0000FF>nil</span><span style=--0:#D4D4D4;--1:#000000>)</span></div></div><div class=ec-line><div class=gutter><div class=ln>4</div></div><div class=code><span style=--0:#9CDCFE;--1:#001080>router</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#795E26>ServeHTTP</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#9CDCFE;--1:#001080>rr</span><span style=--0:#D4D4D4;--1:#000000>, </span><span style=--0:#9CDCFE;--1:#001080>req</span><span style=--0:#D4D4D4;--1:#000000>)</span></div></div><div class=ec-line><div class=gutter><div class=ln>5</div></div><div class=code>
</div></div><div class=ec-line><div class=gutter><div class=ln>6</div></div><div class=code><span style=--0:#74A061;--1:#007A00>// Result</span></div></div><div class=ec-line><div class=gutter><div class=ln>7</div></div><div class=code><span style=--0:#9CDCFE;--1:#001080>res</span><span style=--0:#D4D4D4;--1:#000000> := </span><span style=--0:#9CDCFE;--1:#001080>rr</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#795E26>Result</span><span style=--0:#D4D4D4;--1:#000000>()</span></div></div><div class=ec-line><div class=gutter><div class=ln>8</div></div><div class=code>
</div></div><div class=ec-line><div class=gutter><div class=ln>9</div></div><div class=code><span style=--0:#C586C0;--1:#AC00D8>if</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#9CDCFE;--1:#001080>tt</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#9CDCFE;--1:#001080>wantCode</span><span style=--0:#D4D4D4;--1:#000000> != </span><span style=--0:#9CDCFE;--1:#001080>res</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#9CDCFE;--1:#001080>StatusCode</span><span style=--0:#D4D4D4;--1:#000000> {</span></div></div><div class=ec-line><div class=gutter><div class=ln>10</div></div><div class=code><span class=indent>  </span><span style=--0:#9CDCFE;--1:#001080>t</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#795E26>Errorf</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#CE9178;--1:#A31515>"Expected response code </span><span style=--0:#9CDCFE;--1:#001080>%d</span><span style=--0:#CE9178;--1:#A31515>. Got </span><span style=--0:#9CDCFE;--1:#001080>%d</span><span style=--0:#D7BA7D;--1:#D40000>\n</span><span style=--0:#CE9178;--1:#A31515>"</span><span style=--0:#D4D4D4;--1:#000000>, </span><span style=--0:#9CDCFE;--1:#001080>tt</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#9CDCFE;--1:#001080>wantCode</span><span style=--0:#D4D4D4;--1:#000000>, </span><span style=--0:#9CDCFE;--1:#001080>res</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#9CDCFE;--1:#001080>StatusCode</span><span style=--0:#D4D4D4;--1:#000000>)</span></div></div><div class=ec-line><div class=gutter><div class=ln>11</div></div><div class=code><span style=--0:#D4D4D4;--1:#000000>}</span></div></div></code></pre><div class=copy><button data-code="// Requestrr := httptest.NewRecorder()req := httptest.NewRequest(&#x22;GET&#x22;, tt.url, nil)router.ServeHTTP(rr, req)// Resultres := rr.Result()if tt.wantCode != res.StatusCode {  t.Errorf(&#x22;Expected response code %d. Got %d\n&#x22;, tt.wantCode, res.StatusCode)}" data-copied=Copied! title="Copy to clipboard"><div></div></button></div></figure></div><h2 id=loadandsavemock-middleware>LoadAndSaveMock middleware<a href=#loadandsavemock-middleware class=astro-brwhiAEl aria-hidden="" tabindex=-1><svg height=18 viewBox="0 0 24 24" width=18 class=autolink-svg fill=currentColor marginLeft=1rem xmlns=http://www.w3.org/2000/svg><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h2><p>In this section we’ll create a wrapper/middleware of the <code>LoadAndSave</code> middleware from the SCS package, this mock will inject any value we want into our router before recording the test request:</p><div class=expressive-code><figure class="frame has-title"><figcaption class=header><span class=title>main_test.go</span></figcaption><pre data-language=go><code><div class=ec-line><div class=gutter><div class=ln>1</div></div><div class=code><span style=--0:#569CD6;--1:#0000FF>func</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#DCDCAA;--1:#795E26>LoadAndSaveMock</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#9CDCFE;--1:#001080>session</span><span style=--0:#D4D4D4;--1:#000000> *</span><span style=--0:#4EC9B0;--1:#227188>scs</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#4EC9B0;--1:#227188>SessionManager</span><span style=--0:#D4D4D4;--1:#000000>, </span><span style=--0:#9CDCFE;--1:#001080>key</span><span style=--0:#D4D4D4;--1:#000000>, </span><span style=--0:#9CDCFE;--1:#001080>value</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#4EC9B0;--1:#227188>string</span><span style=--0:#D4D4D4;--1:#000000>) </span><span style=--0:#569CD6;--1:#0000FF>func</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#9CDCFE;--1:#001080>next</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#4EC9B0;--1:#227188>http</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#4EC9B0;--1:#227188>Handler</span><span style=--0:#D4D4D4;--1:#000000>) </span><span style=--0:#4EC9B0;--1:#227188>http</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#4EC9B0;--1:#227188>Handler</span><span style=--0:#D4D4D4;--1:#000000> {</span></div></div><div class=ec-line><div class=gutter><div class=ln>2</div></div><div class=code><span class=indent>  </span><span style=--0:#C586C0;--1:#AC00D8>return</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#569CD6;--1:#0000FF>func</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#9CDCFE;--1:#001080>next</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#4EC9B0;--1:#227188>http</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#4EC9B0;--1:#227188>Handler</span><span style=--0:#D4D4D4;--1:#000000>) </span><span style=--0:#4EC9B0;--1:#227188>http</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#4EC9B0;--1:#227188>Handler</span><span style=--0:#D4D4D4;--1:#000000> {</span></div></div><div class=ec-line><div class=gutter><div class=ln>3</div></div><div class=code><span class=indent>    </span><span style=--0:#C586C0;--1:#AC00D8>return</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#9CDCFE;--1:#001080>session</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#795E26>LoadAndSave</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#9CDCFE;--1:#001080>http</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#795E26>HandlerFunc</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#569CD6;--1:#0000FF>func</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#9CDCFE;--1:#001080>w</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#4EC9B0;--1:#227188>http</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#4EC9B0;--1:#227188>ResponseWriter</span><span style=--0:#D4D4D4;--1:#000000>, </span><span style=--0:#9CDCFE;--1:#001080>r</span><span style=--0:#D4D4D4;--1:#000000> *</span><span style=--0:#4EC9B0;--1:#227188>http</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#4EC9B0;--1:#227188>Request</span><span style=--0:#D4D4D4;--1:#000000>) {</span></div></div><div class=ec-line><div class=gutter><div class=ln>4</div></div><div class=code><span class=indent>      </span><span style=--0:#9CDCFE;--1:#001080>session</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#795E26>Put</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#9CDCFE;--1:#001080>r</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#795E26>Context</span><span style=--0:#D4D4D4;--1:#000000>(), </span><span style=--0:#9CDCFE;--1:#001080>key</span><span style=--0:#D4D4D4;--1:#000000>, </span><span style=--0:#9CDCFE;--1:#001080>value</span><span style=--0:#D4D4D4;--1:#000000>)</span></div></div><div class=ec-line><div class=gutter><div class=ln>5</div></div><div class=code><span class=indent>      </span><span style=--0:#9CDCFE;--1:#001080>next</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#795E26>ServeHTTP</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#9CDCFE;--1:#001080>w</span><span style=--0:#D4D4D4;--1:#000000>, </span><span style=--0:#9CDCFE;--1:#001080>r</span><span style=--0:#D4D4D4;--1:#000000>)</span></div></div><div class=ec-line><div class=gutter><div class=ln>6</div></div><div class=code><span class=indent><span style=--0:#D4D4D4;--1:#000000>    </span></span><span style=--0:#D4D4D4;--1:#000000>}))</span></div></div><div class=ec-line><div class=gutter><div class=ln>7</div></div><div class=code><span class=indent><span style=--0:#D4D4D4;--1:#000000>  </span></span><span style=--0:#D4D4D4;--1:#000000>}</span></div></div><div class=ec-line><div class=gutter><div class=ln>8</div></div><div class=code><span style=--0:#D4D4D4;--1:#000000>}</span></div></div></code></pre><div class=copy><button data-code="func LoadAndSaveMock(session *scs.SessionManager, key, value string) func(next http.Handler) http.Handler {  return func(next http.Handler) http.Handler {    return session.LoadAndSave(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {      session.Put(r.Context(), key, value)      next.ServeHTTP(w, r)    }))  }}" data-copied=Copied! title="Copy to clipboard"><div></div></button></div></figure></div><h2 id=putting-all-together>Putting all together<a href=#putting-all-together class=astro-brwhiAEl aria-hidden="" tabindex=-1><svg height=18 viewBox="0 0 24 24" width=18 class=autolink-svg fill=currentColor marginLeft=1rem xmlns=http://www.w3.org/2000/svg><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h2><p>The final test code logic:</p><div class=expressive-code><figure class="frame has-title"><figcaption class=header><span class=title>main_test.go</span></figcaption><pre data-language=go><code><div class="ec-line highlight ins"><div class=gutter><div class=ln>1</div></div><div class=code><span style=--0:#7cb3df;--1:#0000FF>func</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#DCDCAA;--1:#664f20>LoadAndSaveMock</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#9CDCFE;--1:#001080>session</span><span style=--0:#D4D4D4;--1:#000000> *</span><span style=--0:#4EC9B0;--1:#1b5a6c>scs</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#4EC9B0;--1:#1b5a6c>SessionManager</span><span style=--0:#D4D4D4;--1:#000000>, </span><span style=--0:#9CDCFE;--1:#001080>key</span><span style=--0:#D4D4D4;--1:#000000>, </span><span style=--0:#9CDCFE;--1:#001080>value</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#4EC9B0;--1:#1b5a6c>string</span><span style=--0:#D4D4D4;--1:#000000>) </span><span style=--0:#7cb3df;--1:#0000FF>func</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#9CDCFE;--1:#001080>next</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#4EC9B0;--1:#1b5a6c>http</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#4EC9B0;--1:#1b5a6c>Handler</span><span style=--0:#D4D4D4;--1:#000000>) </span><span style=--0:#4EC9B0;--1:#1b5a6c>http</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#4EC9B0;--1:#1b5a6c>Handler</span><span style=--0:#D4D4D4;--1:#000000> {</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>2</div></div><div class=code><span class=indent>  </span><span style=--0:#d09dcc;--1:#8c00b0>return</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#7cb3df;--1:#0000FF>func</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#9CDCFE;--1:#001080>next</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#4EC9B0;--1:#1b5a6c>http</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#4EC9B0;--1:#1b5a6c>Handler</span><span style=--0:#D4D4D4;--1:#000000>) </span><span style=--0:#4EC9B0;--1:#1b5a6c>http</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#4EC9B0;--1:#1b5a6c>Handler</span><span style=--0:#D4D4D4;--1:#000000> {</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>3</div></div><div class=code><span class=indent>    </span><span style=--0:#d09dcc;--1:#8c00b0>return</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#9CDCFE;--1:#001080>session</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#664f20>LoadAndSave</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#9CDCFE;--1:#001080>http</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#664f20>HandlerFunc</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#7cb3df;--1:#0000FF>func</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#9CDCFE;--1:#001080>w</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#4EC9B0;--1:#1b5a6c>http</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#4EC9B0;--1:#1b5a6c>ResponseWriter</span><span style=--0:#D4D4D4;--1:#000000>, </span><span style=--0:#9CDCFE;--1:#001080>r</span><span style=--0:#D4D4D4;--1:#000000> *</span><span style=--0:#4EC9B0;--1:#1b5a6c>http</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#4EC9B0;--1:#1b5a6c>Request</span><span style=--0:#D4D4D4;--1:#000000>) {</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>4</div></div><div class=code><span class=indent>      </span><span style=--0:#9CDCFE;--1:#001080>session</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#664f20>Put</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#9CDCFE;--1:#001080>r</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#664f20>Context</span><span style=--0:#D4D4D4;--1:#000000>(), </span><span style=--0:#9CDCFE;--1:#001080>key</span><span style=--0:#D4D4D4;--1:#000000>, </span><span style=--0:#9CDCFE;--1:#001080>value</span><span style=--0:#D4D4D4;--1:#000000>)</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>5</div></div><div class=code><span class=indent>      </span><span style=--0:#9CDCFE;--1:#001080>next</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#664f20>ServeHTTP</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#9CDCFE;--1:#001080>w</span><span style=--0:#D4D4D4;--1:#000000>, </span><span style=--0:#9CDCFE;--1:#001080>r</span><span style=--0:#D4D4D4;--1:#000000>)</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>6</div></div><div class=code><span class=indent><span style=--0:#D4D4D4;--1:#000000>    </span></span><span style=--0:#D4D4D4;--1:#000000>}))</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>7</div></div><div class=code><span class=indent><span style=--0:#D4D4D4;--1:#000000>  </span></span><span style=--0:#D4D4D4;--1:#000000>}</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>8</div></div><div class=code><span style=--0:#D4D4D4;--1:#000000>}</span></div></div><div class=ec-line><div class=gutter><div class=ln>9</div></div><div class=code>
</div></div><div class=ec-line><div class=gutter><div class=ln>10</div></div><div class=code><span style=--0:#569CD6;--1:#0000FF>func</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#DCDCAA;--1:#795E26>Test_main</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#9CDCFE;--1:#001080>t</span><span style=--0:#D4D4D4;--1:#000000> *</span><span style=--0:#4EC9B0;--1:#227188>testing</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#4EC9B0;--1:#227188>T</span><span style=--0:#D4D4D4;--1:#000000>) {</span></div></div><div class=ec-line><div class=gutter><div class=ln>11</div></div><div class=code><span class=indent>  </span><span style=--0:#9CDCFE;--1:#001080>tests</span><span style=--0:#D4D4D4;--1:#000000> := []</span><span style=--0:#569CD6;--1:#0000FF>struct</span><span style=--0:#D4D4D4;--1:#000000> {</span></div></div><div class=ec-line><div class=gutter><div class=ln>12</div></div><div class=code><span class=indent>    </span><span style=--0:#9CDCFE;--1:#001080>name</span><span style=--0:#D4D4D4;--1:#000000>     </span><span style=--0:#4EC9B0;--1:#227188>string</span></div></div><div class=ec-line><div class=gutter><div class=ln>13</div></div><div class=code><span class=indent>    </span><span style=--0:#9CDCFE;--1:#001080>url</span><span style=--0:#D4D4D4;--1:#000000>      </span><span style=--0:#4EC9B0;--1:#227188>string</span></div></div><div class=ec-line><div class=gutter><div class=ln>14</div></div><div class=code><span class=indent>    </span><span style=--0:#9CDCFE;--1:#001080>role</span><span style=--0:#D4D4D4;--1:#000000>     </span><span style=--0:#4EC9B0;--1:#227188>string</span></div></div><div class=ec-line><div class=gutter><div class=ln>15</div></div><div class=code><span class=indent>    </span><span style=--0:#9CDCFE;--1:#001080>wantCode</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#4EC9B0;--1:#227188>int</span></div></div><div class=ec-line><div class=gutter><div class=ln>16</div></div><div class=code><span class=indent><span style=--0:#D4D4D4;--1:#000000>  </span></span><span style=--0:#D4D4D4;--1:#000000>}{</span></div></div><div class=ec-line><div class=gutter><div class=ln>17</div></div><div class=code><span class=indent><span style=--0:#D4D4D4;--1:#000000>    </span></span><span style=--0:#D4D4D4;--1:#000000>{</span></div></div><div class=ec-line><div class=gutter><div class=ln>18</div></div><div class=code><span class=indent>      </span><span style=--0:#9CDCFE;--1:#001080>name</span><span style=--0:#D4D4D4;--1:#000000>:     </span><span style=--0:#CE9178;--1:#A31515>"public endpoint"</span><span style=--0:#D4D4D4;--1:#000000>,</span></div></div><div class=ec-line><div class=gutter><div class=ln>19</div></div><div class=code><span class=indent>      </span><span style=--0:#9CDCFE;--1:#001080>url</span><span style=--0:#D4D4D4;--1:#000000>:      </span><span style=--0:#CE9178;--1:#A31515>"/"</span><span style=--0:#D4D4D4;--1:#000000>,</span></div></div><div class=ec-line><div class=gutter><div class=ln>20</div></div><div class=code><span class=indent>      </span><span style=--0:#9CDCFE;--1:#001080>wantCode</span><span style=--0:#D4D4D4;--1:#000000>: </span><span style=--0:#9CDCFE;--1:#001080>http</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#9CDCFE;--1:#001080>StatusOK</span><span style=--0:#D4D4D4;--1:#000000>,</span></div></div><div class=ec-line><div class=gutter><div class=ln>21</div></div><div class=code><span class=indent><span style=--0:#D4D4D4;--1:#000000>    </span></span><span style=--0:#D4D4D4;--1:#000000>},</span></div></div><div class=ec-line><div class=gutter><div class=ln>22</div></div><div class=code><span class=indent><span style=--0:#D4D4D4;--1:#000000>    </span></span><span style=--0:#D4D4D4;--1:#000000>{</span></div></div><div class=ec-line><div class=gutter><div class=ln>23</div></div><div class=code><span class=indent>      </span><span style=--0:#9CDCFE;--1:#001080>name</span><span style=--0:#D4D4D4;--1:#000000>:     </span><span style=--0:#CE9178;--1:#A31515>"admin endpoint without role"</span><span style=--0:#D4D4D4;--1:#000000>,</span></div></div><div class=ec-line><div class=gutter><div class=ln>24</div></div><div class=code><span class=indent>      </span><span style=--0:#9CDCFE;--1:#001080>url</span><span style=--0:#D4D4D4;--1:#000000>:      </span><span style=--0:#CE9178;--1:#A31515>"/admin"</span><span style=--0:#D4D4D4;--1:#000000>,</span></div></div><div class=ec-line><div class=gutter><div class=ln>25</div></div><div class=code><span class=indent>      </span><span style=--0:#9CDCFE;--1:#001080>wantCode</span><span style=--0:#D4D4D4;--1:#000000>: </span><span style=--0:#9CDCFE;--1:#001080>http</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#9CDCFE;--1:#001080>StatusUnauthorized</span><span style=--0:#D4D4D4;--1:#000000>,</span></div></div><div class=ec-line><div class=gutter><div class=ln>26</div></div><div class=code><span class=indent><span style=--0:#D4D4D4;--1:#000000>    </span></span><span style=--0:#D4D4D4;--1:#000000>},</span></div></div><div class=ec-line><div class=gutter><div class=ln>27</div></div><div class=code><span class=indent><span style=--0:#D4D4D4;--1:#000000>    </span></span><span style=--0:#D4D4D4;--1:#000000>{</span></div></div><div class=ec-line><div class=gutter><div class=ln>28</div></div><div class=code><span class=indent>      </span><span style=--0:#9CDCFE;--1:#001080>name</span><span style=--0:#D4D4D4;--1:#000000>:     </span><span style=--0:#CE9178;--1:#A31515>"admin endpoint with wrong role"</span><span style=--0:#D4D4D4;--1:#000000>,</span></div></div><div class=ec-line><div class=gutter><div class=ln>29</div></div><div class=code><span class=indent>      </span><span style=--0:#9CDCFE;--1:#001080>url</span><span style=--0:#D4D4D4;--1:#000000>:      </span><span style=--0:#CE9178;--1:#A31515>"/admin"</span><span style=--0:#D4D4D4;--1:#000000>,</span></div></div><div class=ec-line><div class=gutter><div class=ln>30</div></div><div class=code><span class=indent>      </span><span style=--0:#9CDCFE;--1:#001080>role</span><span style=--0:#D4D4D4;--1:#000000>:     </span><span style=--0:#CE9178;--1:#A31515>"OTHER"</span><span style=--0:#D4D4D4;--1:#000000>,</span></div></div><div class=ec-line><div class=gutter><div class=ln>31</div></div><div class=code><span class=indent>      </span><span style=--0:#9CDCFE;--1:#001080>wantCode</span><span style=--0:#D4D4D4;--1:#000000>: </span><span style=--0:#9CDCFE;--1:#001080>http</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#9CDCFE;--1:#001080>StatusUnauthorized</span><span style=--0:#D4D4D4;--1:#000000>,</span></div></div><div class=ec-line><div class=gutter><div class=ln>32</div></div><div class=code><span class=indent><span style=--0:#D4D4D4;--1:#000000>    </span></span><span style=--0:#D4D4D4;--1:#000000>},</span></div></div><div class=ec-line><div class=gutter><div class=ln>33</div></div><div class=code><span class=indent><span style=--0:#D4D4D4;--1:#000000>    </span></span><span style=--0:#D4D4D4;--1:#000000>{</span></div></div><div class=ec-line><div class=gutter><div class=ln>34</div></div><div class=code><span class=indent>      </span><span style=--0:#9CDCFE;--1:#001080>name</span><span style=--0:#D4D4D4;--1:#000000>:     </span><span style=--0:#CE9178;--1:#A31515>"admin endpoint with correct role"</span><span style=--0:#D4D4D4;--1:#000000>,</span></div></div><div class=ec-line><div class=gutter><div class=ln>35</div></div><div class=code><span class=indent>      </span><span style=--0:#9CDCFE;--1:#001080>url</span><span style=--0:#D4D4D4;--1:#000000>:      </span><span style=--0:#CE9178;--1:#A31515>"/admin"</span><span style=--0:#D4D4D4;--1:#000000>,</span></div></div><div class=ec-line><div class=gutter><div class=ln>36</div></div><div class=code><span class=indent>      </span><span style=--0:#9CDCFE;--1:#001080>role</span><span style=--0:#D4D4D4;--1:#000000>:     </span><span style=--0:#CE9178;--1:#A31515>"ADMIN"</span><span style=--0:#D4D4D4;--1:#000000>,</span></div></div><div class=ec-line><div class=gutter><div class=ln>37</div></div><div class=code><span class=indent>      </span><span style=--0:#9CDCFE;--1:#001080>wantCode</span><span style=--0:#D4D4D4;--1:#000000>: </span><span style=--0:#9CDCFE;--1:#001080>http</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#9CDCFE;--1:#001080>StatusOK</span><span style=--0:#D4D4D4;--1:#000000>,</span></div></div><div class=ec-line><div class=gutter><div class=ln>38</div></div><div class=code><span class=indent><span style=--0:#D4D4D4;--1:#000000>    </span></span><span style=--0:#D4D4D4;--1:#000000>},</span></div></div><div class=ec-line><div class=gutter><div class=ln>39</div></div><div class=code><span class=indent><span style=--0:#D4D4D4;--1:#000000>  </span></span><span style=--0:#D4D4D4;--1:#000000>}</span></div></div><div class=ec-line><div class=gutter><div class=ln>40</div></div><div class=code><span class=indent>  </span><span style=--0:#C586C0;--1:#AC00D8>for</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#9CDCFE;--1:#001080>_</span><span style=--0:#D4D4D4;--1:#000000>, </span><span style=--0:#9CDCFE;--1:#001080>tt</span><span style=--0:#D4D4D4;--1:#000000> := </span><span style=--0:#C586C0;--1:#AC00D8>range</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#9CDCFE;--1:#001080>tests</span><span style=--0:#D4D4D4;--1:#000000> {</span></div></div><div class=ec-line><div class=gutter><div class=ln>41</div></div><div class=code><span class=indent>    </span><span style=--0:#9CDCFE;--1:#001080>t</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#795E26>Run</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#9CDCFE;--1:#001080>tt</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#9CDCFE;--1:#001080>name</span><span style=--0:#D4D4D4;--1:#000000>, </span><span style=--0:#569CD6;--1:#0000FF>func</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#9CDCFE;--1:#001080>t</span><span style=--0:#D4D4D4;--1:#000000> *</span><span style=--0:#4EC9B0;--1:#227188>testing</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#4EC9B0;--1:#227188>T</span><span style=--0:#D4D4D4;--1:#000000>) {</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>42</div></div><div class=code><span class=indent>      </span><span style=--0:#95b686;--1:#006100>// Set up</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>43</div></div><div class=code><span class=indent>      </span><span style=--0:#9CDCFE;--1:#001080>session</span><span style=--0:#D4D4D4;--1:#000000> := </span><span style=--0:#9CDCFE;--1:#001080>scs</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#664f20>New</span><span style=--0:#D4D4D4;--1:#000000>()</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>44</div></div><div class=code><span class=indent>      </span><span style=--0:#9CDCFE;--1:#001080>router</span><span style=--0:#D4D4D4;--1:#000000> := </span><span style=--0:#9CDCFE;--1:#001080>chi</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#664f20>NewRouter</span><span style=--0:#D4D4D4;--1:#000000>()</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>45</div></div><div class=code><span class=indent>      </span><span style=--0:#9CDCFE;--1:#001080>server</span><span style=--0:#D4D4D4;--1:#000000> := &#x26;</span><span style=--0:#4EC9B0;--1:#1b5a6c>Server</span><span style=--0:#D4D4D4;--1:#000000>{</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>46</div></div><div class=code><span class=indent>        </span><span style=--0:#9CDCFE;--1:#001080>session</span><span style=--0:#D4D4D4;--1:#000000>: </span><span style=--0:#9CDCFE;--1:#001080>session</span><span style=--0:#D4D4D4;--1:#000000>,</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>47</div></div><div class=code><span class=indent>        </span><span style=--0:#9CDCFE;--1:#001080>router</span><span style=--0:#D4D4D4;--1:#000000>:  </span><span style=--0:#9CDCFE;--1:#001080>router</span><span style=--0:#D4D4D4;--1:#000000>,</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>48</div></div><div class=code><span class=indent><span style=--0:#D4D4D4;--1:#000000>      </span></span><span style=--0:#D4D4D4;--1:#000000>}</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>49</div></div><div class=code>
</div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>50</div></div><div class=code><span class=indent>      </span><span style=--0:#95b686;--1:#006100>// Session middleware</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>51</div></div><div class=code><span class=indent>      </span><span style=--0:#9CDCFE;--1:#001080>router</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#664f20>Use</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#DCDCAA;--1:#664f20>LoadAndSaveMock</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#9CDCFE;--1:#001080>session</span><span style=--0:#D4D4D4;--1:#000000>, </span><span style=--0:#d5a18c;--1:#A31515>"user_role"</span><span style=--0:#D4D4D4;--1:#000000>, </span><span style=--0:#9CDCFE;--1:#001080>tt</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#9CDCFE;--1:#001080>role</span><span style=--0:#D4D4D4;--1:#000000>))</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>52</div></div><div class=code>
</div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>53</div></div><div class=code><span class=indent>      </span><span style=--0:#95b686;--1:#006100>// Routes</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>54</div></div><div class=code><span class=indent>      </span><span style=--0:#9CDCFE;--1:#001080>router</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#664f20>Get</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#d5a18c;--1:#A31515>"/"</span><span style=--0:#D4D4D4;--1:#000000>, </span><span style=--0:#9CDCFE;--1:#001080>server</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#9CDCFE;--1:#001080>handleHelloWorld</span><span style=--0:#D4D4D4;--1:#000000>)</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>55</div></div><div class=code><span class=indent>      </span><span style=--0:#9CDCFE;--1:#001080>router</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#664f20>Group</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#7cb3df;--1:#0000FF>func</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#9CDCFE;--1:#001080>router</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#4EC9B0;--1:#1b5a6c>chi</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#4EC9B0;--1:#1b5a6c>Router</span><span style=--0:#D4D4D4;--1:#000000>) {</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>56</div></div><div class=code><span class=indent>        </span><span style=--0:#9CDCFE;--1:#001080>router</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#664f20>Use</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#9CDCFE;--1:#001080>server</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#9CDCFE;--1:#001080>RequireAdmin</span><span style=--0:#D4D4D4;--1:#000000>)</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>57</div></div><div class=code><span class=indent>        </span><span style=--0:#9CDCFE;--1:#001080>router</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#664f20>Get</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#d5a18c;--1:#A31515>"/admin"</span><span style=--0:#D4D4D4;--1:#000000>, </span><span style=--0:#9CDCFE;--1:#001080>server</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#9CDCFE;--1:#001080>handleAdmin</span><span style=--0:#D4D4D4;--1:#000000>)</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>58</div></div><div class=code><span class=indent><span style=--0:#D4D4D4;--1:#000000>      </span></span><span style=--0:#D4D4D4;--1:#000000>})</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>59</div></div><div class=code>
</div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>60</div></div><div class=code><span class=indent>      </span><span style=--0:#95b686;--1:#006100>// Request</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>61</div></div><div class=code><span class=indent>      </span><span style=--0:#9CDCFE;--1:#001080>rr</span><span style=--0:#D4D4D4;--1:#000000> := </span><span style=--0:#9CDCFE;--1:#001080>httptest</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#664f20>NewRecorder</span><span style=--0:#D4D4D4;--1:#000000>()</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>62</div></div><div class=code><span class=indent>      </span><span style=--0:#9CDCFE;--1:#001080>req</span><span style=--0:#D4D4D4;--1:#000000> := </span><span style=--0:#9CDCFE;--1:#001080>httptest</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#664f20>NewRequest</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#d5a18c;--1:#A31515>"GET"</span><span style=--0:#D4D4D4;--1:#000000>, </span><span style=--0:#9CDCFE;--1:#001080>tt</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#9CDCFE;--1:#001080>url</span><span style=--0:#D4D4D4;--1:#000000>, </span><span style=--0:#7cb3df;--1:#0000FF>nil</span><span style=--0:#D4D4D4;--1:#000000>)</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>63</div></div><div class=code><span class=indent>      </span><span style=--0:#9CDCFE;--1:#001080>router</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#664f20>ServeHTTP</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#9CDCFE;--1:#001080>rr</span><span style=--0:#D4D4D4;--1:#000000>, </span><span style=--0:#9CDCFE;--1:#001080>req</span><span style=--0:#D4D4D4;--1:#000000>)</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>64</div></div><div class=code>
</div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>65</div></div><div class=code><span class=indent>      </span><span style=--0:#95b686;--1:#006100>// Result</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>66</div></div><div class=code><span class=indent>      </span><span style=--0:#9CDCFE;--1:#001080>res</span><span style=--0:#D4D4D4;--1:#000000> := </span><span style=--0:#9CDCFE;--1:#001080>rr</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#664f20>Result</span><span style=--0:#D4D4D4;--1:#000000>()</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>67</div></div><div class=code>
</div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>68</div></div><div class=code><span class=indent>      </span><span style=--0:#d09dcc;--1:#8c00b0>if</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#9CDCFE;--1:#001080>tt</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#9CDCFE;--1:#001080>wantCode</span><span style=--0:#D4D4D4;--1:#000000> != </span><span style=--0:#9CDCFE;--1:#001080>res</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#9CDCFE;--1:#001080>StatusCode</span><span style=--0:#D4D4D4;--1:#000000> {</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>69</div></div><div class=code><span class=indent>        </span><span style=--0:#9CDCFE;--1:#001080>t</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#DCDCAA;--1:#664f20>Errorf</span><span style=--0:#D4D4D4;--1:#000000>(</span><span style=--0:#d5a18c;--1:#A31515>"Expected response code </span><span style=--0:#9CDCFE;--1:#001080>%d</span><span style=--0:#d5a18c;--1:#A31515>. Got </span><span style=--0:#9CDCFE;--1:#001080>%d</span><span style=--0:#D7BA7D;--1:#ac0000>\n</span><span style=--0:#d5a18c;--1:#A31515>"</span><span style=--0:#D4D4D4;--1:#000000>, </span><span style=--0:#9CDCFE;--1:#001080>tt</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#9CDCFE;--1:#001080>wantCode</span><span style=--0:#D4D4D4;--1:#000000>, </span><span style=--0:#9CDCFE;--1:#001080>res</span><span style=--0:#D4D4D4;--1:#000000>.</span><span style=--0:#9CDCFE;--1:#001080>StatusCode</span><span style=--0:#D4D4D4;--1:#000000>)</span></div></div><div class="ec-line highlight ins"><div class=gutter><div class=ln>70</div></div><div class=code><span class=indent><span style=--0:#D4D4D4;--1:#000000>      </span></span><span style=--0:#D4D4D4;--1:#000000>}</span></div></div><div class=ec-line><div class=gutter><div class=ln>71</div></div><div class=code><span class=indent><span style=--0:#D4D4D4;--1:#000000>    </span></span><span style=--0:#D4D4D4;--1:#000000>})</span></div></div><div class=ec-line><div class=gutter><div class=ln>72</div></div><div class=code><span class=indent><span style=--0:#D4D4D4;--1:#000000>  </span></span><span style=--0:#D4D4D4;--1:#000000>}</span></div></div><div class=ec-line><div class=gutter><div class=ln>73</div></div><div class=code><span style=--0:#D4D4D4;--1:#000000>}</span></div></div></code></pre><div class=copy><button data-code="func LoadAndSaveMock(session *scs.SessionManager, key, value string) func(next http.Handler) http.Handler {  return func(next http.Handler) http.Handler {    return session.LoadAndSave(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {      session.Put(r.Context(), key, value)      next.ServeHTTP(w, r)    }))  }}func Test_main(t *testing.T) {  tests := []struct {    name     string    url      string    role     string    wantCode int  }{    {      name:     &#x22;public endpoint&#x22;,      url:      &#x22;/&#x22;,      wantCode: http.StatusOK,    },    {      name:     &#x22;admin endpoint without role&#x22;,      url:      &#x22;/admin&#x22;,      wantCode: http.StatusUnauthorized,    },    {      name:     &#x22;admin endpoint with wrong role&#x22;,      url:      &#x22;/admin&#x22;,      role:     &#x22;OTHER&#x22;,      wantCode: http.StatusUnauthorized,    },    {      name:     &#x22;admin endpoint with correct role&#x22;,      url:      &#x22;/admin&#x22;,      role:     &#x22;ADMIN&#x22;,      wantCode: http.StatusOK,    },  }  for _, tt := range tests {    t.Run(tt.name, func(t *testing.T) {      // Set up      session := scs.New()      router := chi.NewRouter()      server := &#x26;Server{        session: session,        router:  router,      }      // Session middleware      router.Use(LoadAndSaveMock(session, &#x22;user_role&#x22;, tt.role))      // Routes      router.Get(&#x22;/&#x22;, server.handleHelloWorld)      router.Group(func(router chi.Router) {        router.Use(server.RequireAdmin)        router.Get(&#x22;/admin&#x22;, server.handleAdmin)      })      // Request      rr := httptest.NewRecorder()      req := httptest.NewRequest(&#x22;GET&#x22;, tt.url, nil)      router.ServeHTTP(rr, req)      // Result      res := rr.Result()      if tt.wantCode != res.StatusCode {        t.Errorf(&#x22;Expected response code %d. Got %d\n&#x22;, tt.wantCode, res.StatusCode)      }    })  }}" data-copied=Copied! title="Copy to clipboard"><div></div></button></div></figure></div><p>And.. we get this result</p><div class=expressive-code><figure class="frame has-title is-terminal"><figcaption class=header><span class=title>go test ./...</span></figcaption><pre data-language=bash><code><div class=ec-line><div class=code><span style=--0:#D4D4D4;--1:#000000>=== </span><span style=--0:#CE9178;--1:#A31515>RUN</span><span style=--0:#D4D4D4;--1:#000000>   </span><span style=--0:#CE9178;--1:#A31515>Test_main</span></div></div><div class=ec-line><div class=code><span style=--0:#D4D4D4;--1:#000000>=== </span><span style=--0:#CE9178;--1:#A31515>RUN</span><span style=--0:#D4D4D4;--1:#000000>   </span><span style=--0:#CE9178;--1:#A31515>Test_main/public_endpoint</span></div></div><div class=ec-line><div class=code><span style=--0:#DCDCAA;--1:#795E26>---</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#CE9178;--1:#A31515>PASS:</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#CE9178;--1:#A31515>Test_main/public_endpoint</span><span style=--0:#D4D4D4;--1:#000000> (0.00s)</span></div></div><div class=ec-line><div class=code><span style=--0:#D4D4D4;--1:#000000>=== </span><span style=--0:#CE9178;--1:#A31515>RUN</span><span style=--0:#D4D4D4;--1:#000000>   </span><span style=--0:#CE9178;--1:#A31515>Test_main/admin_endpoint_without_role</span></div></div><div class=ec-line><div class=code><span style=--0:#DCDCAA;--1:#795E26>---</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#CE9178;--1:#A31515>PASS:</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#CE9178;--1:#A31515>Test_main/admin_endpoint_without_role</span><span style=--0:#D4D4D4;--1:#000000> (0.00s)</span></div></div><div class=ec-line><div class=code><span style=--0:#D4D4D4;--1:#000000>=== </span><span style=--0:#CE9178;--1:#A31515>RUN</span><span style=--0:#D4D4D4;--1:#000000>   </span><span style=--0:#CE9178;--1:#A31515>Test_main/admin_endpoint_with_wrong_role</span></div></div><div class=ec-line><div class=code><span style=--0:#DCDCAA;--1:#795E26>---</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#CE9178;--1:#A31515>PASS:</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#CE9178;--1:#A31515>Test_main/admin_endpoint_with_wrong_role</span><span style=--0:#D4D4D4;--1:#000000> (0.00s)</span></div></div><div class=ec-line><div class=code><span style=--0:#D4D4D4;--1:#000000>=== </span><span style=--0:#CE9178;--1:#A31515>RUN</span><span style=--0:#D4D4D4;--1:#000000>   </span><span style=--0:#CE9178;--1:#A31515>Test_main/admin_endpoint_with_correct_role</span></div></div><div class=ec-line><div class=code><span style=--0:#DCDCAA;--1:#795E26>---</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#CE9178;--1:#A31515>PASS:</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#CE9178;--1:#A31515>Test_main/admin_endpoint_with_correct_role</span><span style=--0:#D4D4D4;--1:#000000> (0.00s)</span></div></div><div class=ec-line><div class=code><span style=--0:#DCDCAA;--1:#795E26>---</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#CE9178;--1:#A31515>PASS:</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#CE9178;--1:#A31515>Test_main</span><span style=--0:#D4D4D4;--1:#000000> (0.00s)</span></div></div><div class=ec-line><div class=code><span style=--0:#DCDCAA;--1:#795E26>PASS</span></div></div><div class=ec-line><div class=code><span style=--0:#DCDCAA;--1:#795E26>ok</span><span style=--0:#D4D4D4;--1:#000000>      </span><span style=--0:#CE9178;--1:#A31515>github.com/LucJosin/go-scs-test</span><span style=--0:#D4D4D4;--1:#000000> </span><span style=--0:#B5CEA8;--1:#08774E>0.002</span><span style=--0:#CE9178;--1:#A31515>s</span></div></div></code></pre><div class=copy><button data-code="=== RUN   Test_main=== RUN   Test_main/public_endpoint--- PASS: Test_main/public_endpoint (0.00s)=== RUN   Test_main/admin_endpoint_without_role--- PASS: Test_main/admin_endpoint_without_role (0.00s)=== RUN   Test_main/admin_endpoint_with_wrong_role--- PASS: Test_main/admin_endpoint_with_wrong_role (0.00s)=== RUN   Test_main/admin_endpoint_with_correct_role--- PASS: Test_main/admin_endpoint_with_correct_role (0.00s)--- PASS: Test_main (0.00s)PASSok      github.com/LucJosin/go-scs-test 0.002s" data-copied=Copied! title="Copy to clipboard"><div></div></button></div></figure></div><h2 id=conclusion>Conclusion<a href=#conclusion class=astro-brwhiAEl aria-hidden="" tabindex=-1><svg height=18 viewBox="0 0 24 24" width=18 class=autolink-svg fill=currentColor marginLeft=1rem xmlns=http://www.w3.org/2000/svg><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h2><p>In this post I show you a solution to a problem that I’ve encountered while implementing auth tests using the SCS session package.</p><h2 id=resources-and-references>Resources and References<a href=#resources-and-references class=astro-brwhiAEl aria-hidden="" tabindex=-1><svg height=18 viewBox="0 0 24 24" width=18 class=autolink-svg fill=currentColor marginLeft=1rem xmlns=http://www.w3.org/2000/svg><path d="M9.199 13.599a5.99 5.99 0 0 0 3.949 2.345 5.987 5.987 0 0 0 5.105-1.702l2.995-2.994a5.992 5.992 0 0 0 1.695-4.285 5.976 5.976 0 0 0-1.831-4.211 5.99 5.99 0 0 0-6.431-1.242 6.003 6.003 0 0 0-1.905 1.24l-1.731 1.721a.999.999 0 1 0 1.41 1.418l1.709-1.699a3.985 3.985 0 0 1 2.761-1.123 3.975 3.975 0 0 1 2.799 1.122 3.997 3.997 0 0 1 .111 5.644l-3.005 3.006a3.982 3.982 0 0 1-3.395 1.126 3.987 3.987 0 0 1-2.632-1.563A1 1 0 0 0 9.201 13.6zm5.602-3.198a5.99 5.99 0 0 0-3.949-2.345 5.987 5.987 0 0 0-5.105 1.702l-2.995 2.994a5.992 5.992 0 0 0-1.695 4.285 5.976 5.976 0 0 0 1.831 4.211 5.99 5.99 0 0 0 6.431 1.242 6.003 6.003 0 0 0 1.905-1.24l1.723-1.723a.999.999 0 1 0-1.414-1.414L9.836 19.81a3.985 3.985 0 0 1-2.761 1.123 3.975 3.975 0 0 1-2.799-1.122 3.997 3.997 0 0 1-.111-5.644l3.005-3.006a3.982 3.982 0 0 1 3.395-1.126 3.987 3.987 0 0 1 2.632 1.563 1 1 0 0 0 1.602-1.198z"></path></svg></a></h2><ul><li><a href=https://go-chi.io/#/ rel="noopener noreferrer" target=_blank>https://go-chi.io/#/<span><svg height=16 viewBox="0 0 24 24" width=16 class=astro-zThxBkxg fill=currentColor marginLeft=1rem xmlns=http://www.w3.org/2000/svg><path d="M14 3v2h3.59l-9.83 9.83l1.41 1.41L19 6.41V10h2V3m-2 16H5V5h7V3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7h-2v7Z"></path></svg></span></a></li><li><a href=https://github.com/alexedwards/scs rel="noopener noreferrer" target=_blank>https://github.com/alexedwards/scs<span><svg height=16 viewBox="0 0 24 24" width=16 class=astro-zThxBkxg fill=currentColor marginLeft=1rem xmlns=http://www.w3.org/2000/svg><path d="M14 3v2h3.59l-9.83 9.83l1.41 1.41L19 6.41V10h2V3m-2 16H5V5h7V3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7h-2v7Z"></path></svg></span></a></li><li><a href=https://stackoverflow.com/questions/76607300 rel="noopener noreferrer" target=_blank>https://stackoverflow.com/questions/76607300<span><svg height=16 viewBox="0 0 24 24" width=16 class=astro-zThxBkxg fill=currentColor marginLeft=1rem xmlns=http://www.w3.org/2000/svg><path d="M14 3v2h3.59l-9.83 9.83l1.41 1.41L19 6.41V10h2V3m-2 16H5V5h7V3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7h-2v7Z"></path></svg></span></a>(<a href=https://stackoverflow.com/a/76608076/14500144 rel="noopener noreferrer" target=_blank>Comment<span><svg height=16 viewBox="0 0 24 24" width=16 class=astro-zThxBkxg fill=currentColor marginLeft=1rem xmlns=http://www.w3.org/2000/svg><path d="M14 3v2h3.59l-9.83 9.83l1.41 1.41L19 6.41V10h2V3m-2 16H5V5h7V3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7h-2v7Z"></path></svg></span></a>)</li><li><a href=https://stackoverflow.com/questions/76606201 rel="noopener noreferrer" target=_blank>https://stackoverflow.com/questions/76606201<span><svg height=16 viewBox="0 0 24 24" width=16 class=astro-zThxBkxg fill=currentColor marginLeft=1rem xmlns=http://www.w3.org/2000/svg><path d="M14 3v2h3.59l-9.83 9.83l1.41 1.41L19 6.41V10h2V3m-2 16H5V5h7V3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7h-2v7Z"></path></svg></span></a>(<a href=https://stackoverflow.com/a/76606952/14500144 rel="noopener noreferrer" target=_blank>Comment<span><svg height=16 viewBox="0 0 24 24" width=16 class=astro-zThxBkxg fill=currentColor marginLeft=1rem xmlns=http://www.w3.org/2000/svg><path d="M14 3v2h3.59l-9.83 9.83l1.41 1.41L19 6.41V10h2V3m-2 16H5V5h7V3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7h-2v7Z"></path></svg></span></a>)</li></ul></article><div class=astro-IGmxlYLP data-astro-cid-52we5p3l><div class=astro-RuJJwjnb data-astro-cid-j2eqjz7p><i class=astro-dJNRyUaU data-astro-cid-j2eqjz7p>Last modified: <a href=https://github.com/LucJosin/lucasjosino.com/commits/main/src/content/blog/go-scs-test.md class=astro-dDaGXTVT title="See post history" style=--borderBottom:var(--border-color);--currentGap:0.6rem;--animatedGap:0.6rem;--iconColor:gray;--iconSize:1.2em;--display:flex rel="noopener noreferrer" target=_blank data-astro-cid-trf4k3zj><span style=--borderBottom:var(--border-color);--currentGap:0.6rem;--animatedGap:0.6rem;--iconColor:gray;--iconSize:1.2em;--display:flex data-astro-cid-trf4k3zj>May 1, 2024 at 15:00:00</span></a></i></div><div class=astro-pcaEvl_w data-astro-cid-6h4uzzpe><span class=astro-WtptMmUy data-astro-cid-6h4uzzpe><svg height=1em viewBox="0 0 24 24" width=18 data-icon=mdi:cards-heart data-astro-cid-6h4uzzpe><symbol id=ai:mdi:cards-heart><path d="m12 21.35l-1.45-1.32C5.4 15.36 2 12.27 2 8.5C2 5.41 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.08C13.09 3.81 14.76 3 16.5 3C19.58 3 22 5.41 22 8.5c0 3.77-3.4 6.86-8.55 11.53z" fill=currentColor /></symbol><use xlink:href=#ai:mdi:cards-heart></use></svg> Enjoy this post? Feel free to share!</span><div class=astro-DxKEeFK_ style="" data-astro-cid-6lpegvfu><div class=astro-wJoIcZrv data-astro-cid-fasyqkqy data-href="https://www.linkedin.com/sharing/share-offsite/?url=https://lucjos.in/b/ZfgJzcJf"><span class=astro-zzxFMCVP data-astro-cid-fasyqkqy>Share to Linkedin</span> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://lucjos.in/b/ZfgJzcJf" class=astro-ILL_kJwo title="Share to Linkedin" style="--padding:0.6rem 0.8rem;--iconSize:1em" data-astro-cid-tpz4yhk7 rel="noopener noreferrer" target=_blank data-umami-event="Post Share (Footer) - Linkedin (/b/ZfgJzcJf)"><svg height=1em viewBox="0 0 24 24" width=1em data-icon=simple-icons:linkedin data-astro-cid-tpz4yhk7><use xlink:href=#ai:simple-icons:linkedin></use></svg></a></div><div class=astro-wJoIcZrv data-astro-cid-fasyqkqy data-href="https://x.com/intent/tweet?url=https://lucjos.in/b/ZfgJzcJf&text=Go:%20How%20to%20mock%20SCS%20session%20authentication%20in%20tests%20by%20@LucJosin"><span class=astro-zzxFMCVP data-astro-cid-fasyqkqy>Share to X (Twitter)</span> <a href="https://x.com/intent/tweet?url=https://lucjos.in/b/ZfgJzcJf&text=Go:%20How%20to%20mock%20SCS%20session%20authentication%20in%20tests%20by%20@LucJosin" class=astro-ILL_kJwo title="Share to X (Twitter)" style="--padding:0.6rem 0.8rem;--iconSize:1em" data-astro-cid-tpz4yhk7 rel="noopener noreferrer" target=_blank data-umami-event="Post Share (Footer) - X (Twitter) (/b/ZfgJzcJf)"><svg height=1em viewBox="0 0 24 24" width=1em data-icon=simple-icons:x data-astro-cid-tpz4yhk7><use xlink:href=#ai:simple-icons:x></use></svg></a></div><div class=astro-wJoIcZrv data-astro-cid-fasyqkqy data-href="https://reddit.com/submit?url=https://lucjos.in/b/ZfgJzcJf&title=Go:%20How%20to%20mock%20SCS%20session%20authentication%20in%20tests"><span class=astro-zzxFMCVP data-astro-cid-fasyqkqy>Share to Reddit</span> <a href="https://reddit.com/submit?url=https://lucjos.in/b/ZfgJzcJf&title=Go:%20How%20to%20mock%20SCS%20session%20authentication%20in%20tests" class=astro-ILL_kJwo title="Share to Reddit" style="--padding:0.6rem 0.8rem;--iconSize:1em" data-astro-cid-tpz4yhk7 rel="noopener noreferrer" target=_blank data-umami-event="Post Share (Footer) - Reddit (/b/ZfgJzcJf)"><svg height=1em viewBox="0 0 24 24" width=1em data-icon=simple-icons:reddit data-astro-cid-tpz4yhk7><use xlink:href=#ai:simple-icons:reddit></use></svg></a></div><div class=astro-wJoIcZrv data-astro-cid-fasyqkqy data-href="https://bsky.app/intent/compose?text=Go%3A%20How%20to%20mock%20SCS%20session%20authentication%20in%20tests%20%23golang%20%23go-chi%20%23tests%20%23auth%20%23session%20https%3A%2F%2Flucjos.in%2Fb%2FZfgJzcJf"><span class=astro-zzxFMCVP data-astro-cid-fasyqkqy>Share to Bluesky</span> <a href="https://bsky.app/intent/compose?text=Go%3A%20How%20to%20mock%20SCS%20session%20authentication%20in%20tests%20%23golang%20%23go-chi%20%23tests%20%23auth%20%23session%20https%3A%2F%2Flucjos.in%2Fb%2FZfgJzcJf" class=astro-ILL_kJwo title="Share to Bluesky" style="--padding:0.6rem 0.8rem;--iconSize:1em" data-astro-cid-tpz4yhk7 rel="noopener noreferrer" target=_blank data-umami-event="Post Share (Footer) - Blueksy (/b/ZfgJzcJf)"><svg height=1em viewBox="0 0 24 24" width=1em data-icon=simple-icons:bluesky data-astro-cid-tpz4yhk7><use xlink:href=#ai:simple-icons:bluesky></use></svg></a></div><div class=astro-wJoIcZrv data-astro-cid-fasyqkqy data-href=https://lucjos.in/b/ZfgJzcJf id=share><span class=astro-zzxFMCVP data-astro-cid-fasyqkqy id=share-title>Copy link</span> <a href=https://lucjos.in/b/ZfgJzcJf class=astro-ILL_kJwo title="Copy link" style="--padding:0.6rem 0.8rem;--iconSize:1em" data-astro-cid-tpz4yhk7 rel="noopener noreferrer" target=_blank data-umami-event="Post Share (Footer) - Copy link (/b/ZfgJzcJf)"><svg height=1em viewBox="0 0 24 24" width=1em data-icon=mdi:link data-astro-cid-tpz4yhk7><use xlink:href=#ai:mdi:link></use></svg></a></div></div></div><div style=--justifyContent:initial data-astro-cid-4mxiqxos id=tags><h2 data-astro-cid-4mxiqxos style=--justifyContent:initial>Tags</h2><div class=astro-VFvkuRY_ style=--justifyContent:initial data-astro-cid-4mxiqxos><a href=/blog/tags/golang class=astro-BPKjPNjr title="See more posts with 'golang' tag" data-astro-cid-6ktkooou>golang</a><a href=/blog/tags/go-chi class=astro-BPKjPNjr title="See more posts with 'go-chi' tag" data-astro-cid-6ktkooou>go-chi</a><a href=/blog/tags/tests class=astro-BPKjPNjr title="See more posts with 'tests' tag" data-astro-cid-6ktkooou>tests</a><a href=/blog/tags/auth class=astro-BPKjPNjr title="See more posts with 'auth' tag" data-astro-cid-6ktkooou>auth</a><a href=/blog/tags/session class=astro-BPKjPNjr title="See more posts with 'session' tag" data-astro-cid-6ktkooou>session</a></div></div><div class=post-comments data-astro-cid-64uyyklt><h2 id=comments data-astro-cid-64uyyklt>Comments</h2><div class=giscus data-astro-cid-64uyyklt></div></div><script>document.addEventListener("DOMContentLoaded",(function(){const t={src:"https://giscus.app/client.js","data-repo":"LucJosin/lucasjosino.com","data-repo-id":"R_kgDOH3GyVA","data-category":"Announcements","data-category-id":"DIC_kwDOH3GyVM4CZ9W5","data-mapping":"pathname","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"0","data-input-position":"top","data-theme":getGiscusTheme(theme),"data-lang":"en","data-loading":"lazy",crossorigin:"anonymous",async:!0},a=document.createElement("script");Object.entries(t).forEach((([t,e])=>a.setAttribute(t,e))),document.body.appendChild(a)}))</script></div><div class=astro-uBZNRUCf style="--height:1px;--width:80%;--margin:1.5rem 0" data-astro-cid-4d7p4lxg></div><div class=astro-_VpPzUQQ data-astro-cid-uws3u2zx><div class=astro-nRTZNuAR data-astro-cid-uws3u2zx><div class=astro-xudBGAzb data-astro-cid-uws3u2zx><a href=/rss.xml class=astro-ILL_kJwo title=RSS style=--padding:0.5rem;--iconSize:1.2em data-astro-cid-tpz4yhk7 rel="noopener noreferrer" target=_blank data-umami-event="RSS (Footer) - (/blog/go-how-to-mock-scs-session-authentication-in-tests/)"><svg height=1em viewBox="0 0 24 24" width=1em data-icon=mdi:rss data-astro-cid-tpz4yhk7><symbol id=ai:mdi:rss><path d="M6.18 15.64a2.18 2.18 0 0 1 2.18 2.18C8.36 19 7.38 20 6.18 20C5 20 4 19 4 17.82a2.18 2.18 0 0 1 2.18-2.18M4 4.44A15.56 15.56 0 0 1 19.56 20h-2.83A12.73 12.73 0 0 0 4 7.27zm0 5.66a9.9 9.9 0 0 1 9.9 9.9h-2.83A7.07 7.07 0 0 0 4 12.93z" fill=currentColor /></symbol><use xlink:href=#ai:mdi:rss></use></svg> </a><a href=/blog/tags/ class=astro-ILL_kJwo title=Tags style=--padding:0.5rem;--iconSize:1.2em data-astro-cid-tpz4yhk7><svg height=1em viewBox="0 0 24 24" width=1em data-icon=mdi:tags data-astro-cid-tpz4yhk7><symbol id=ai:mdi:tags><path d="M5.5 9A1.5 1.5 0 0 0 7 7.5A1.5 1.5 0 0 0 5.5 6A1.5 1.5 0 0 0 4 7.5A1.5 1.5 0 0 0 5.5 9m11.91 2.58c.36.36.59.86.59 1.42c0 .55-.22 1.05-.59 1.41l-5 5a1.996 1.996 0 0 1-2.83 0l-6.99-6.99C2.22 12.05 2 11.55 2 11V6c0-1.11.89-2 2-2h5c.55 0 1.05.22 1.41.58zm-3.87-5.87l1-1l6.87 6.87c.37.36.59.87.59 1.42c0 .55-.22 1.05-.58 1.41l-5.38 5.38l-1-1L20.75 13z" fill=currentColor /></symbol><use xlink:href=#ai:mdi:tags></use></svg> </a><a href=https://github.com/LucJosin/lucasjosino.com class=astro-ILL_kJwo title="Source code" style=--padding:0.5rem;--iconSize:1.2em data-astro-cid-tpz4yhk7 rel="noopener noreferrer" target=_blank><svg height=1em viewBox="0 0 24 24" width=1em data-icon=simple-icons:github data-astro-cid-tpz4yhk7><symbol id=ai:simple-icons:github><path d="M12 .297c-6.63 0-12 5.373-12 12c0 5.303 3.438 9.8 8.205 11.385c.6.113.82-.258.82-.577c0-.285-.01-1.04-.015-2.04c-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729c1.205.084 1.838 1.236 1.838 1.236c1.07 1.835 2.809 1.305 3.495.998c.108-.776.417-1.305.76-1.605c-2.665-.3-5.466-1.332-5.466-5.93c0-1.31.465-2.38 1.235-3.22c-.135-.303-.54-1.523.105-3.176c0 0 1.005-.322 3.3 1.23c.96-.267 1.98-.399 3-.405c1.02.006 2.04.138 3 .405c2.28-1.552 3.285-1.23 3.285-1.23c.645 1.653.24 2.873.12 3.176c.765.84 1.23 1.91 1.23 3.22c0 4.61-2.805 5.625-5.475 5.92c.42.36.81 1.096.81 2.22c0 1.606-.015 2.896-.015 3.286c0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12" fill=currentColor /></symbol><use xlink:href=#ai:simple-icons:github></use></svg></a></div>© 2023 <span class=footer-home data-astro-cid-uws3u2zx><a href=/ class=astro-dDaGXTVT title="Lucas Josino" style=--borderBottom:var(--border-color);--currentGap:0.6rem;--animatedGap:0.6rem;--iconColor:gray;--iconSize:1.2em;--display:flex data-astro-cid-trf4k3zj><span style=--borderBottom:var(--border-color);--currentGap:0.6rem;--animatedGap:0.6rem;--iconColor:gray;--iconSize:1.2em;--display:flex data-astro-cid-trf4k3zj>Lucas Josino</span> </a></span>All Rights Reserved.</div></div></div></main></body></html>