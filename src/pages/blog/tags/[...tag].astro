---
import Description from '@components/core/Description.astro';
import Divider from '@components/core/Divider.astro';
import PostCard from '@components/core/Post/PostCard.astro';
import Title from '@components/core/Title.astro';
import Container from '@components/data/Container.astro';
import Layout from '@layouts/Layout.astro';
import { getStaticTagPaths } from '@lib/blog';
import { getFormatedDate } from '@lib/date';
import type { CollectionEntry } from 'astro:content';
import { useLocale } from 'i18n';

export const getStaticPaths = getStaticTagPaths();

interface Props {
  posts: CollectionEntry<'blog'>[];
}

const { t, pluralize, interpolate, localizePath } = useLocale(
  Astro.url.pathname
);

const { tag } = Astro.params;
const { posts } = Astro.props;
---

<Layout
  title={interpolate(t.tags.tag.title, { tag })}
  description={interpolate(t.tags.description, { tag })}
  shortlink="/blog"
>
  <Container>
    <Title title={interpolate(t.tags.tag.title, { tag })} fontSize="2.5em" />
    <Description
      value={pluralize(
        t.tags.tag.description,
        {
          singular: t.tags.tag.description_one,
          plural: t.tags.tag.description_other,
          count: posts.length,
        },
        { tag }
      )}
      margin="0"
      width="80%"
    />
    <Divider height="1px" width="80%" />
    <div class="tag-posts">
      {
        posts.map((post) => {
          return (
            <PostCard
              image={post.data.image.src}
              title={post.data.title}
              description={post.data.description}
              category={post.data.category}
              href={localizePath(`/blog/${post.data.permSlug}`)}
              publishedAt={getFormatedDate(post.data.publishedAt)}
              tags={post.data.tags}
              body={post.body}
            />
          );
        })
      }
    </div>
  </Container>
</Layout>

<style>
  .tag-posts {
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }
</style>
